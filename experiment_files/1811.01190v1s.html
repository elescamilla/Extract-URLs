<!DOCTYPE html><html>
<head>
<title></title>
<style type="text/css">
<!--
.xflip {
    -moz-transform: scaleX(-1);
    -webkit-transform: scaleX(-1);
    -o-transform: scaleX(-1);
    transform: scaleX(-1);
    filter: fliph;
}
.yflip {
    -moz-transform: scaleY(-1);
    -webkit-transform: scaleY(-1);
    -o-transform: scaleY(-1);
    transform: scaleY(-1);
    filter: flipv;
}
.xyflip {
    -moz-transform: scaleX(-1) scaleY(-1);
    -webkit-transform: scaleX(-1) scaleY(-1);
    -o-transform: scaleX(-1) scaleY(-1);
    transform: scaleX(-1) scaleY(-1);
    filter: fliph + flipv;
}
-->
</style>
</head>
<body>
<a name=1></a>Malware&#160;Dynamic&#160;Analysis&#160;Evasion&#160;Techniques:<br/>
A&#160;Survey<br/>
Amir&#160;Afianian1,&#160;Salman&#160;Niksefat1,&#160;Babak&#160;Sadeghiyan1,&#160;and&#160;David<br/>
Baptiste2<br/>
1APA&#160;Research&#160;Center,&#160;Amirkabir&#160;University&#160;of&#160;Technology<br/>
2ESIEA&#160;(C&#160;+&#160;V)O&#160;lab<br/>
1{a.afianian,&#160;niksefat,&#160;basadegh}@aut.ac.ir<br/>
2baptiste.david@esiea.fr<br/>
June&#160;2018<br/>
Abstract<br/>
The&#160;Cyber&#160;world&#160;is&#160;plagued&#160;with&#160;ever-evolving&#160;malware&#160;that&#160;readily<br/>
infiltrates&#160;all&#160;defense&#160;mechanisms,&#160;operates&#160;viciously&#160;unbeknownst&#160;to&#160;the<br/>user&#160;and&#160;surreptitiously&#160;exfiltrate&#160;sensitive&#160;data.&#160;Understanding&#160;the&#160;in-<br/>ner&#160;workings&#160;of&#160;such&#160;malware&#160;provides&#160;a&#160;leverage&#160;to&#160;effectively&#160;combat<br/>them.&#160;This&#160;understanding,&#160;is&#160;pursued&#160;through&#160;dynamic&#160;analysis&#160;which<br/>is&#160;conducted&#160;manually&#160;or&#160;automatically.&#160;Malware&#160;authors&#160;accordingly,<br/>have&#160;devised&#160;and&#160;advanced&#160;evasion&#160;techniques&#160;to&#160;thwart&#160;or&#160;evade&#160;these<br/>analyses.&#160;In&#160;this&#160;paper,&#160;we&#160;present&#160;a&#160;comprehensive&#160;survey&#160;on&#160;malware<br/>dynamic&#160;analysis&#160;evasion&#160;techniques.&#160;In&#160;addition,&#160;we&#160;propose&#160;a&#160;detailed<br/>classification&#160;of&#160;these&#160;techniques&#160;and&#160;further&#160;demonstrate&#160;how&#160;their&#160;effi-<br/>cacy&#160;hold&#160;against&#160;different&#160;types&#160;of&#160;detection&#160;and&#160;analysis&#160;approach.<br/>
Our&#160;observations&#160;attest&#160;that&#160;evasive&#160;behavior&#160;is&#160;mostly&#160;interested&#160;in<br/>
detecting&#160;and&#160;evading&#160;sandboxes.&#160;The&#160;primary&#160;tactic&#160;of&#160;such&#160;malware&#160;we<br/>argue,&#160;is&#160;fingerprinting&#160;followed&#160;by&#160;new&#160;trends&#160;for&#160;reverse&#160;Turing&#160;test&#160;tac-<br/>tic&#160;which&#160;aims&#160;at&#160;detecting&#160;human&#160;interaction.&#160;Furthermore,&#160;we&#160;will&#160;posit<br/>that&#160;the&#160;current&#160;defensive&#160;strategies&#160;beginning&#160;with&#160;reactive&#160;methods&#160;to<br/>
arXiv:1811.01190v1 &#160;[cs.CR] &#160;3 Nov 2018<br/>
endeavors&#160;for&#160;more&#160;transparent&#160;analysis&#160;systems,&#160;are&#160;readily&#160;foiled&#160;by&#160;zero-<br/>day&#160;fingerprinting&#160;techniques&#160;or&#160;other&#160;evasion&#160;tactics&#160;such&#160;as&#160;stalling.&#160;Ac-<br/>cordingly,&#160;we&#160;would&#160;recommend&#160;pursuit&#160;of&#160;more&#160;generic&#160;defensive&#160;strate-<br/>gies&#160;with&#160;emphasis&#160;on&#160;path&#160;exploration&#160;techniques&#160;that&#160;has&#160;the&#160;potential<br/>to&#160;thwart&#160;all&#160;the&#160;evasive&#160;tactics.<br/>
1<br/>
Introduction<br/>
Gaining&#160;access&#160;through&#160;ARPANET&#160;network,&#160;Creeper&#160;copied&#160;itself&#160;remotely&#160;to<br/>other&#160;computers,&#160;and,&#160;prompted&#160;the&#160;message:&#160;“Catch&#160;me&#160;if&#160;you&#160;can”.&#160;Emerged<br/>
1<br/>
<hr/>
<a name=2></a>as&#160;an&#160;experiment&#160;in&#160;1971&#160;<a href="1811.01190v1s.html#25">[1],&#160;</a>Creeper&#160;carried&#160;no&#160;harmful&#160;purpose,&#160;yet,&#160;with&#160;its<br/>quick&#160;propagation&#160;it&#160;cast&#160;the&#160;light&#160;on&#160;a&#160;future&#160;with&#160;individuals&#160;or&#160;entities&#160;incor-<br/>porating&#160;their&#160;malicious&#160;intentions&#160;into&#160;a&#160;software&#160;(hence&#160;the&#160;name&#160;malware),<br/>that&#160;are&#160;capable&#160;of&#160;inducing&#160;undesired&#160;and&#160;harmful&#160;effects&#160;on&#160;the&#160;infected&#160;sys-<br/>tems&#160;<a href="1811.01190v1s.html#25">[2].&#160;</a>In&#160;those&#160;days,&#160;developing&#160;malware&#160;was&#160;merely&#160;about&#160;show&#160;off;&#160;but,<br/>in&#160;today’s&#160;world,&#160;as&#160;the&#160;Internet&#160;has&#160;integrated&#160;every&#160;individual,&#160;institute,&#160;and<br/>organization&#160;into&#160;a&#160;single&#160;cohesive&#160;complex,&#160;the&#160;goal&#160;of&#160;malware&#160;authors&#160;have<br/>extended&#160;to&#160;include&#160;far&#160;more&#160;lucrative&#160;objectives,&#160;i.e.&#160;money,&#160;intelligence,&#160;and<br/>power.&#160;Accordingly,&#160;these&#160;possibilities&#160;have&#160;profoundly&#160;motivated&#160;a&#160;new&#160;mal-<br/>ware&#160;industry,&#160;the&#160;outcome&#160;of&#160;which,&#160;are&#160;highly&#160;sophisticated&#160;variants,&#160;which<br/>aptly&#160;infiltrate&#160;systems&#160;and&#160;operate&#160;viciously&#160;unbeknownst&#160;to&#160;the&#160;user&#160;or&#160;defense<br/>mechanisms.<br/>
Devising&#160;countermeasure&#160;or&#160;technologies&#160;that&#160;can&#160;withstand&#160;this&#160;level&#160;of&#160;so-<br/>
phistication&#160;would&#160;be&#160;possible&#160;merely&#160;by&#160;understanding&#160;the&#160;precise&#160;inner&#160;work-<br/>ings&#160;of&#160;such&#160;malware.&#160;Malware&#160;analysis&#160;is&#160;the&#160;way&#160;to&#160;achieve&#160;this&#160;understanding<br/><a href="1811.01190v1s.html#25">[3].&#160;</a>Initially,&#160;with&#160;the&#160;help&#160;of&#160;disassemblers,&#160;decompilers&#160;etc.&#160;analysts&#160;inspected<br/>the&#160;malware’s&#160;binary&#160;and&#160;code&#160;to&#160;infer&#160;its&#160;functionality.&#160;This&#160;approach,&#160;which<br/>is&#160;also&#160;referred&#160;to&#160;as&#160;static&#160;analysis&#160;became&#160;far&#160;more&#160;arduous,&#160;and&#160;intricate&#160;with<br/>the&#160;advent,&#160;and&#160;evolution&#160;of&#160;code&#160;obfuscation&#160;tactics&#160;<a href="1811.01190v1s.html#25">[4,&#160;5,&#160;6,&#160;7,&#160;8]&#160;</a>and&#160;other<br/>evasion&#160;tactics&#160;targeting&#160;static&#160;analysis&#160;e.g.&#160;opaque&#160;constants&#160;<a href="1811.01190v1s.html#25">[9],&#160;</a>packers&#160;<a href="1811.01190v1s.html#25">[10],<br/></a>etc.&#160;As&#160;a&#160;resolution,&#160;a&#160;promising&#160;approach&#160;that&#160;was&#160;adopted&#160;was&#160;dynamic&#160;anal-<br/>ysis&#160;in&#160;which&#160;the&#160;basis&#160;of&#160;analysis&#160;and&#160;detection&#160;is&#160;what&#160;the&#160;file&#160;does&#160;(behavior)<br/>rather&#160;than&#160;what&#160;the&#160;file&#160;is&#160;(binary&#160;and&#160;signature)&#160;<a href="1811.01190v1s.html#25">[11].&#160;</a>Put&#160;differently,&#160;in&#160;dy-<br/>namic&#160;analysis,&#160;an&#160;instance&#160;of&#160;the&#160;suspected&#160;program&#160;is&#160;run&#160;and&#160;its&#160;behavior<br/>is&#160;inspected&#160;in&#160;run-time.&#160;This&#160;approach&#160;would&#160;obviate&#160;the&#160;hurdles&#160;posed&#160;by<br/>aforementioned&#160;static&#160;analysis&#160;evasion&#160;tactics.&#160;To&#160;thwart&#160;these&#160;efforts,&#160;how-<br/>ever,&#160;malware&#160;authors&#160;turned&#160;to&#160;a&#160;new&#160;category&#160;of&#160;evasion&#160;tactics&#160;that&#160;targeted<br/>dynamic&#160;analysis.<br/>
In&#160;this&#160;paper,&#160;we&#160;identify&#160;two&#160;modes&#160;of&#160;dynamic&#160;analysis&#160;i.e.&#160;manual&#160;and<br/>
automated.&#160;Manual&#160;dynamic&#160;analysis&#160;is&#160;a&#160;more&#160;traditional&#160;form&#160;of&#160;dynamic<br/>analysis&#160;and&#160;is&#160;often&#160;conducted&#160;with&#160;the&#160;help&#160;of&#160;debuggers.&#160;Automated&#160;dynamic<br/>analysis&#160;is&#160;a&#160;more&#160;novel&#160;approach&#160;and&#160;also&#160;a&#160;response&#160;to&#160;the&#160;ever-increasing<br/>new&#160;samples&#160;that&#160;security&#160;vendors&#160;face&#160;on&#160;a&#160;daily&#160;basis.&#160;Automated&#160;dynamic<br/>analysis&#160;is&#160;often&#160;represented&#160;by&#160;the&#160;Sandbox&#160;technology.&#160;Further,&#160;we&#160;conduct&#160;a<br/>comprehensive&#160;survey&#160;on&#160;evasion&#160;techniques&#160;that&#160;are&#160;tailored&#160;to&#160;each&#160;mode&#160;of<br/>analysis.<br/>
In&#160;addition,&#160;we&#160;will&#160;portray&#160;the&#160;current&#160;and&#160;also&#160;the&#160;emerging&#160;evasive&#160;trends.<br/>
In&#160;the&#160;case&#160;of&#160;manual&#160;dynamic&#160;analysis&#160;evasion&#160;we&#160;posit&#160;that&#160;anti-debugging<br/>techniques&#160;are&#160;still&#160;significantly&#160;being&#160;practiced.&#160;Also,&#160;we&#160;will&#160;discuss&#160;how&#160;the<br/>new&#160;fileless&#160;malware&#160;is&#160;emerging&#160;and&#160;prevailing&#160;the&#160;traditional&#160;dynamic&#160;analysis.<br/>Moreover,&#160;in&#160;the&#160;case&#160;of&#160;automated&#160;dynamic&#160;analysis,&#160;we&#160;divide&#160;evasion&#160;tactics<br/>in&#160;two&#160;broad&#160;categories:&#160;detection-dependent,&#160;and&#160;detection-independent.&#160;We<br/>argue&#160;that&#160;until&#160;recent&#160;times,&#160;sandbox&#160;technology&#160;have&#160;been&#160;focusing&#160;on&#160;tech-<br/>nologies&#160;that&#160;chiefly&#160;target&#160;the&#160;detection-depend&#160;evasion&#160;tactics.&#160;As&#160;a&#160;response,<br/>malware&#160;authors&#160;are&#160;gradually&#160;adopting&#160;more&#160;and&#160;more&#160;detection-independent<br/>tactics&#160;to&#160;evade&#160;such&#160;automated&#160;dynamic&#160;analysis&#160;environments.<br/>
2<br/>
<hr/>
<a name=3></a>Our&#160;goal&#160;in&#160;this&#160;paper&#160;is&#160;threefold.&#160;First,&#160;given&#160;the&#160;importance&#160;of&#160;the&#160;sub-<br/>
ject,&#160;we&#160;have&#160;aimed&#160;at&#160;offering&#160;a&#160;comprehensive&#160;classification,&#160;with&#160;the&#160;hope<br/>of&#160;moving&#160;towards&#160;an&#160;established&#160;taxonomy.&#160;Second,&#160;we&#160;aspired&#160;to&#160;unveil&#160;the<br/>direction&#160;toward&#160;which&#160;the&#160;evasive&#160;behavior&#160;is&#160;trending.&#160;Thus,&#160;we&#160;tried&#160;to&#160;yield<br/>a&#160;view&#160;of&#160;the&#160;current&#160;situation&#160;for&#160;pervasiveness&#160;of&#160;each&#160;evasion&#160;tactic.&#160;Our<br/>third&#160;goal&#160;is&#160;to&#160;identify&#160;the&#160;shortcomings&#160;of&#160;the&#160;current&#160;defensive&#160;strategies&#160;and<br/>offer&#160;a&#160;direction&#160;which&#160;we&#160;deem&#160;to&#160;have&#160;more&#160;potential&#160;on&#160;effectively&#160;confront<br/>evasive&#160;malware.<br/>
Our&#160;contributions&#160;are:<br/>
•&#160;We&#160;present&#160;a&#160;comprehensive&#160;survey&#160;of&#160;malware&#160;dynamic&#160;analysis&#160;evasion<br/>
techniques&#160;for&#160;both&#160;modes&#160;of&#160;manual&#160;and&#160;automated.&#160;There&#160;have&#160;been<br/>several&#160;surveys&#160;on&#160;malware&#160;analysis&#160;evasion&#160;such&#160;as&#160;<a href="1811.01190v1s.html#26">[12]&#160;</a>which&#160;has&#160;merely<br/>focused&#160;on&#160;automated&#160;dynamic&#160;analysis&#160;evasion&#160;and&#160;covers&#160;only&#160;one&#160;(out<br/>of&#160;five&#160;that&#160;we&#160;have&#160;identified)&#160;evasion&#160;tactic.&#160;Other&#160;surveys&#160;like&#160;<a href="1811.01190v1s.html#26">[13,&#160;14]<br/></a>trivially&#160;surveyed&#160;analysis&#160;evasion&#160;and&#160;provide&#160;no&#160;detailed&#160;overview&#160;of<br/>malware&#160;dynamic&#160;analysis&#160;evasion.<br/>
•&#160;For&#160;both&#160;manual&#160;and&#160;automated&#160;modes,&#160;we&#160;present&#160;a&#160;detailed&#160;classification<br/>
of&#160;malware&#160;evasion&#160;tactics&#160;and&#160;techniques.&#160;To&#160;the&#160;best&#160;of&#160;our&#160;knowledge,<br/>this&#160;would&#160;be&#160;the&#160;first&#160;comprehensive&#160;survey&#160;of&#160;dynamic&#160;analysis&#160;evasion<br/>tactics&#160;that&#160;offers&#160;a&#160;thorough&#160;classification.<br/>
•&#160;We&#160;portray&#160;the&#160;current&#160;trends&#160;in&#160;the&#160;realm&#160;automated&#160;dynamic&#160;analysis<br/>
evasion&#160;techniques&#160;and&#160;discuss&#160;about&#160;the&#160;proper&#160;course&#160;of&#160;action&#160;for&#160;the<br/>future&#160;directions.<br/>
1.1<br/>
Overview<br/>
1.1.1<br/>
Scope<br/>
Latest&#160;reports&#160;attest&#160;to&#160;the&#160;dominance&#160;of&#160;Windows&#160;malware&#160;by&#160;a&#160;staggering<br/>ratio&#160;of&#160;77.22%&#160;in&#160;2017&#160;<a href="1811.01190v1s.html#26">[15].&#160;</a>Statistics&#160;also&#160;show&#160;that&#160;due&#160;to&#160;the&#160;employment<br/>of&#160;evasion&#160;techniques,&#160;“64%&#160;of&#160;AV&#160;scanners&#160;fail&#160;to&#160;identify&#160;1%&#160;of&#160;the&#160;malware<br/>after&#160;1&#160;year”&#160;<a href="1811.01190v1s.html#26">[16].&#160;</a>These&#160;figures&#160;have&#160;further&#160;motivated&#160;us&#160;to&#160;converge&#160;our<br/>focus&#160;on&#160;evasive&#160;malware&#160;targeting&#160;Windows&#160;OS.&#160;Moreover,&#160;in&#160;our&#160;research,&#160;we<br/>have&#160;strove&#160;to&#160;probe&#160;the&#160;intersection&#160;of&#160;academia&#160;and&#160;industry.&#160;Thus,&#160;we&#160;have<br/>reviewed&#160;both&#160;academic&#160;papers,&#160;and&#160;related&#160;industry-provided&#160;literature.<br/>
1.1.2<br/>
Approach<br/>
Our&#160;primary&#160;endeavor&#160;has&#160;been&#160;to&#160;provide&#160;a&#160;detailed&#160;and&#160;vivid&#160;overview&#160;of&#160;dy-<br/>namic&#160;analysis&#160;evasion&#160;techniques.&#160;To&#160;this&#160;end,&#160;we&#160;have&#160;classified&#160;the&#160;results<br/>of&#160;our&#160;scrutiny&#160;in&#160;three&#160;levels:&#160;category,&#160;tactic,&#160;and&#160;technique.&#160;Each&#160;category<br/>represents&#160;a&#160;particular&#160;approach&#160;and&#160;a&#160;goal&#160;which&#160;is&#160;both&#160;shared&#160;and&#160;pursued<br/>through&#160;different&#160;tactics.&#160;Each&#160;tactic&#160;then,&#160;is&#160;implemented&#160;via&#160;different&#160;tech-<br/>niques.&#160;Throughout&#160;the&#160;survey&#160;we&#160;elaborate&#160;the&#160;details&#160;down&#160;to&#160;the&#160;tactic&#160;level<br/>
3<br/>
<hr/>
<a name=4></a><img src="1811.01190v1-4_1.png"/><br/>
and&#160;we&#160;discuss&#160;several&#160;representative&#160;techniques.&#160;At&#160;the&#160;end&#160;of&#160;each&#160;section&#160;we<br/>provide&#160;a&#160;summarizing&#160;table.<br/>
1.1.3<br/>
Evaluation<br/>
To&#160;fulfill&#160;the&#160;goals&#160;of&#160;this&#160;survey,&#160;we&#160;have&#160;employed&#160;several&#160;criteria&#160;such&#160;as<br/>efficacy&#160;and&#160;pervasiveness&#160;of&#160;different&#160;techniques&#160;which&#160;serve&#160;as&#160;the&#160;basis&#160;of<br/>comparisons&#160;for&#160;the&#160;related&#160;topic.&#160;In&#160;our&#160;summarizing&#160;tables&#160;we&#160;present&#160;data<br/>from&#160;reviewed&#160;works&#160;where&#160;statistics&#160;are&#160;available,&#160;and&#160;otherwise&#160;we&#160;offer&#160;eval-<br/>uations&#160;based&#160;on&#160;our&#160;own&#160;observation.<br/>
1.1.4<br/>
Organization<br/>
In&#160;section&#160;II,&#160;We&#160;discuss&#160;manual&#160;dynamic&#160;analysis&#160;(debugging)&#160;and&#160;correspond-<br/>ing&#160;anti-debugging&#160;tactics.&#160;In&#160;section&#160;III&#160;we&#160;discuss&#160;automated&#160;dynamic&#160;analysis<br/>and&#160;the&#160;corresponding&#160;evasion&#160;tactics.&#160;section&#160;II&#160;and&#160;III&#160;are&#160;followed&#160;by&#160;a&#160;dis-<br/>cussion.&#160;Finally,&#160;section&#160;IV&#160;concludes&#160;the&#160;paper.&#160;Figure&#160;1&#160;demonstrates&#160;our<br/>proposed&#160;classification&#160;of&#160;the&#160;malware&#160;dynamic&#160;analysis&#160;evasion&#160;tactics.<br/>
Figure&#160;1:&#160;A&#160;classification&#160;of&#160;malware&#160;dynamic&#160;analysis&#160;evasion&#160;tactics<br/>
2<br/>
Preliminaries<br/>
2.1<br/>
Evasion&#160;and&#160;Transparency<br/>
In&#160;literature,&#160;evasion&#160;constitutes&#160;a&#160;series&#160;of&#160;techniques&#160;employed&#160;by&#160;malware&#160;in<br/>order&#160;to&#160;remain&#160;stealth,&#160;avoid&#160;detection,&#160;or&#160;hinder&#160;efforts&#160;for&#160;analysis.&#160;A&#160;major<br/>evasion&#160;tactic&#160;as&#160;we&#160;will&#160;discuss,&#160;is&#160;fingerprinting&#160;<a href="1811.01190v1s.html#26">[17].&#160;</a>With&#160;fingerprinting,<br/>malware&#160;tries&#160;to&#160;detect&#160;its&#160;environment&#160;and&#160;verify&#160;if&#160;it&#160;is&#160;residing&#160;in&#160;a&#160;production<br/>system&#160;or&#160;an&#160;analysis&#160;system.<br/>
4<br/>
<hr/>
<a name=5></a>In&#160;the&#160;same&#160;level,&#160;one&#160;major&#160;strategy&#160;is&#160;to&#160;hide&#160;the&#160;cues&#160;and&#160;clues&#160;that&#160;might<br/>
expose&#160;the&#160;analysis&#160;system.&#160;A&#160;system&#160;is&#160;more&#160;transparent&#160;if&#160;it&#160;exposes&#160;fewer<br/>clues&#160;to&#160;malware&#160;<a href="1811.01190v1s.html#26">[18].</a><br/>
2.2<br/>
Manual&#160;vs&#160;Automated<br/>
Manual&#160;and&#160;automated&#160;analysis&#160;are&#160;two&#160;major&#160;terms&#160;which&#160;form&#160;the&#160;basis&#160;of&#160;our<br/>classifications.&#160;The&#160;manual&#160;analysis&#160;is&#160;when&#160;the&#160;analysis&#160;process&#160;is&#160;performed<br/>by&#160;an&#160;expert&#160;human.&#160;Automated,&#160;on&#160;the&#160;other&#160;hand,&#160;is&#160;the&#160;process&#160;that&#160;is<br/>performed&#160;automatically&#160;by&#160;a&#160;machine&#160;or&#160;software.<br/>
2.3<br/>
Detection&#160;vs&#160;Analysis<br/>
Previously,&#160;there&#160;was&#160;no&#160;need&#160;for&#160;defining&#160;these&#160;two&#160;terms.&#160;Detection&#160;would<br/>simply&#160;refer&#160;to&#160;the&#160;process&#160;of&#160;discerning&#160;if&#160;a&#160;given&#160;file&#160;is&#160;malicious&#160;or&#160;not;&#160;anal-<br/>ysis,&#160;on&#160;the&#160;other&#160;hand,&#160;would&#160;refer&#160;to&#160;the&#160;process&#160;of&#160;understanding&#160;how&#160;the<br/>given&#160;malware&#160;work.&#160;Today,&#160;however,&#160;this&#160;dividing&#160;line&#160;is&#160;blurry.&#160;The&#160;reason<br/>is&#160;that&#160;the&#160;role&#160;of&#160;automated&#160;analysis&#160;tools&#160;such&#160;as&#160;sandboxes&#160;is&#160;now&#160;extended.<br/>In&#160;addition&#160;to&#160;reporting&#160;on&#160;malware&#160;behavior,&#160;sandboxes&#160;are&#160;now&#160;playing&#160;their<br/>role&#160;as&#160;the&#160;core&#160;of&#160;automated&#160;detection&#160;mechanisms&#160;<a href="1811.01190v1s.html#26">[18].&#160;</a>In&#160;this&#160;paper,&#160;we<br/>follow&#160;the&#160;similar&#160;concepts&#160;when&#160;uttering&#160;”analysis”.&#160;For&#160;”manual”&#160;it&#160;would<br/>mean&#160;understanding&#160;the&#160;malware&#160;behavior&#160;<a href="1811.01190v1s.html#26">[19],&#160;</a>for&#160;the&#160;automated,&#160;additionally<br/>it&#160;can&#160;mean&#160;detection.<br/>
2.4<br/>
Static&#160;vs&#160;Dynamic<br/>
There&#160;are&#160;two&#160;major&#160;types&#160;of&#160;analysis&#160;i.e.&#160;static,&#160;and&#160;dynamic.&#160;Static&#160;analysis<br/>is&#160;the&#160;process&#160;of&#160;analyzing&#160;the&#160;code&#160;or&#160;binary&#160;without&#160;executing&#160;it.&#160;Dynamic<br/>analysis&#160;is&#160;the&#160;process&#160;of&#160;studying&#160;the&#160;behavior&#160;of&#160;the&#160;malware&#160;(API,&#160;system<br/>calls,&#160;etc.)&#160;at&#160;run-time.&#160;Both&#160;types&#160;of&#160;the&#160;analysis&#160;can&#160;be&#160;performed&#160;either<br/>manually&#160;or&#160;automatically.&#160;In&#160;this&#160;paper,&#160;our&#160;focus&#160;is&#160;on&#160;dynamic&#160;analysis&#160;and<br/>how&#160;malware&#160;tries&#160;to&#160;prevent&#160;or&#160;evade&#160;such&#160;analyses.<br/>
2.5<br/>
Category,&#160;Tactic,&#160;and&#160;Technique<br/>
Throughout&#160;this&#160;paper,&#160;we&#160;use&#160;the&#160;terms&#160;”category”,&#160;”tactic”,&#160;and&#160;”technique”<br/>that&#160;are&#160;the&#160;basis&#160;of&#160;our&#160;classification.&#160;Category&#160;of&#160;evasion&#160;is&#160;our&#160;high-level<br/>classification.&#160;Each&#160;category&#160;has&#160;the&#160;goal&#160;of&#160;evasion&#160;with&#160;a&#160;specific&#160;attitude&#160;for<br/>achieving&#160;it.&#160;This&#160;attitude&#160;is&#160;highly&#160;correlated&#160;with&#160;the&#160;efficacy&#160;of&#160;the&#160;evasion<br/>and&#160;is&#160;pursued&#160;by&#160;the&#160;tactics&#160;under&#160;each&#160;category.&#160;Tactics,&#160;in&#160;other&#160;words,&#160;are<br/>the&#160;specific&#160;maneuvers&#160;or&#160;approach&#160;for&#160;evasion&#160;with&#160;the&#160;specified&#160;attitude&#160;of&#160;its<br/>parent&#160;category.&#160;Finally,&#160;techniques&#160;are&#160;the&#160;various&#160;practical&#160;implementation&#160;of<br/>those&#160;tactics.<br/>
5<br/>
<hr/>
<a name=6></a>3<br/>
Manual&#160;Dynamic&#160;Analysis&#160;Evasion<br/>
As&#160;cited&#160;in&#160;the&#160;introduction,&#160;due&#160;to&#160;the&#160;employment&#160;of&#160;code&#160;obfuscation,&#160;pack-<br/>ers,&#160;etc.&#160;static&#160;analysis&#160;of&#160;malware&#160;has&#160;become&#160;a&#160;daunting&#160;task.&#160;To&#160;obviate&#160;the<br/>conundrums&#160;and&#160;limitations&#160;of&#160;this&#160;approach,&#160;analysts&#160;opt&#160;for&#160;dynamic&#160;anal-<br/>ysis&#160;in&#160;which&#160;malware’s&#160;behavior&#160;is&#160;inspected&#160;in&#160;run-time&#160;and&#160;often&#160;with&#160;the<br/>help&#160;of&#160;debuggers.&#160;This&#160;way&#160;of&#160;examination&#160;has&#160;two&#160;major&#160;benefits;&#160;one&#160;is&#160;that<br/>it&#160;relieves&#160;us&#160;from&#160;the&#160;impediments&#160;inflicted&#160;by&#160;packers,&#160;polymorphism,&#160;etc.<br/>Second,&#160;taking&#160;this&#160;approach&#160;enables&#160;us&#160;to&#160;explore&#160;the&#160;activities&#160;that&#160;manifest<br/>themselves&#160;only&#160;in&#160;runtime&#160;<a href="1811.01190v1s.html#26">[20]&#160;</a>such&#160;as&#160;the&#160;interaction&#160;of&#160;the&#160;program&#160;with<br/>the&#160;OS&#160;<a href="1811.01190v1s.html#25">[11].&#160;</a>We&#160;view&#160;this&#160;approach&#160;which&#160;is&#160;aided&#160;by&#160;debuggers,&#160;under&#160;the<br/>term&#160;“manual&#160;dynamic&#160;analysis”.&#160;The&#160;corresponding&#160;evasion&#160;tactics&#160;to&#160;this&#160;ap-<br/>proach&#160;involves&#160;the&#160;set&#160;of&#160;employed&#160;techniques&#160;within&#160;malware&#160;code&#160;with&#160;the<br/>goal&#160;of&#160;hindering,&#160;impeding&#160;or&#160;evading&#160;the&#160;analysis&#160;process.&#160;These&#160;measures<br/>include&#160;approaches&#160;such&#160;as&#160;detecting&#160;the&#160;presence&#160;of&#160;analysis&#160;tools&#160;on&#160;the&#160;sys-<br/>tem&#160;(e.g.&#160;wireshark,&#160;tcpdump,&#160;etc.)&#160;or&#160;detecting&#160;virtual-machines&#160;as&#160;a&#160;sign&#160;of<br/>analysis&#160;environment,&#160;but,&#160;the&#160;majority&#160;of&#160;manual&#160;analysis&#160;evasion&#160;techniques<br/>are&#160;targeted&#160;toward&#160;debuggers&#160;which&#160;are&#160;the&#160;primary&#160;tools&#160;of&#160;manual&#160;dynamic<br/>analysis.&#160;Hence,&#160;in&#160;the&#160;domain&#160;of&#160;manual&#160;dynamic&#160;analysis&#160;evasion,&#160;we&#160;converge<br/>our&#160;focus&#160;on&#160;anti-debugging&#160;tactics.<br/>
Simply,&#160;anti-debugging&#160;is&#160;the&#160;application&#160;of&#160;one&#160;or&#160;more&#160;techniques,&#160;to&#160;fend<br/>
off,&#160;impede&#160;or&#160;evade&#160;the&#160;process&#160;of&#160;manual&#160;dynamic&#160;analysis&#160;(debugging)&#160;or<br/>reverse-engineering.&#160;It&#160;is&#160;noteworthy&#160;to&#160;mention&#160;that&#160;anti-debugging&#160;techniques,<br/>similar&#160;to&#160;obfuscation,&#160;are&#160;legitimate&#160;practices&#160;conducted&#160;by&#160;developers&#160;to&#160;pro-<br/>tect&#160;their&#160;software.&#160;This&#160;implies&#160;that&#160;anti-debugging&#160;has&#160;a&#160;long&#160;history&#160;which&#160;is<br/>followed&#160;by&#160;a&#160;wide&#160;and&#160;diverse&#160;set&#160;of&#160;techniques.&#160;In&#160;this&#160;section,&#160;we&#160;will&#160;present<br/>our&#160;survey&#160;on&#160;the&#160;most&#160;cited&#160;manual&#160;dynamic&#160;analysis&#160;evasion&#160;(anti-debugging)<br/>tactics&#160;and&#160;corresponding&#160;techniques&#160;<a href="1811.01190v1s.html#25">[11,&#160;</a><a href="1811.01190v1s.html#26">20,&#160;21,&#160;22,&#160;23,&#160;24,&#160;25,&#160;19,&#160;26,&#160;</a><a href="1811.01190v1s.html#27">27,&#160;28]<br/></a>that&#160;are&#160;more&#160;relevant&#160;to&#160;the&#160;context&#160;of&#160;malware.&#160;In&#160;addition,&#160;for&#160;each&#160;tech-<br/>nique,&#160;we&#160;employ&#160;4&#160;criteria&#160;to&#160;better&#160;yield&#160;an&#160;overview&#160;of&#160;relative&#160;weight&#160;and<br/>efficacy.&#160;We&#160;summarize&#160;our&#160;anti-debugging&#160;study&#160;in&#160;table&#160;1.&#160;Three&#160;criteria&#160;for<br/>our&#160;comparison&#160;and&#160;our&#160;touchstone&#160;for&#160;evaluating&#160;them&#160;are&#160;as&#160;follows:<br/>
•&#160;Complexity:&#160;The&#160;difficulty&#160;of&#160;incorporating&#160;and&#160;implementing&#160;the&#160;tech-<br/>
nique&#160;within&#160;malware&#160;code.&#160;We&#160;associate&#160;low&#160;complexity&#160;if&#160;the&#160;technique<br/>involves&#160;simple&#160;API&#160;calls&#160;for&#160;detection&#160;of&#160;debuggers’&#160;presence,&#160;medium&#160;to<br/>those&#160;that&#160;require&#160;several&#160;calls&#160;to&#160;inquire&#160;information&#160;from&#160;the&#160;system&#160;as<br/>well&#160;and&#160;the&#160;need&#160;to&#160;deduce&#160;from&#160;the&#160;returned&#160;information&#160;the&#160;probability<br/>of&#160;debuggers&#160;presence,&#160;and&#160;high&#160;to&#160;those&#160;that&#160;are&#160;challenging&#160;to&#160;implement<br/>and&#160;require&#160;more&#160;than&#160;30&#160;lines&#160;of&#160;assembly&#160;code.<br/>
•&#160;Resistance:&#160;Resistance&#160;pertains&#160;to&#160;the&#160;difficulty&#160;level&#160;of&#160;counteracting<br/>
the&#160;evasion&#160;technique.&#160;If&#160;it&#160;would&#160;be&#160;as&#160;simple&#160;as&#160;altering&#160;some&#160;system<br/>information&#160;(e.g.&#160;randomizing&#160;registry&#160;key&#160;or&#160;a&#160;bit&#160;in&#160;PEB&#160;)&#160;we&#160;consider<br/>it&#160;low;&#160;if&#160;defeating&#160;the&#160;anti-debugging&#160;technique&#160;requires&#160;user-level&#160;hook<br/>and&#160;dll&#160;injection&#160;we&#160;assign&#160;medium&#160;resistance;&#160;if&#160;kernel-level&#160;manipula-<br/>
6<br/>
<hr/>
<a name=7></a>tions&#160;e.g.&#160;drivers&#160;is&#160;needed&#160;we&#160;set&#160;the&#160;resistance&#160;level&#160;as&#160;high;&#160;and&#160;if<br/>the&#160;countermeasure&#160;requires&#160;operations&#160;below&#160;OS&#160;(virtualization,&#160;emula-<br/>tion,&#160;etc.)&#160;we&#160;consider&#160;it&#160;very-high.&#160;Finally,&#160;we&#160;have&#160;N/A,&#160;associated&#160;to<br/>techniques&#160;for&#160;which&#160;there&#160;exist&#160;no&#160;countermeasures&#160;yet.<br/>
•&#160;Pervasiveness:&#160;Due&#160;to&#160;the&#160;extreme&#160;diversity&#160;of&#160;malware&#160;sample&#160;dataset<br/>
it&#160;is&#160;hard&#160;to&#160;establish&#160;a&#160;ground&#160;truth&#160;for&#160;the&#160;pervasiveness&#160;of&#160;each&#160;tactic.<br/>However,&#160;we&#160;strive&#160;to&#160;provide&#160;a&#160;fair&#160;view&#160;of&#160;this&#160;metric&#160;based&#160;on&#160;other<br/>works&#160;<a href="1811.01190v1s.html#26">[21,&#160;</a><a href="1811.01190v1s.html#27">29]&#160;</a>in&#160;addition&#160;to&#160;our&#160;own&#160;observations&#160;and&#160;experience&#160;in&#160;the<br/>field.<br/>
Additionally,&#160;we&#160;allot&#160;a&#160;column&#160;to&#160;textbfCountermeasure&#160;under&#160;Which&#160;we&#160;briefly<br/>note&#160;how&#160;the&#160;anti-debugging&#160;technique&#160;could&#160;be&#160;circumvented.<br/>
Before&#160;scrutinizing&#160;the&#160;anti-debugging&#160;techniques,&#160;we&#160;will&#160;have&#160;a&#160;brief&#160;in-<br/>
troduction&#160;on&#160;debuggers,&#160;their&#160;goals,&#160;types,&#160;and&#160;techniques.&#160;Building&#160;upon&#160;this<br/>understanding,&#160;we&#160;can&#160;better&#160;understand&#160;and&#160;elaborate&#160;anti-debugging&#160;tactics<br/>and&#160;what&#160;makes&#160;them&#160;feasible.<br/>
3.1<br/>
A&#160;Briefing&#160;on&#160;Debuggers<br/>
As&#160;Sikorski&#160;states,&#160;“A&#160;debugger&#160;is&#160;a&#160;piece&#160;of&#160;software&#160;or&#160;hardware&#160;used&#160;to&#160;test<br/>or&#160;examine&#160;the&#160;execution&#160;of&#160;another&#160;program&#160;<a href="1811.01190v1s.html#26">[19]”.&#160;</a>Among&#160;the&#160;core&#160;function-<br/>ality&#160;of&#160;debuggers&#160;<a href="1811.01190v1s.html#27">[30],&#160;</a>there&#160;are&#160;several&#160;features&#160;that&#160;are&#160;critical&#160;to&#160;malware<br/>analysis&#160;such&#160;as&#160;stepping&#160;through&#160;the&#160;code&#160;one&#160;instruction&#160;at&#160;a&#160;time,&#160;pausing<br/>or&#160;halting&#160;it&#160;on&#160;desired&#160;points,&#160;examining&#160;the&#160;variables,&#160;etc.&#160;To&#160;provide&#160;each<br/>of&#160;the&#160;mentioned&#160;functionality,&#160;debuggers&#160;rely&#160;on&#160;different&#160;tactics&#160;and&#160;each&#160;tac-<br/>tic&#160;is&#160;often&#160;aided&#160;with&#160;specific&#160;hardware&#160;or&#160;software&#160;provisions&#160;that&#160;inevitably<br/>result&#160;in&#160;subtle&#160;changes&#160;on&#160;the&#160;system.&#160;For&#160;instance,&#160;to&#160;provide&#160;the&#160;pausing<br/>capability,&#160;one&#160;of&#160;debuggers’&#160;tactics&#160;is&#160;to&#160;set&#160;breakpoints.&#160;Using&#160;breakpoints&#160;is<br/>further&#160;assisted&#160;with&#160;either&#160;special&#160;hardware&#160;<a href="1811.01190v1s.html#27">[31]&#160;</a>(e.g.&#160;DR&#160;Registers&#160;of&#160;CPU&#160;and<br/>specific&#160;API&#160;to&#160;access/alter&#160;them),&#160;or&#160;software&#160;(e.g.&#160;specific&#160;opcodes,&#160;etc.)&#160;<a href="1811.01190v1s.html#27">[32]<br/></a>mechanisms.&#160;Single&#160;stepping,&#160;as&#160;another&#160;instance,&#160;is&#160;made&#160;possible&#160;by&#160;trigger-<br/>ing&#160;exceptions&#160;in&#160;the&#160;code&#160;which&#160;is&#160;aided&#160;by&#160;a&#160;specific&#160;flag&#160;(trap&#160;flag).&#160;One&#160;way<br/>a&#160;malware&#160;can&#160;discover&#160;the&#160;presence&#160;of&#160;the&#160;debugger&#160;is&#160;through&#160;the&#160;very&#160;same<br/>aiding&#160;mechanisms&#160;or&#160;results&#160;of&#160;corresponding&#160;changes&#160;on&#160;the&#160;system&#160;which&#160;we<br/>will&#160;elaborate&#160;more&#160;as&#160;we&#160;proceed.<br/>
Based&#160;on&#160;the&#160;needed&#160;functionality,&#160;debuggers&#160;are&#160;implemented&#160;following&#160;dif-<br/>
ferent&#160;approaches&#160;<a href="1811.01190v1s.html#27">[33],&#160;</a>including&#160;user-mode&#160;debuggers&#160;e.g.&#160;OllyICE,&#160;OllyDbg,<br/>kernel&#160;debuggers&#160;e.g.&#160;WinDbg,&#160;KD,&#160;and&#160;simulator-based&#160;debuggers&#160;e.g.&#160;Ether<br/><a href="1811.01190v1s.html#27">[34],&#160;</a>BOCHS&#160;<a href="1811.01190v1s.html#27">[35].&#160;</a>Each&#160;of&#160;the&#160;designs,&#160;yield&#160;different&#160;levels&#160;of&#160;transparency.<br/>Kernel-level&#160;debuggers&#160;are&#160;more&#160;transparent&#160;than&#160;User-level&#160;debugger&#160;and&#160;pro-<br/>vide&#160;more&#160;detailed&#160;information&#160;as&#160;they&#160;operate&#160;in&#160;ring&#160;0&#160;(same&#160;level&#160;of&#160;privilege<br/>as&#160;the&#160;OS).&#160;Simulator-based&#160;debuggers&#160;have&#160;an&#160;even&#160;higher&#160;level&#160;of&#160;privilege<br/>than&#160;kernel&#160;debuggers&#160;since&#160;the&#160;OS&#160;in&#160;this&#160;setting&#160;is&#160;running&#160;atop&#160;the&#160;simulated<br/>(virtualized/emulated)&#160;hardware&#160;<a href="1811.01190v1s.html#27">[34,&#160;35]&#160;</a>and&#160;consequently&#160;are&#160;more&#160;transpar-<br/>ent&#160;to&#160;malware.&#160;In&#160;the&#160;next&#160;section,&#160;we&#160;proceed&#160;to&#160;manual&#160;dynamic&#160;analysis<br/>evasion,&#160;or&#160;more&#160;specifically,&#160;anti-debugging&#160;tactics.<br/>
7<br/>
<hr/>
<a name=8></a>3.2<br/>
Proposed&#160;Anti-Debugging&#160;Classification<br/>
We&#160;propose&#160;three&#160;major&#160;categories,&#160;as&#160;malware’s&#160;initial&#160;anti-debugging&#160;strate-<br/>gies:&#160;direct&#160;detection,&#160;deductive&#160;detection,&#160;and&#160;debugger&#160;evasion.&#160;As&#160;stated<br/>earlier,&#160;we&#160;elaborate&#160;on&#160;each&#160;category&#160;down&#160;to&#160;the&#160;tactic&#160;level&#160;along&#160;with&#160;a<br/>couple&#160;of&#160;representative&#160;techniques&#160;for&#160;each&#160;tactic.&#160;Finally,&#160;we&#160;summarize&#160;the<br/>results&#160;of&#160;our&#160;scrutiny&#160;in&#160;table&#160;1.<br/>
3.2.1<br/>
Direct&#160;Detection<br/>
We&#160;call&#160;the&#160;tactics&#160;of&#160;this&#160;category&#160;as&#160;“direct&#160;detection”&#160;in&#160;that,&#160;the&#160;malware,<br/>simply&#160;through&#160;direct&#160;observation&#160;of&#160;debugger’s&#160;byproducts,&#160;and&#160;artifacts.&#160;can<br/>spot&#160;its&#160;presence.&#160;One&#160;of&#160;the&#160;malware’s&#160;major&#160;leverages&#160;against&#160;debuggers&#160;stems<br/>from&#160;the&#160;fact&#160;that&#160;debuggers&#160;were&#160;originally&#160;devised&#160;to&#160;debug&#160;legitimate&#160;software<br/><a href="1811.01190v1s.html#26">[20].&#160;</a>Thus,&#160;initially,&#160;there&#160;has&#160;been&#160;no&#160;stealthy&#160;countermeasure&#160;provisioned&#160;by<br/>them.&#160;Moreover,&#160;when&#160;we&#160;want&#160;to&#160;enable&#160;debugging&#160;capability,&#160;we&#160;have&#160;to<br/>instrument&#160;the&#160;system&#160;with&#160;necessary&#160;tools&#160;which&#160;obviously&#160;results&#160;in&#160;a&#160;wide<br/>spectrum&#160;of&#160;traces&#160;in&#160;different&#160;levels&#160;of&#160;the&#160;system&#160;<a href="1811.01190v1s.html#26">[23,&#160;</a><a href="1811.01190v1s.html#27">29].&#160;</a>Examining&#160;the<br/>system&#160;for&#160;such&#160;traces&#160;that&#160;are&#160;inherent&#160;to&#160;working&#160;principles&#160;of&#160;debuggers,&#160;is<br/>one&#160;major&#160;strategy&#160;that&#160;malware&#160;utilizes&#160;to&#160;detect&#160;the&#160;presence&#160;of&#160;a&#160;debugger.<br/>In&#160;this&#160;section,&#160;we&#160;will&#160;elaborate&#160;on&#160;these&#160;system&#160;changes&#160;and&#160;how&#160;malware<br/>might&#160;try&#160;to&#160;disclose&#160;them.&#160;This&#160;category&#160;of&#160;tactics&#160;are&#160;often&#160;easy&#160;to&#160;employ<br/>and&#160;also&#160;easy&#160;to&#160;defeat.&#160;Moving&#160;from&#160;user-mode&#160;debuggers&#160;to&#160;simulation-based<br/>ones,&#160;this&#160;category&#160;of&#160;evasion&#160;pales&#160;in&#160;efficacy.<br/>
3.2.1.1<br/>
Reading&#160;PEB<br/>
Process&#160;Environment&#160;Block&#160;(PEB&#160;)&#160;is&#160;a&#160;data&#160;struc-<br/>
ture&#160;that&#160;exists&#160;per&#160;process&#160;in&#160;the&#160;system&#160;and&#160;contains&#160;data&#160;about&#160;that&#160;process<br/><a href="1811.01190v1s.html#27">[36].&#160;</a>Different&#160;sections&#160;of&#160;PEB&#160;contain&#160;information&#160;that&#160;can&#160;be&#160;probed&#160;by&#160;a<br/>malware&#160;to&#160;detect&#160;whether&#160;a&#160;debugger&#160;exists.&#160;The&#160;most&#160;obvious&#160;one&#160;is&#160;a&#160;field<br/>inside&#160;PEB&#160;named&#160;BeingDebugged&#160;which&#160;can&#160;be&#160;read&#160;directly&#160;or&#160;as&#160;Microsoft<br/>recommends—&#160;and&#160;malware&#160;like&#160;Kronos&#160;<a href="1811.01190v1s.html#27">[37]&#160;</a>or&#160;Satan&#160;RaaS&#160;<a href="1811.01190v1s.html#27">[38]&#160;</a>implement<br/>—&#160;through&#160;the&#160;specific&#160;APIs&#160;that&#160;read&#160;this&#160;field,&#160;i.e.<br/>
IsDebuggerPresent(),<br/>
CheckRemoteDebuggerPresent().&#160;Implementation&#160;of&#160;this&#160;technique&#160;is&#160;of&#160;triv-<br/>ial&#160;complexity&#160;which&#160;can&#160;be&#160;countered&#160;through&#160;alteration&#160;of&#160;BeingDebugged<br/>bit&#160;<a href="1811.01190v1s.html#27">[39]&#160;</a>or&#160;API&#160;hook&#160;<a href="1811.01190v1s.html#26">[22].&#160;</a>Other&#160;techniques&#160;based&#160;upon&#160;PEB&#160;involve&#160;utiliza-<br/>tion&#160;of&#160;NtGlobalFLags&#160;and&#160;ProcessHeap&#160;which&#160;are&#160;slightly&#160;more&#160;complex&#160;<a href="1811.01190v1s.html#26">[25].<br/></a>Collectively,&#160;anti-debugging&#160;tactics&#160;relying&#160;on&#160;PEB,&#160;constitute&#160;the&#160;majority&#160;of<br/>anti-debugging&#160;techniques&#160;observed&#160;in&#160;malware&#160;<a href="1811.01190v1s.html#26">[21].</a><br/>
3.2.1.2<br/>
Search&#160;for&#160;Breakpoints<br/>
To&#160;halt&#160;the&#160;execution,&#160;debuggers&#160;set&#160;break-<br/>
points.&#160;This&#160;can&#160;be&#160;accomplished&#160;through&#160;hardware&#160;or&#160;software&#160;techniques.&#160;In<br/>hardware&#160;breakpoints,&#160;the&#160;breakpoint&#160;address,&#160;for&#160;instance,&#160;can&#160;be&#160;saved&#160;in<br/>CPU&#160;DR&#160;registers&#160;or.&#160;In&#160;software&#160;breakpoints,&#160;the&#160;debugger&#160;would&#160;write&#160;the<br/>special&#160;opcode&#160;0xCC&#160;(INT&#160;3&#160;instruction)&#160;into&#160;the&#160;process&#160;which&#160;is&#160;specifically<br/>designated&#160;for&#160;setting&#160;breakpoints.&#160;Consequently,&#160;the&#160;malware,&#160;if&#160;spots&#160;signs<br/>
8<br/>
<hr/>
<a name=9></a>of&#160;these&#160;breakpoints,&#160;presumes&#160;the&#160;presence&#160;of&#160;a&#160;debugger.&#160;This&#160;can&#160;be&#160;ac-<br/>complished&#160;through&#160;a&#160;self-scan&#160;or&#160;integrity&#160;check,&#160;looking&#160;for&#160;0xCC,&#160;or&#160;using<br/>GetThreadContext&#160;to&#160;check&#160;CPU&#160;register&#160;<a href="1811.01190v1s.html#26">[25].&#160;</a>The&#160;latter&#160;technique&#160;has&#160;been<br/>employed&#160;by&#160;malware&#160;such&#160;as&#160;CIH&#160;<a href="1811.01190v1s.html#27">[40]&#160;</a>or&#160;MyDoom.<br/>
This&#160;tactic&#160;is&#160;the&#160;second&#160;most&#160;observed&#160;anti-debugging&#160;technique&#160;in&#160;mal-<br/>
ware’s&#160;arsenal&#160;<a href="1811.01190v1s.html#26">[21]&#160;</a>and&#160;is&#160;simple&#160;to&#160;implement&#160;(less&#160;than&#160;10&#160;lines&#160;of&#160;assembly<br/>code&#160;often&#160;suffices).&#160;Countering&#160;this&#160;category&#160;of&#160;tactics,&#160;however,&#160;is&#160;not&#160;trivial.<br/>In&#160;the&#160;case&#160;of&#160;software&#160;breakpoints,&#160;for&#160;instance,&#160;the&#160;debugger&#160;has&#160;to&#160;keep&#160;and<br/>feed&#160;a&#160;copy&#160;of&#160;the&#160;original&#160;byte&#160;that&#160;was&#160;replaced&#160;by&#160;0xCC&#160;opcode&#160;<a href="1811.01190v1s.html#27">[39].</a><br/>
3.2.1.3<br/>
System&#160;Artifacts<br/>
From&#160;installation&#160;to&#160;configuration&#160;and&#160;execu-<br/>
tion,&#160;debuggers&#160;leave&#160;traces&#160;behind&#160;in&#160;different&#160;levels&#160;of&#160;the&#160;OS,&#160;e.g.&#160;in&#160;the&#160;file<br/>system,&#160;registry,&#160;process&#160;name,&#160;etc.&#160;Hence,&#160;a&#160;malware&#160;can&#160;simply&#160;look&#160;for&#160;these<br/>traces.&#160;FindWindow(),&#160;FindProcess()&#160;are&#160;a&#160;couple&#160;of&#160;APIs&#160;that&#160;shcndhss&#160;<a href="1811.01190v1s.html#27">[41]<br/></a>exploited&#160;to&#160;detect&#160;debuggers.&#160;The&#160;malware,&#160;for&#160;instance&#160;can&#160;give&#160;the&#160;name&#160;of<br/>debuggers&#160;as&#160;the&#160;parameter&#160;to&#160;FindWindow()&#160;to&#160;verify&#160;if&#160;its&#160;process&#160;exists&#160;on<br/>the&#160;system&#160;or&#160;not&#160;<a href="1811.01190v1s.html#26">[26,&#160;</a><a href="1811.01190v1s.html#27">42].&#160;</a>Most&#160;often,&#160;simple&#160;anti-debugging&#160;techniques&#160;are<br/>trivially&#160;defeated.&#160;The&#160;countermeasure&#160;to&#160;this&#160;category&#160;of&#160;tactic&#160;is&#160;randomizing<br/>the&#160;names,&#160;or&#160;altering&#160;the&#160;results&#160;of&#160;the&#160;aforementioned&#160;query&#160;through&#160;simple<br/>API&#160;hooks.&#160;Even&#160;though&#160;attributed&#160;to&#160;one&#160;of&#160;the&#160;anti-debugging&#160;techniques&#160;in<br/>literature,&#160;we&#160;have&#160;rarely&#160;observed&#160;it&#160;in&#160;the&#160;wild.<br/>
3.2.1.4<br/>
Parent&#160;Check<br/>
Ordinarily,&#160;applications&#160;are&#160;executed&#160;either&#160;through<br/>
double&#160;clicking&#160;of&#160;an&#160;icon,&#160;or&#160;execution&#160;from&#160;command&#160;line,&#160;the&#160;parent&#160;process<br/>ID&#160;of&#160;which&#160;is&#160;retrievable&#160;accordingly.&#160;It&#160;would&#160;be&#160;a&#160;pronounced&#160;sign&#160;of&#160;de-<br/>bugger&#160;if&#160;the&#160;examined&#160;parent&#160;process&#160;name&#160;belongs&#160;to&#160;a&#160;debugger&#160;or&#160;is&#160;not<br/>equivalent&#160;to&#160;process&#160;name&#160;of&#160;explorer.exe&#160;<a href="1811.01190v1s.html#26">[25].&#160;</a>One&#160;straight&#160;forward&#160;technique<br/>is&#160;using&#160;CreateToolhelp32Snapshot()&#160;and&#160;checking&#160;if&#160;the&#160;parent&#160;process&#160;name<br/>matches&#160;the&#160;name&#160;of&#160;a&#160;known&#160;debugger&#160;<a href="1811.01190v1s.html#26">[22].&#160;</a>A&#160;randomization&#160;of&#160;debuggers’<br/>process&#160;name&#160;suffices&#160;to&#160;defeat&#160;this&#160;technique.&#160;Another&#160;more&#160;complex&#160;way&#160;is<br/>to&#160;check&#160;the&#160;parent&#160;process&#160;ID&#160;against&#160;that&#160;of&#160;explorer.exe.&#160;A&#160;malware&#160;such<br/>as&#160;<a href="1811.01190v1s.html#27">[41]&#160;</a>utilizes&#160;of&#160;the&#160;following&#160;functions:&#160;GetCurrentProcessId(),&#160;CreateTool-<br/>help32Snapshot(),&#160;Process32First()&#160;Process32Next()&#160;<a href="1811.01190v1s.html#26">[21].&#160;</a>If&#160;the&#160;parent&#160;process<br/>ID&#160;does&#160;not&#160;match&#160;with&#160;that&#160;of&#160;the&#160;explorer.exe,&#160;it&#160;might&#160;be&#160;a&#160;sign&#160;of&#160;debuggers<br/>presence.&#160;Precise&#160;and&#160;effective&#160;employment&#160;of&#160;this&#160;technique&#160;faces&#160;some&#160;chal-<br/>lenges.&#160;If&#160;there&#160;are&#160;more&#160;than&#160;one&#160;process&#160;for&#160;explorer.exe,&#160;then,&#160;there&#160;would<br/>be&#160;more&#160;than&#160;one&#160;PID&#160;for&#160;it.&#160;This&#160;would&#160;complicate&#160;the&#160;process&#160;by&#160;sparking<br/>false&#160;positives&#160;in&#160;that&#160;the&#160;parent&#160;PID&#160;might&#160;match&#160;to&#160;one&#160;explorer.exe&#160;PID&#160;and<br/>not&#160;the&#160;other.&#160;Countering&#160;this&#160;tactic&#160;would&#160;be&#160;skipping&#160;the&#160;relevant&#160;APIs&#160;<a href="1811.01190v1s.html#27">[29].<br/></a>Our&#160;observations&#160;demonstrates&#160;few&#160;utilization&#160;of&#160;this&#160;tactic&#160;<a href="1811.01190v1s.html#26">[21].</a><br/>
3.2.1.5<br/>
Mining&#160;NtQuerySystemInformation<br/>
The&#160;ntdll&#160;NtQuerySystem-<br/>
Information()&#160;is&#160;a&#160;function&#160;that&#160;accepts&#160;a&#160;parameter&#160;which&#160;is&#160;the&#160;class&#160;of&#160;infor-<br/>mation&#160;to&#160;query&#160;<a href="1811.01190v1s.html#26">[25].&#160;</a>Most&#160;of&#160;these&#160;classes&#160;are&#160;not&#160;documented.&#160;There&#160;are&#160;many<br/>ways&#160;malware&#160;might&#160;pursue&#160;to&#160;leverage&#160;this&#160;function&#160;with&#160;the&#160;goal&#160;of&#160;spotting<br/>
9<br/>
<hr/>
<a name=10></a>debugger’s&#160;signs.&#160;Debugger&#160;is&#160;easily&#160;exposed,&#160;for&#160;instance,&#160;if&#160;the&#160;malware&#160;passes<br/>the&#160;SystemKernelDebuggerInformation()&#160;(0x23)&#160;class&#160;as&#160;the&#160;parameter&#160;to&#160;this<br/>function,&#160;the&#160;returned&#160;values&#160;are&#160;two&#160;flags;&#160;one&#160;of&#160;them&#160;is&#160;KdDebuggerNotPre-<br/>sent(),&#160;if&#160;the&#160;value&#160;equals&#160;zero,&#160;it&#160;attests&#160;debuggers&#160;presence.&#160;Employment&#160;of<br/>this&#160;tactic&#160;is&#160;not&#160;simple&#160;(more&#160;than&#160;40&#160;lines&#160;of&#160;assembly&#160;code&#160;<a href="1811.01190v1s.html#26">[25]),&#160;</a>and&#160;nor&#160;is<br/>circumventing&#160;it.&#160;The&#160;reason&#160;is&#160;that&#160;when&#160;this&#160;function&#160;is&#160;invoked,&#160;the&#160;returned<br/>values&#160;are&#160;coming&#160;from&#160;the&#160;kernel.&#160;Defeating&#160;anti-debugging&#160;techniques&#160;follow-<br/>ing&#160;this&#160;tactic&#160;requires&#160;patching&#160;the&#160;kernel.&#160;vti-rescan&#160;<a href="1811.01190v1s.html#27">[43],&#160;</a>Wdf01000.sys&#160;<a href="1811.01190v1s.html#27">[44],<br/></a>and&#160;Inkasso&#160;trojaner&#160;<a href="1811.01190v1s.html#28">[45]&#160;</a>are&#160;some&#160;instances&#160;that&#160;leverage&#160;this&#160;tactic.<br/>
As&#160;stated&#160;earlier,&#160;deployment&#160;of&#160;direct&#160;detection&#160;tactics&#160;is&#160;relatively&#160;straight-<br/>
forward&#160;and&#160;trivial&#160;which&#160;in&#160;turn&#160;are&#160;often&#160;just&#160;as&#160;trivial&#160;to&#160;defeat.&#160;more&#160;subtle<br/>way&#160;of&#160;detecting&#160;and&#160;evading&#160;debuggers&#160;is&#160;through&#160;deductive&#160;detection&#160;which&#160;is<br/>the&#160;subject&#160;of&#160;the&#160;next&#160;section<br/>
3.2.2<br/>
Deductive&#160;Detection<br/>
Tactics&#160;under&#160;this&#160;category&#160;fulfill&#160;the&#160;goal&#160;of&#160;inferring&#160;debuggers&#160;presence,&#160;rather<br/>than&#160;directly&#160;observing&#160;it.&#160;Tactics&#160;of&#160;this&#160;category&#160;calculate&#160;and&#160;assess&#160;the<br/>probability&#160;of&#160;debugger’s&#160;presence.&#160;These&#160;inferences&#160;mostly&#160;rely&#160;on&#160;exploiting<br/>the&#160;logic&#160;of&#160;the&#160;system&#160;(e.g.&#160;SEH&#160;Exception&#160;handling&#160;<a href="1811.01190v1s.html#28">[46]).&#160;</a>More&#160;specifically,<br/>as&#160;a&#160;way&#160;of&#160;illustration,&#160;the&#160;way&#160;Windows&#160;handles&#160;exceptions&#160;can&#160;be&#160;abused&#160;by<br/>malware&#160;to&#160;illicit&#160;debugger&#160;presence).&#160;Malware&#160;may&#160;employ&#160;different&#160;ingenious<br/>tactics&#160;to&#160;this&#160;end&#160;which&#160;we&#160;explore&#160;in&#160;the&#160;following.<br/>
3.2.2.1<br/>
Traps<br/>
Not&#160;to&#160;be&#160;mistaken&#160;with&#160;the&#160;trap&#160;flags,&#160;we&#160;define&#160;this&#160;cate-<br/>
gory&#160;of&#160;tactics&#160;as&#160;“traps”.&#160;Following&#160;this&#160;tactic,&#160;the&#160;malware&#160;provisions&#160;codes<br/>that&#160;when&#160;traversed&#160;or&#160;stepped&#160;through&#160;by&#160;debugger,&#160;production&#160;of&#160;specific<br/>information&#160;or&#160;lack&#160;thereof,&#160;would&#160;help&#160;the&#160;malware&#160;deduce&#160;the&#160;presence&#160;of&#160;a<br/>debugger.&#160;Many&#160;techniques&#160;fit&#160;this&#160;category&#160;and&#160;we&#160;elaborate&#160;a&#160;couple&#160;of&#160;them<br/>here&#160;and&#160;hint&#160;at&#160;the&#160;rest&#160;in&#160;table&#160;1.<br/>
One&#160;technique&#160;by&#160;which&#160;malware&#160;beguile&#160;debuggers&#160;to&#160;disclose&#160;cues&#160;of&#160;its<br/>
presence&#160;is&#160;using&#160;specific&#160;instructions&#160;and&#160;exploiting&#160;the&#160;logic&#160;of&#160;how&#160;these&#160;in-<br/>structions&#160;are&#160;handled.&#160;The&#160;handling&#160;is&#160;performed&#160;through&#160;Structured&#160;Excep-<br/>tion&#160;Handling&#160;SEH&#160;(You&#160;can&#160;refer&#160;<a href="1811.01190v1s.html#28">to[46]&#160;</a>for&#160;more&#160;information&#160;about&#160;SEH&#160;).&#160;For<br/>instance,&#160;Max++&#160;malware&#160;<a href="1811.01190v1s.html#28">[47]&#160;</a>embeds&#160;“int&#160;2dh”&#160;instruction&#160;within&#160;its&#160;code.<br/>According&#160;to&#160;SEH,&#160;when&#160;this&#160;instruction&#160;is&#160;executed,&#160;in&#160;normal&#160;situation&#160;i.e.<br/>absence&#160;of&#160;debugger,&#160;an&#160;exception&#160;is&#160;raised&#160;and&#160;malware&#160;can&#160;handle&#160;it&#160;via&#160;a<br/>try-catch&#160;structure.&#160;However,&#160;if&#160;a&#160;debugger&#160;is&#160;attached,&#160;this&#160;exception&#160;will&#160;be<br/>transferred&#160;to&#160;the&#160;debugger&#160;rather&#160;than&#160;the&#160;malware;&#160;the&#160;absence&#160;of&#160;expected<br/>exception&#160;is&#160;the&#160;logic&#160;that&#160;the&#160;malware&#160;entertains&#160;to&#160;deduce&#160;the&#160;presence&#160;of<br/>a&#160;debugger.&#160;Malware&#160;may&#160;employ&#160;other&#160;techniques&#160;to&#160;lay&#160;their&#160;traps&#160;such&#160;as<br/>embedding&#160;specific&#160;instruction&#160;prefixes&#160;<a href="1811.01190v1s.html#26">[26],&#160;</a>or&#160;other&#160;instructions&#160;such&#160;as&#160;41h<br/><a href="1811.01190v1s.html#26">[25].&#160;</a>These&#160;techniques&#160;are&#160;of&#160;low&#160;complexity&#160;and&#160;can&#160;be&#160;implemented&#160;with&#160;less<br/>than&#160;20&#160;lines&#160;of&#160;code&#160;(in&#160;assembly).&#160;One&#160;way&#160;of&#160;countering&#160;these&#160;traps&#160;requires<br/>debuggers&#160;to&#160;skip&#160;these&#160;instructions.&#160;According&#160;to&#160;our&#160;survey,&#160;utilizing&#160;traps&#160;is<br/>a&#160;fairly&#160;common&#160;approach&#160;<a href="1811.01190v1s.html#26">[21].</a><br/>
10<br/>
<hr/>
<a name=11></a>3.2.2.2<br/>
Timing-Based&#160;Detection<br/>
Timing-based&#160;detection&#160;are&#160;among&#160;the<br/>
most&#160;efficacious&#160;tactics&#160;of&#160;inferring&#160;debugger’s&#160;presence.&#160;Adroit&#160;employment&#160;of<br/>this&#160;tactic&#160;reliably&#160;exposes&#160;the&#160;presence&#160;of&#160;a&#160;debugger&#160;and&#160;circumventing&#160;them<br/>is&#160;an&#160;arduous&#160;task.<br/>
The&#160;logic&#160;behind&#160;this&#160;tactic&#160;follows&#160;malware&#160;authors’&#160;presumption&#160;that&#160;a<br/>
particular&#160;function&#160;or&#160;instruction&#160;set,&#160;require&#160;merely&#160;a&#160;minuscule&#160;amount&#160;of<br/>time.&#160;Thus,&#160;if&#160;a&#160;predefined&#160;threshold&#160;is&#160;surpassed,&#160;malware&#160;would&#160;infer&#160;the<br/>presence&#160;of&#160;a&#160;debugger.&#160;Timing-based&#160;detection&#160;can&#160;be&#160;carried&#160;out&#160;either&#160;locally<br/>with&#160;the&#160;aid&#160;of&#160;local&#160;APIs(GetTickCount(),&#160;QueryPerformanceCounter(),&#160;etc.<br/><a href="1811.01190v1s.html#28">[48])&#160;</a>or&#160;CPU&#160;rdtsc&#160;(read&#160;time&#160;stamp&#160;counter)&#160;or&#160;can&#160;be&#160;performed&#160;by&#160;inquiring<br/>an&#160;external&#160;resource&#160;through&#160;the&#160;network&#160;<a href="1811.01190v1s.html#28">[49]&#160;</a>to&#160;conduct&#160;the&#160;timing.&#160;Local<br/>timing&#160;is&#160;simple&#160;to&#160;employ&#160;and&#160;difficult&#160;to&#160;circumvent.&#160;Countering&#160;timing-based<br/>detection&#160;conducted&#160;with&#160;the&#160;aid&#160;of&#160;external&#160;resource&#160;(using&#160;NTP&#160;or&#160;tunneled<br/>NTP),&#160;however,&#160;is&#160;still&#160;an&#160;open&#160;problem&#160;<a href="1811.01190v1s.html#27">[28].&#160;</a>W32/HIV&#160;<a href="1811.01190v1s.html#28">[50],&#160;</a>W32/MyDoom<br/><a href="1811.01190v1s.html#28">[51],&#160;</a>W32/Ratos&#160;<a href="1811.01190v1s.html#28">[52]&#160;</a>are&#160;infamous&#160;malware&#160;that&#160;are&#160;known&#160;to&#160;have&#160;exploited<br/>the&#160;timing&#160;discrepancies.<br/>
3.2.3<br/>
Debugger&#160;Escaping<br/>
Unlike&#160;previous&#160;categories&#160;the&#160;goal&#160;of&#160;which,&#160;were&#160;detecting&#160;or&#160;inferring&#160;de-<br/>bugger’s&#160;presence,&#160;the&#160;goal&#160;of&#160;this&#160;category&#160;is&#160;assuring&#160;that&#160;the&#160;execution&#160;of<br/>malware&#160;wholly&#160;or&#160;partially&#160;takes&#160;place.&#160;Malware&#160;adopt&#160;catching&#160;approaches&#160;to<br/>fulfill&#160;the&#160;goal&#160;of&#160;this&#160;strategy.&#160;We&#160;will&#160;have&#160;a&#160;survey&#160;on&#160;tactics&#160;of&#160;this&#160;category<br/>in&#160;the&#160;following.<br/>
3.2.3.1<br/>
Control&#160;Flow&#160;Manipulation<br/>
Through&#160;this&#160;tactic,&#160;malware&#160;ex-<br/>
ploit&#160;the&#160;implicit&#160;flow&#160;control&#160;mechanism&#160;conducted&#160;by&#160;Windows&#160;OS.&#160;To&#160;im-<br/>plement&#160;these&#160;techniques,&#160;malware&#160;authors&#160;often&#160;rely&#160;on&#160;callbacks,&#160;enumeration<br/>functions,&#160;thread&#160;local&#160;storage&#160;(TLS&#160;),&#160;etc.&#160;<a href="1811.01190v1s.html#26">[25,&#160;</a><a href="1811.01190v1s.html#27">29].&#160;</a>There&#160;are&#160;several&#160;notewor-<br/>thy&#160;techniques&#160;that&#160;fulfill&#160;the&#160;goals&#160;of&#160;“debugger&#160;Escaping”&#160;and&#160;each&#160;deserves<br/>a&#160;brief&#160;introduction.<br/>
•&#160;Thread-hiding:A&#160;simple&#160;and&#160;effective&#160;technique&#160;is&#160;thread-hiding&#160;which<br/>
if&#160;used,&#160;prevents&#160;debugging&#160;events&#160;from&#160;reaching&#160;debugger.<br/>
Microsoft<br/>
has&#160;provisioned&#160;special&#160;API&#160;<a href="1811.01190v1s.html#28">[53,&#160;54].</a><br/>
This&#160;technique&#160;uses&#160;NtSetInfor-<br/>
mationThread()&#160;function&#160;to&#160;set&#160;the&#160;field&#160;HideThreadFromDebugger()&#160;of<br/>ETHREAD&#160;kernel&#160;structure&#160;<a href="1811.01190v1s.html#27">[27].&#160;</a>This&#160;is&#160;a&#160;powerful&#160;technique&#160;and&#160;simple<br/>to&#160;implement&#160;and&#160;can&#160;be&#160;countered&#160;by&#160;hooking&#160;the&#160;involving&#160;functions.<br/>LockScreen&#160;<a href="1811.01190v1s.html#28">[54]&#160;</a>is&#160;an&#160;instance&#160;known&#160;to&#160;have&#160;utilized&#160;this&#160;technique.<br/>
•&#160;Suspending&#160;Threads:&#160;A&#160;more&#160;aggressive&#160;way&#160;malware&#160;might&#160;step&#160;into&#160;is<br/>
striving&#160;to&#160;halt&#160;the&#160;process&#160;of&#160;the&#160;debugger&#160;to&#160;continue&#160;its&#160;own&#160;execution<br/>with&#160;little&#160;trouble.<br/>
This&#160;technique&#160;can&#160;be&#160;effective&#160;against&#160;only&#160;user-<br/>
mode&#160;debuggers&#160;and&#160;can&#160;be&#160;carried&#160;out&#160;by&#160;leveraging&#160;SuspendThread()&#160;or<br/>NtSuspendThread()&#160;from&#160;ntdll&#160;<a href="1811.01190v1s.html#26">[21].&#160;</a>Suspending&#160;threads&#160;is&#160;one&#160;of&#160;the&#160;anti-<br/>debugging&#160;techniques&#160;that&#160;Kronos&#160;banking&#160;malware&#160;used&#160;in&#160;its&#160;arsenal<br/><a href="1811.01190v1s.html#27">[37].</a><br/>
11<br/>
<hr/>
<a name=12></a>•&#160;Multi-threading:&#160;Another&#160;technique&#160;to&#160;bypass&#160;debuggers&#160;and&#160;continue<br/>
the&#160;execution&#160;is&#160;multi-threading.&#160;One&#160;way&#160;to&#160;implement&#160;it&#160;through&#160;Cre-<br/>ateThread()&#160;API.&#160;Malware&#160;that&#160;is&#160;packed,&#160;often&#160;spawns&#160;a&#160;separate&#160;thread<br/>within&#160;their&#160;process&#160;to&#160;perform&#160;the&#160;decryption&#160;routines&#160;<a href="1811.01190v1s.html#27">[27].&#160;</a>However,<br/>there&#160;are&#160;instances&#160;where&#160;malware&#160;executes&#160;a&#160;part&#160;of&#160;its&#160;malicious&#160;code<br/>through&#160;a&#160;different&#160;thread&#160;outside&#160;the&#160;debugger.&#160;McRat&#160;<a href="1811.01190v1s.html#28">[55]&#160;</a>and&#160;Ver-<br/>texnet&#160;<a href="1811.01190v1s.html#28">[56]&#160;</a>have&#160;incorporated&#160;such&#160;technique.&#160;Countering&#160;this&#160;technique<br/>is&#160;tricky.&#160;One&#160;way&#160;is&#160;to&#160;set&#160;breakpoints&#160;at&#160;every&#160;entry&#160;point&#160;<a href="1811.01190v1s.html#28">[57,&#160;58].</a><br/>
•&#160;Self-debugging:&#160;Self-debugging&#160;is&#160;an&#160;interesting&#160;technique&#160;which&#160;prevents<br/>
the&#160;debugger&#160;from&#160;successfully&#160;attaching&#160;to&#160;the&#160;malware&#160;<a href="1811.01190v1s.html#28">[59].&#160;</a>By&#160;default,<br/>each&#160;process&#160;can&#160;be&#160;attached&#160;to&#160;merely&#160;one&#160;debugger.&#160;Malware&#160;exploits<br/>this&#160;by&#160;running&#160;a&#160;copy&#160;of&#160;itself&#160;and&#160;attaches&#160;to&#160;it&#160;as&#160;a&#160;debugger.&#160;Hence<br/>preventing&#160;another&#160;debugger&#160;to&#160;own&#160;it.&#160;There&#160;are&#160;several&#160;ways&#160;to&#160;imple-<br/>ment&#160;this&#160;tactic,&#160;for&#160;instance&#160;by&#160;leveraging&#160;DbgUiDebugActiveProcess()&#160;or<br/>NtDebugActiveProcess().<br/>
Collectively,&#160;debugger&#160;escaping&#160;techniques&#160;are&#160;not&#160;much&#160;common&#160;among&#160;the<br/>samples&#160;we&#160;have&#160;observed.<br/>
3.2.3.2<br/>
Lockout&#160;evasion<br/>
In&#160;Lockout&#160;tactic,&#160;malware&#160;accomplishes&#160;the&#160;goal<br/>
of&#160;continuing&#160;its&#160;execution&#160;by&#160;impeding&#160;with&#160;the&#160;working&#160;of&#160;the&#160;debugger.&#160;Mal-<br/>ware&#160;achieve&#160;this&#160;through&#160;several&#160;techniques.&#160;One&#160;is&#160;to&#160;opt&#160;for&#160;BlockInput()<br/>function&#160;as&#160;in&#160;the&#160;case&#160;of&#160;Satan&#160;RaaS&#160;<a href="1811.01190v1s.html#27">[38],&#160;</a>through&#160;which&#160;malware&#160;prevents<br/>mouse&#160;and&#160;keyboard&#160;inputs&#160;until&#160;its&#160;conditions&#160;are&#160;satisfied.&#160;Other&#160;techniques<br/>involve&#160;exploiting&#160;a&#160;feature&#160;in&#160;Windows&#160;NT-based&#160;platforms&#160;that&#160;allow&#160;for&#160;the<br/>existence&#160;of&#160;multiple&#160;desktops.&#160;Malware,&#160;such&#160;as&#160;LockScreen,&#160;<a href="1811.01190v1s.html#28">[54]&#160;</a>with&#160;the&#160;help<br/>of&#160;CreateDesktop()&#160;followed&#160;by&#160;SwitchDesktop()&#160;can&#160;select&#160;a&#160;different&#160;active<br/>desktop&#160;and&#160;continue&#160;its&#160;working&#160;unbeknownst&#160;to&#160;the&#160;debugger&#160;<a href="1811.01190v1s.html#28">[58].</a><br/>
3.2.3.3<br/>
Debugger&#160;Specific<br/>
Debugger&#160;specific&#160;evasion&#160;exploit&#160;vulnerabili-<br/>
ties&#160;that&#160;are&#160;exclusive&#160;to&#160;a&#160;specific&#160;debugger.&#160;These&#160;vulnerabilities&#160;are&#160;difficult<br/>to&#160;discover,&#160;but&#160;simple&#160;to&#160;put&#160;into&#160;action.&#160;A&#160;famous&#160;instance&#160;pertains&#160;to&#160;Olly-<br/>DBG&#160;<a href="1811.01190v1s.html#27">[27].&#160;</a>Regular&#160;versions&#160;of&#160;this&#160;debugger&#160;have&#160;a&#160;format&#160;string&#160;bug&#160;which&#160;can<br/>be&#160;exploited&#160;to&#160;cause&#160;it&#160;to&#160;crash&#160;by&#160;passing&#160;an&#160;improper&#160;parameter&#160;to&#160;OutPut-<br/>DebugString()&#160;function.&#160;Another&#160;pervasive-at-the-time&#160;technique&#160;was&#160;related<br/>to&#160;SoftICE&#160;debugger&#160;which&#160;was&#160;susceptible&#160;to&#160;multiple&#160;DoS&#160;attacks&#160;due&#160;to&#160;two<br/>vulnerable&#160;function&#160;<a href="1811.01190v1s.html#28">[58].&#160;</a>Malware&#160;like&#160;<a href="1811.01190v1s.html#28">[60]&#160;</a>exploited&#160;these&#160;vulnerabilities&#160;would<br/>cause&#160;the&#160;”bluescreen&#160;of&#160;death.&#160;SoftICE&#160;is&#160;no&#160;longer&#160;supported&#160;and&#160;the&#160;dll<br/>file&#160;that&#160;caused&#160;the&#160;vulnerability&#160;in&#160;OllyDBG&#160;is&#160;now&#160;fixed.&#160;But&#160;the&#160;idea&#160;still<br/>remains,&#160;if&#160;a&#160;vulnerability&#160;within&#160;a&#160;specific&#160;debugger&#160;is&#160;discovered,&#160;exploiting&#160;it<br/>would&#160;be&#160;a&#160;potent&#160;anti-debugging&#160;technique.&#160;Table&#160;1&#160;summarizes&#160;the&#160;results&#160;of<br/>our&#160;study.<br/>
3.2.3.4<br/>
Fileless&#160;malware<br/>
Fileless&#160;malware,&#160;non-malware&#160;and&#160;occasionally<br/>
called&#160;Advanced&#160;Volatile&#160;Attack&#160;(AVT)&#160;attacks,&#160;are&#160;the&#160;latest&#160;trend&#160;in&#160;the<br/>
12<br/>
<hr/>
<a name=13></a>evolution&#160;of&#160;malware.&#160;<a href="1811.01190v1s.html#28">[61].&#160;</a>In&#160;contrast&#160;to&#160;all&#160;prior&#160;existence&#160;of&#160;malware,&#160;fileless<br/>malware&#160;requires&#160;no&#160;file&#160;to&#160;operate&#160;and&#160;they&#160;purely&#160;reside&#160;in&#160;memory&#160;and&#160;take<br/>advantage&#160;of&#160;existing&#160;system&#160;tools&#160;e.g.&#160;powershell&#160;<a href="1811.01190v1s.html#28">[62].</a><br/>
The&#160;purpose&#160;of&#160;such&#160;attacks&#160;is&#160;to&#160;make&#160;the&#160;forensics&#160;much&#160;harder.&#160;To&#160;analyze<br/>
a&#160;malware&#160;is&#160;to&#160;analyze&#160;its&#160;executable;&#160;and&#160;in&#160;fileless&#160;malware,&#160;there&#160;is&#160;no<br/>executable&#160;to&#160;begin&#160;with.&#160;In&#160;some&#160;cases&#160;such&#160;as&#160;SamSam&#160;<a href="1811.01190v1s.html#28">[63]&#160;</a>the&#160;only&#160;way&#160;to<br/>just&#160;retrieve&#160;a&#160;sample&#160;for&#160;analysis&#160;would&#160;be&#160;to&#160;catch&#160;the&#160;attack&#160;taking&#160;place&#160;live.<br/>These&#160;attacks&#160;inherently&#160;are&#160;not&#160;easy&#160;to&#160;conduct,&#160;but,&#160;with&#160;the&#160;help&#160;of&#160;exploit-<br/>kits&#160;are&#160;more&#160;readily&#160;available.&#160;A&#160;2018&#160;report&#160;by&#160;McAfee&#160;shows&#160;a&#160;432%&#160;increase<br/>of&#160;fileless&#160;malware&#160;in&#160;2017&#160;<a href="1811.01190v1s.html#28">[64]&#160;</a>and&#160;projected&#160;to&#160;constitute&#160;35%&#160;of&#160;attacks&#160;in<br/>2018&#160;<a href="1811.01190v1s.html#28">[65].</a><br/>
With&#160;the&#160;aid&#160;of&#160;debuggers,&#160;the&#160;analyst&#160;can&#160;overcome&#160;many&#160;hurdles&#160;and&#160;lim-<br/>
itations&#160;of&#160;static&#160;analysis&#160;in&#160;the&#160;manual&#160;dynamic&#160;analysis.&#160;However,&#160;new&#160;trends<br/>and&#160;real&#160;world&#160;scenarios&#160;in&#160;which&#160;the&#160;vendors&#160;face&#160;thousands&#160;of&#160;new&#160;malware<br/>samples&#160;daily&#160;demands&#160;a&#160;more&#160;agile&#160;approach&#160;which&#160;is&#160;beyond&#160;the&#160;capabilities<br/>of&#160;manual&#160;dynamic&#160;analysis.&#160;In&#160;the&#160;next&#160;section,&#160;we&#160;discuss&#160;the&#160;emergence&#160;of<br/>automated&#160;dynamic&#160;analysis&#160;approach&#160;and&#160;Sandboxes&#160;as&#160;a&#160;response&#160;to&#160;these<br/>challenges&#160;and&#160;elaborate&#160;malware’s&#160;tactics&#160;to&#160;thwart&#160;them.&#160;Table&#160;1&#160;summarizes<br/>our&#160;survey&#160;of&#160;manual&#160;dynamic&#160;evasion&#160;techniques.<br/>
3.3<br/>
A&#160;Discussion<br/>
In&#160;table&#160;1&#160;we&#160;summarize&#160;our&#160;survey&#160;on&#160;malware&#160;manual&#160;dynamic&#160;analysis&#160;eva-<br/>sion.&#160;In&#160;this&#160;table,&#160;we&#160;compare&#160;the&#160;techniques&#160;based&#160;on&#160;three&#160;criteria&#160;i.e.&#160;com-<br/>plexity&#160;of&#160;implementation,&#160;resistance&#160;against&#160;manual&#160;dynamic&#160;analysis,&#160;and<br/>pervasiveness.&#160;In&#160;addition,&#160;in&#160;the&#160;example&#160;column&#160;we&#160;provide&#160;malware&#160;samples<br/>that&#160;incorporate&#160;the&#160;corresponding&#160;techniques.<br/>
Manual&#160;dynamic&#160;analysis&#160;evasion,&#160;or&#160;anti-debugging&#160;is&#160;as&#160;old&#160;as&#160;the&#160;existence<br/>
of&#160;software.&#160;What&#160;we&#160;have&#160;observed&#160;in&#160;the&#160;last&#160;decade,&#160;attest&#160;that&#160;incorporation<br/>of&#160;anti-debugging&#160;is&#160;prevalent&#160;and&#160;has&#160;been&#160;steadily&#160;increasing.&#160;Authors&#160;in&#160;<a href="1811.01190v1s.html#29">[66]<br/></a>demonstrate&#160;that&#160;on&#160;average,&#160;more&#160;than&#160;70&#160;of&#160;malware&#160;samples&#160;utilize&#160;anti-<br/>debugging&#160;techniques.&#160;The&#160;majority&#160;of&#160;these&#160;techniques&#160;are&#160;the&#160;ones&#160;we&#160;have<br/>covered&#160;in&#160;this&#160;section.<br/>
In&#160;addition,&#160;we&#160;have&#160;noticed&#160;that&#160;besides&#160;the&#160;very<br/>
pervasive&#160;techniques&#160;such&#160;as&#160;IsDebuggerPresent,&#160;malware&#160;are&#160;also&#160;employing<br/>more&#160;timing-based&#160;techniques.<br/>
Another&#160;emerging&#160;trend&#160;in&#160;malware&#160;industry,&#160;is&#160;fileless&#160;malware.&#160;Such&#160;mal-<br/>
ware&#160;as&#160;in&#160;the&#160;case&#160;of&#160;Rozena&#160;<a href="1811.01190v1s.html#29">[67]&#160;</a>leverages&#160;exploits&#160;to&#160;execute&#160;malicious&#160;com-<br/>mands&#160;right&#160;from&#160;the&#160;memory.&#160;Given&#160;the&#160;difficulties&#160;of&#160;acquiring&#160;samples&#160;in<br/>post-infection&#160;phase&#160;and&#160;the&#160;fact&#160;that&#160;they&#160;reside&#160;merely&#160;in&#160;memory,&#160;perhaps<br/>we&#160;can&#160;conclude&#160;that&#160;fileless&#160;or&#160;AVT&#160;attack&#160;is&#160;the&#160;most&#160;effective&#160;manual&#160;dynamic<br/>analysis&#160;evasion&#160;tactic.<br/>
13<br/>
<hr/>
<a name=14></a>Table&#160;1:&#160;Classification&#160;and&#160;comparison&#160;of&#160;malware&#160;anti-debugging&#160;techniques<br/>
<b>&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160; &#160; &#160; &#160; &#160; &#160;&#160;&#160;Criteria&#160;</b><br/>
<b>&#160; &#160;&#160;&#160;&#160;</b><br/>
<b>Countermeasure&#160;</b><br/>
<b>Malware&#160;</b><br/>
<b>Complexity&#160;Resistance&#160;&#160;</b><br/>
<b>Pervasiveness&#160;</b><br/>
&#160;<br/>
<b>Tactic&#160;</b><br/>
<b>Sample&#160;</b><br/>
<b>Cat.&#160;</b><br/>
<b>Tactic&#160;</b><br/>
<b>&#160; &#160;&#160;Technique&#160;</b><br/>
&#160;<br/>
IsDebuggerPresent()&#160;<br/>
Set&#160;the&#160;Beingdebugged&#160;flag&#160;to&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
CheckRemoteDebuggerPresent()&#160;<br/>
zero&#160;<br/>
&#160;<br/>
Set&#160;heap_groawable glag&#160;for&#160;<br/>
Very&#160;&#160;<br/>
Reading&#160;<br/>
ProcessHeap()&#160;<br/>
Medium&#160;<br/>
Low&#160;<br/>
[35,&#160;36]&#160;<br/>
&#160;flags field&#160;and&#160;forceflags to&#160;0&#160;<br/>
high&#160;<br/>
PEB&#160;<br/>
Attach&#160;debugger&#160;after process&#160;<br/>
NtGlobalFlags()&#160;<br/>
Low&#160;<br/>
Medium&#160;<br/>
creation,&#160;<br/>
&#160;<br/>
Self-scan&#160;to&#160;spot&#160;INT&#160;3&#160;instruction&#160;<br/>
Set&#160;breakpoint&#160;in&#160;the&#160;first&#160;byte of&#160;<br/>
<b>&#160;</b><br/>
Low&#160;<br/>
Medium&#160;<br/>
[38]&#160;<br/>
Self-integrity-check&#160;<br/>
thread&#160;<br/>
<b>tion</b><br/>
Detecting&#160;<br/>
Reset&#160;<br/>
<b>ec</b><br/>
Breakpoints&#160;<br/>
the&#160;context_debug_registers&#160;flag&#160;<br/>
High&#160;<br/>
Read&#160;DR Registers&#160;&#160;<br/>
<b>et&#160;</b>&#160;<br/>
Low&#160;<br/>
Medium&#160;<br/>
&#160;in&#160;the&#160;contextflags&#160;before/after&#160;<br/>
[22,&#160;38]&#160;<br/>
(GetThreadContext()&#160;etc.)&#160;<br/>
Original&#160;ntgetcontextthread&#160;&#160;<br/>
<b>ct&#160;D</b><br/>
function&#160;call&#160;<br/>
<b>ire&#160;</b>&#160;<br/>
FindWindow(),&#160;<br/>
<b>D</b><br/>
System&#160;<br/>
FindProcess(),&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
Randomizing&#160;variables&#160;<br/>
Low&#160;<br/>
[39]&#160;<br/>
Artifacts&#160;<br/>
FindFirstFile()&#160;<br/>
&#160;<br/>
Mining&#160;<br/>
ProcessDebugObjectHandle()&#160;<br/>
Modify&#160;process&#160;states&#160;after&#160;<br/>
[41,&#160;42,&#160;<br/>
NTQuery&#160;<br/>
ProcessDebugFlags()&#160;<br/>
Medium&#160;<br/>
High&#160;<br/>
Medium&#160;<br/>
&#160;calling/skipping&#160;these&#160;API&#160;<br/>
43]&#160;<br/>
Object&#160;<br/>
ProcessBasicInformation()&#160;<br/>
&#160;<br/>
GetCurrentProcessId()&#160;+&#160;<br/>
Parent&#160;Check&#160;<br/>
CreateToolhelp32Snapshot()+&#160;<br/>
Medium&#160;<br/>
Medium&#160;<br/>
API&#160;hook&#160;<br/>
Low&#160;<br/>
[39]&#160;<br/>
(Process32First())+Process32Next()&#160;<br/>
&#160;<br/>
Instruction&#160;Prefix&#160;&#160;(Rep)&#160;<br/>
High&#160;<br/>
Medium&#160;<br/>
Set&#160;breakpoint&#160;on&#160;exception&#160;<br/>
<b>&#160;</b><br/>
handler,&#160;<br/>
Allow&#160;single-step/breakpoint&#160;<br/>
<b>tion</b><br/>
Traps&#160;<br/>
Interrupt&#160;3,&#160;0x2D&#160;<br/>
Low&#160;<br/>
High&#160;<br/>
High&#160;<br/>
[45]&#160;<br/>
exceptions to&#160;be&#160;automatically&#160;<br/>
<b>tec</b><br/>
passed&#160;to&#160;the&#160;exception&#160;<br/>
Interrupt&#160;0x41&#160;<br/>
Low&#160;<br/>
High&#160;<br/>
&#160;handler&#160;&#160;<br/>
Local&#160;Resource:&#160;RDTSC&#160;<br/>
Kernel&#160;patch&#160;to&#160;prevent&#160;access&#160;to&#160;<br/>
<b>ive De</b><br/>
timeGetTime(),&#160;GetTickCount(),&#160;<br/>
rdtsc&#160;outside&#160;privilege&#160;mode,&#160;<br/>
Timing-<br/>
QueryPerformanceCounter&#160;<br/>
Low&#160;<br/>
High&#160;<br/>
Maintain&#160;high-fidelity&#160;time&#160;<br/>
[48,&#160;49,&#160;<br/>
<b>educt</b><br/>
Based&#160;<br/>
GetLocalTime()&#160;<br/>
source,&#160;<br/>
Medium&#160;<br/>
50]&#160;<br/>
<b>D</b><br/>
Detection&#160;<br/>
GetSystemTime()&#160;<br/>
Skip&#160;time-checking&#160;APIs&#160;&#160;<br/>
Query&#160;external&#160;time&#160;source&#160;(e.g.&#160;NTP)&#160;<br/>
Medium&#160;<br/>
N/A&#160;<br/>
None,&#160;open&#160;problem&#160;&#160;<br/>
DebugActiveProcess()&#160;<br/>
Self&#160;<br/>
DbgUiDebugActiveProcess()&#160;&#160;Medium&#160;<br/>
Low&#160;<br/>
Set&#160;debug&#160;port&#160;to&#160;0&#160;&#160;<br/>
[52]&#160;<br/>
Debugging&#160;&#160;NtDebugActiveProcess()&#160;<br/>
<b>&#160;</b><br/>
Suspend&#160;<br/>
SuspendThread()&#160;<br/>
<b>g&#160;</b>Control&#160;Flow&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
N/A&#160;<br/>
Low&#160;<br/>
[35]&#160;<br/>
<b>n&#160;</b>Manipulation&#160;&#160;Thread&#160;<br/>
NtSuspendThread()&#160;<br/>
&#160;<br/>
Thread&#160;<br/>
NtSetInformationThread()&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
Skip&#160;the&#160;APIs&#160;<br/>
[52]&#160;<br/>
<b>capi</b><br/>
Hiding&#160;<br/>
ZwSetInformationThread()&#160;<br/>
Multi-<br/>
CreateThread()&#160;<br/>
Medium&#160;<br/>
Low&#160;<br/>
Set&#160;breakpoint&#160;at&#160;every&#160;entry&#160;<br/>
[53,&#160;54]&#160;<br/>
threading&#160;<br/>
Lockout&#160;<br/>
BlockInput(),&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
Skip&#160;APIs&#160;<br/>
Low&#160;<br/>
[33,&#160;47]&#160;<br/>
Evasion&#160;<br/>
SwitchDesktop()&#160;<br/>
<b>ebugger Es</b><br/>
Patch&#160;entry&#160;of&#160;<br/>
<b>D</b><br/>
OllyDBG:&#160;InputDebugString()&#160;<br/>
Low&#160;<br/>
High&#160;<br/>
Low&#160;<br/>
Debugger&#160;<br/>
kernel32!outputdebugstring()&#160;<br/>
[58]&#160;<br/>
Specific&#160;<br/>
Set&#160;breakpoint&#160;inside&#160;<br/>
SoftICE&#160;Interrupt&#160;1&#160;<br/>
Low&#160;<br/>
High&#160;<br/>
Medium&#160;<br/>
kernel32!createfilefilew()&#160;<br/>
Fileless&#160;<br/>
Web-based&#160;exploits&#160;&#160;<br/>
High&#160;<br/>
Very&#160;High&#160;<br/>
N/A&#160;<br/>
Low&#160;<br/>
[61]&#160;<br/>
(AVT)&#160;<br/>
System-level&#160;exploits&#160;<br/>
&#160;<br/>
14<br/>
<hr/>
<a name=15></a>4<br/>
Automated&#160;Dynamic&#160;Analysis&#160;Evasion<br/>
Although&#160;effective,&#160;the&#160;manual&#160;dynamic&#160;analysis&#160;suffers&#160;a&#160;critical&#160;limitation,<br/>that&#160;is,&#160;time.&#160;A&#160;2018&#160;statistics&#160;provided&#160;by&#160;McAfee&#160;reports&#160;on&#160;receiving&#160;more<br/>than&#160;600K&#160;new&#160;samples&#160;each&#160;day&#160;<a href="1811.01190v1s.html#29">[68].&#160;</a>Analyzing&#160;this&#160;massive&#160;number&#160;of&#160;mal-<br/>ware&#160;samples&#160;calls&#160;for&#160;a&#160;far&#160;more&#160;agile&#160;approach.&#160;This&#160;demand&#160;led&#160;to&#160;a&#160;new<br/>paradigm&#160;of&#160;analysis&#160;which&#160;we&#160;referred&#160;to&#160;as&#160;automated&#160;dynamic&#160;analysis.&#160;Sand-<br/>box,&#160;is&#160;the&#160;representative&#160;technology&#160;for&#160;this&#160;paradigm.&#160;In&#160;this&#160;section,&#160;we&#160;will<br/>have&#160;a&#160;brief&#160;introduction&#160;to&#160;sandboxes&#160;and&#160;further&#160;propose&#160;a&#160;classification&#160;and<br/>comparison&#160;of&#160;malware&#160;evasion&#160;tactics.<br/>
4.1<br/>
An&#160;overview&#160;of&#160;malware&#160;sandboxes<br/>
The&#160;concept&#160;behind&#160;a&#160;malware&#160;automated&#160;dynamic&#160;analysis&#160;system&#160;is&#160;to&#160;capture<br/>the&#160;suspicious&#160;program&#160;in&#160;a&#160;controlled&#160;and&#160;contained&#160;testing&#160;environment&#160;called<br/>sandbox,&#160;where&#160;its&#160;behavior&#160;in&#160;runtime&#160;can&#160;be&#160;closely&#160;studied&#160;and&#160;analyzed.<br/>Initially,&#160;sandboxes&#160;were&#160;employed&#160;as&#160;a&#160;part&#160;of&#160;the&#160;manual&#160;malware&#160;analysis.<br/>But&#160;today,&#160;they&#160;are&#160;playing&#160;their&#160;roles&#160;as&#160;the&#160;core&#160;of&#160;automated&#160;detection&#160;process<br/><a href="1811.01190v1s.html#26">[18].&#160;</a>Sandboxes&#160;are&#160;built&#160;in&#160;different&#160;ways.&#160;To&#160;better&#160;grasp&#160;the&#160;evasion&#160;tactics,<br/>and&#160;depict&#160;how&#160;they&#160;stand&#160;against&#160;different&#160;sandbox&#160;technologies,&#160;first,&#160;we&#160;must<br/>have&#160;a&#160;sense&#160;of&#160;how&#160;they&#160;are&#160;made.<br/>
4.1.1<br/>
Virtualization-based&#160;sandboxes<br/>
A&#160;virtual&#160;machine&#160;(VM)&#160;according&#160;to&#160;Goldberg&#160;<a href="1811.01190v1s.html#29">[69],&#160;</a>is&#160;“an&#160;efficient,&#160;isolated<br/>duplicate&#160;of&#160;the&#160;real&#160;machine.”&#160;The&#160;hypervisor&#160;or&#160;virtual&#160;machine&#160;manager<br/>(VMM&#160;)&#160;is&#160;in&#160;charge&#160;of&#160;managing&#160;and&#160;mediating&#160;programs’&#160;access&#160;requests&#160;to<br/>the&#160;underlying&#160;hardware.&#160;In&#160;other&#160;words,&#160;every&#160;virtual&#160;machine&#160;atop&#160;the&#160;VMM,<br/>in&#160;order&#160;to&#160;access&#160;the&#160;hardware,&#160;must&#160;first&#160;pass&#160;through&#160;the&#160;hypervisor.&#160;There<br/>are&#160;a&#160;couple&#160;of&#160;ways&#160;to&#160;implement&#160;sandboxes&#160;based&#160;on&#160;virtualization.&#160;One<br/>way&#160;is&#160;to&#160;weave&#160;the&#160;analysis&#160;tools&#160;directly&#160;into&#160;the&#160;hypervisor&#160;as&#160;in&#160;the&#160;case<br/>of&#160;ether&#160;<a href="1811.01190v1s.html#27">[34].&#160;</a>The&#160;other&#160;approach&#160;would&#160;be&#160;to&#160;embed&#160;the&#160;analysis&#160;tools&#160;(e.g.<br/>installing&#160;hooks)&#160;within&#160;the&#160;virtual&#160;machine&#160;that&#160;runs&#160;the&#160;malware&#160;sample.<br/>Instances&#160;of&#160;this&#160;design&#160;are:&#160;Norman&#160;sandbox&#160;<a href="1811.01190v1s.html#29">[70],&#160;</a>CWsandbox&#160;<a href="1811.01190v1s.html#29">[71].&#160;</a>Both&#160;of<br/>the&#160;methods&#160;inherently&#160;leak&#160;subtle&#160;cues&#160;which&#160;a&#160;malware&#160;could&#160;pick&#160;on&#160;to&#160;detect<br/>the&#160;presence&#160;of&#160;a&#160;sandbox.&#160;In&#160;the&#160;latter&#160;case,&#160;for&#160;instance,&#160;the&#160;VMM&#160;has&#160;to<br/>provide&#160;the&#160;required&#160;information&#160;to&#160;the&#160;analysis&#160;VM&#160;which&#160;means&#160;whenever<br/>a&#160;sensitive&#160;system&#160;call&#160;is&#160;being&#160;made&#160;by&#160;the&#160;malware,&#160;the&#160;VMM&#160;has&#160;to&#160;pass<br/>the&#160;control&#160;to&#160;the&#160;analysis&#160;tools&#160;inside&#160;the&#160;VM.&#160;Challenges&#160;of&#160;performing&#160;these<br/>procedures&#160;without&#160;leakage&#160;are&#160;profound&#160;which&#160;we&#160;will&#160;elaborate&#160;accordingly.<br/>
4.1.2<br/>
Emulation-based&#160;sandboxes<br/>
An&#160;emulator&#160;is&#160;a&#160;software&#160;that&#160;simulates&#160;a&#160;functionality&#160;or&#160;a&#160;piece&#160;of&#160;hardware<br/><a href="1811.01190v1s.html#29">[72].&#160;</a>An&#160;emulation-based&#160;sandbox&#160;can&#160;be&#160;achieved&#160;through&#160;different&#160;designs.<br/>
15<br/>
<hr/>
<a name=16></a>One&#160;would&#160;be&#160;to&#160;simulate&#160;the&#160;necessary&#160;OS&#160;functions&#160;and&#160;APIs.&#160;Another&#160;ap-<br/>proach&#160;is&#160;the&#160;simulation&#160;of&#160;CPU&#160;and&#160;memory&#160;and&#160;is&#160;the&#160;case&#160;for&#160;many&#160;anti-virus<br/>products&#160;<a href="1811.01190v1s.html#29">[72].&#160;</a>Simulation&#160;of&#160;I/O&#160;in&#160;addition&#160;to&#160;memory&#160;and&#160;CPU&#160;is&#160;what&#160;in<br/>literature&#160;is&#160;referred&#160;to&#160;as&#160;the&#160;full&#160;system&#160;simulation.&#160;The&#160;eminent&#160;features<br/>of&#160;emulation-based&#160;sandboxes&#160;are&#160;the&#160;great&#160;flexibility&#160;and&#160;detailed&#160;visibility&#160;of<br/>malware&#160;inner&#160;workings&#160;(introspection)&#160;they&#160;offer.&#160;Especially&#160;with&#160;the&#160;full&#160;sys-<br/>tem&#160;emulation,&#160;the&#160;behavior&#160;of&#160;the&#160;program&#160;under&#160;inspection&#160;(PUI)&#160;could&#160;be<br/>studied&#160;with&#160;minute&#160;details.<br/>
4.1.3<br/>
Bare-metal&#160;sandboxes<br/>
Recent&#160;evolved&#160;and&#160;perplexing&#160;evasion&#160;tactics,&#160;employed&#160;by&#160;sophisticated&#160;mal-<br/>ware&#160;demands&#160;a&#160;new&#160;paradigm&#160;of&#160;analysis.&#160;The&#160;emerging&#160;idea&#160;is&#160;to&#160;execute<br/>the&#160;malware&#160;in&#160;several&#160;different&#160;analysis&#160;environments&#160;simultaneously&#160;with&#160;the<br/>assumption&#160;that&#160;any&#160;deviation&#160;in&#160;behavior&#160;is&#160;a&#160;potential&#160;indication&#160;of&#160;malicious<br/>intents&#160;<a href="1811.01190v1s.html#29">[73].&#160;</a>The&#160;feasibility&#160;of&#160;this&#160;idea&#160;requires&#160;a&#160;reference&#160;system&#160;in&#160;which<br/>the&#160;malware&#160;is&#160;analyzed&#160;without&#160;utilization&#160;of&#160;any&#160;detectable&#160;component&#160;and<br/>the&#160;ideal&#160;choice&#160;would&#160;be&#160;a&#160;bare-metal&#160;environment&#160;equal&#160;to&#160;a&#160;real&#160;production<br/>system&#160;in&#160;terms&#160;of&#160;transparency.&#160;There&#160;have&#160;been&#160;several&#160;products&#160;in&#160;this&#160;vein<br/>e.g.&#160;Barebox,&#160;bare&#160;cloud&#160;etc.&#160;<a href="1811.01190v1s.html#29">[73,&#160;74,&#160;75].&#160;</a>Along&#160;with&#160;the&#160;merits&#160;that&#160;each<br/>design&#160;offers,&#160;subtle&#160;flaws&#160;or&#160;specific&#160;working&#160;principles&#160;that&#160;malware&#160;exploit&#160;to<br/>forge&#160;their&#160;evasion&#160;tactic.<br/>
4.2<br/>
Proposed&#160;Classification&#160;of&#160;Automated&#160;Dynamic&#160;Anal-<br/>ysis&#160;(sandbox)&#160;Evasion&#160;tactics<br/>
If&#160;the&#160;malware&#160;achieves&#160;one&#160;specific&#160;goal,&#160;it&#160;can&#160;triumphantly&#160;evade&#160;the&#160;sandbox.<br/>This&#160;goal&#160;is&#160;to&#160;behave&#160;nicely&#160;or&#160;refrain&#160;from&#160;executing&#160;its&#160;malicious&#160;payload&#160;so<br/>long&#160;as&#160;it&#160;resides&#160;within&#160;the&#160;sandbox.&#160;This&#160;strategy&#160;capitalizes&#160;on&#160;two&#160;facts.<br/>The&#160;first&#160;is&#160;that&#160;due&#160;to&#160;a&#160;massive&#160;number&#160;of&#160;malware&#160;samples&#160;and&#160;limitation<br/>of&#160;resources,&#160;sandboxes&#160;allot&#160;a&#160;specific&#160;limited&#160;time&#160;to&#160;the&#160;analysis&#160;of&#160;a&#160;sample.<br/>The&#160;second&#160;stems&#160;from&#160;an&#160;inherent&#160;limitation&#160;of&#160;dynamic&#160;analysis.&#160;In&#160;dynamic<br/>analysis&#160;since&#160;the&#160;“runtime&#160;behavior”&#160;and&#160;“execution”&#160;is&#160;being&#160;inspected,&#160;only<br/>the&#160;execution&#160;path&#160;is&#160;visible&#160;to&#160;the&#160;inspector&#160;(sandbox).&#160;Thus,&#160;if&#160;a&#160;malware<br/>portrays&#160;no&#160;malevolent&#160;behavior&#160;while&#160;under&#160;examination,&#160;the&#160;sandbox&#160;flags&#160;it<br/>as&#160;benign.<br/>
We&#160;propose&#160;to&#160;classify&#160;automated&#160;dynamic&#160;analysis&#160;evasion&#160;tactics&#160;under&#160;two<br/>
categories&#160;i.e.&#160;Detection-Dependent&#160;evasion&#160;and&#160;Detection-Independent&#160;evasion.<br/>We&#160;will&#160;elaborate&#160;on&#160;these&#160;tactics&#160;along&#160;with&#160;several&#160;techniques&#160;under&#160;each&#160;tac-<br/>tic.&#160;In&#160;addition,&#160;we&#160;briefly&#160;hint&#160;at&#160;the&#160;way&#160;sandboxes&#160;try&#160;to&#160;defeat&#160;these&#160;tactics.<br/>To&#160;provide&#160;a&#160;more&#160;coherent&#160;overview&#160;of&#160;these&#160;evasion&#160;techniques,&#160;we&#160;employ<br/>three&#160;criteria&#160;as&#160;follows&#160;which&#160;would&#160;serve&#160;as&#160;the&#160;basis&#160;for&#160;our&#160;comparison:<br/>
•&#160;Complexity:&#160;The&#160;difficulty&#160;of&#160;implementing&#160;an&#160;evasion&#160;tactic.<br/>
Our<br/>
touchstone&#160;for&#160;evaluating&#160;complexity&#160;are&#160;lines&#160;of&#160;code&#160;(LOC&#160;),&#160;and&#160;more<br/>
16<br/>
<hr/>
<a name=17></a>importantly&#160;the&#160;challenges&#160;which&#160;differ&#160;per&#160;tactic.&#160;We&#160;will&#160;discuss&#160;these<br/>challenges&#160;in&#160;the&#160;elaboration&#160;on&#160;the&#160;tactics<br/>
•&#160;Pervasiveness:&#160;This&#160;criterion&#160;captures&#160;the&#160;relative&#160;prevalence&#160;of&#160;a&#160;par-<br/>
ticular&#160;tactic.&#160;Based&#160;on&#160;our&#160;observations&#160;or&#160;security&#160;reports&#160;<a href="1811.01190v1s.html#29">[68,&#160;76],&#160;</a>and<br/>security&#160;reports,&#160;we&#160;try&#160;to&#160;provide&#160;a&#160;relative&#160;prevalence&#160;for&#160;each&#160;tactic.<br/>
•&#160;Efficacy-Level:&#160;Each&#160;tactic&#160;have&#160;an&#160;efficacy&#160;level.&#160;This&#160;demonstrates<br/>
against&#160;which&#160;type&#160;of&#160;sandbox&#160;that&#160;particular&#160;tactic&#160;is&#160;effective.<br/>
4.2.1<br/>
Detection-Dependent&#160;Evasion<br/>
4.2.1.1<br/>
Fingerprinting<br/>
Fingerprinting&#160;is&#160;a&#160;tactic&#160;pursued&#160;by&#160;malware&#160;to<br/>
detect&#160;the&#160;presence&#160;of&#160;sandboxes&#160;by&#160;looking&#160;for&#160;environmental&#160;artifacts&#160;or&#160;signs<br/>that&#160;could&#160;reveal&#160;the&#160;indications&#160;of&#160;a&#160;virtual/emulated&#160;machine.&#160;These&#160;signs<br/>can&#160;rangefrom&#160;device&#160;drivers,&#160;overt&#160;files&#160;on&#160;disk&#160;and&#160;registry&#160;keys&#160;to&#160;discrep-<br/>ancies&#160;emulated/virtualized&#160;processors.&#160;Indications&#160;of&#160;VM&#160;or&#160;an&#160;emulation&#160;are<br/>scattered&#160;in&#160;different&#160;levels&#160;<a href="1811.01190v1s.html#29">[77,&#160;78,&#160;79,&#160;</a><a href="1811.01190v1s.html#30">80].&#160;</a>It&#160;is&#160;noteworthy&#160;to&#160;mention&#160;that<br/>initially,&#160;many&#160;sandboxes&#160;such&#160;as&#160;Norman&#160;<a href="1811.01190v1s.html#29">[70]&#160;</a>were&#160;developed&#160;upon&#160;VMs.&#160;Thus,<br/>in&#160;literature,&#160;you&#160;may&#160;still&#160;observe&#160;the&#160;terms&#160;sandbox&#160;and&#160;VMs&#160;being&#160;used&#160;in-<br/>terchangeably&#160;to&#160;imply&#160;a&#160;contained&#160;analysis&#160;environment.&#160;The&#160;very&#160;same&#160;fact&#160;is<br/>also&#160;the&#160;reason&#160;for&#160;the&#160;advent&#160;of&#160;techniques&#160;referred&#160;to&#160;as&#160;anti-VM,&#160;suggesting<br/>that&#160;detection&#160;of&#160;a&#160;virtual&#160;machine&#160;would&#160;potentially&#160;mean&#160;an&#160;analysis&#160;envi-<br/>ronment.&#160;Different&#160;studies&#160;have&#160;been&#160;conducted&#160;to&#160;uncover&#160;the&#160;levels&#160;at&#160;which<br/>sandboxes&#160;leave&#160;their&#160;marks&#160;<a href="1811.01190v1s.html#26">[23,&#160;</a><a href="1811.01190v1s.html#30">81].&#160;</a>These&#160;levels&#160;are:<br/>
•&#160;Hardware:&#160;Devices&#160;and&#160;drivers&#160;are&#160;overt&#160;artifacts&#160;that&#160;malware&#160;might<br/>
look&#160;for&#160;to&#160;identify&#160;its&#160;environment.&#160;In&#160;the&#160;case&#160;of&#160;devices,&#160;VMs&#160;often&#160;em-<br/>ulate&#160;devices&#160;that&#160;can&#160;be&#160;readily&#160;detected&#160;as&#160;in&#160;the&#160;case&#160;of&#160;Reptile&#160;malware<br/><a href="1811.01190v1s.html#30">[82].&#160;</a>This&#160;ranges&#160;from&#160;obvious&#160;footprints&#160;such&#160;as&#160;the&#160;VMWare&#160;Ethernet<br/>device&#160;with&#160;its&#160;identifiable&#160;manufacturer&#160;prefix,&#160;to&#160;more&#160;subtle&#160;marks.<br/>Moreover,&#160;specific&#160;drivers&#160;are&#160;employed&#160;by&#160;VMs&#160;to&#160;interact&#160;properly&#160;with<br/>the&#160;host&#160;OS.&#160;These&#160;drivers&#160;are&#160;other&#160;indications&#160;of&#160;analysis&#160;environment<br/>for&#160;malware.&#160;For&#160;instance&#160;in&#160;the&#160;path:&#160;C:\Windows\System32\Drivers<br/>exist&#160;such&#160;signs&#160;that&#160;could&#160;expose&#160;VMWare,&#160;VirtualBox&#160;etc.&#160;(e.g.&#160;Vm-<br/>mouse.sys,&#160;vm3dgl.dll,&#160;VMToolsHook.dll&#160;etc.)&#160;<a href="1811.01190v1s.html#30">[83].</a><br/>
•&#160;Execution&#160;Environment:&#160;A&#160;malware&#160;inside&#160;sandbox&#160;experiences&#160;sub-<br/>
tle&#160;differences&#160;in&#160;the&#160;environment&#160;within&#160;which&#160;they&#160;are&#160;executed.&#160;Kernel<br/>space&#160;memory&#160;values,&#160;for&#160;instance,&#160;are&#160;different&#160;between&#160;a&#160;sandbox&#160;and&#160;na-<br/>tive&#160;system&#160;that&#160;can&#160;be&#160;detected&#160;by&#160;malware&#160;as&#160;in&#160;the&#160;cases&#160;of&#160;Agobot&#160;and<br/>Storm&#160;Trojans&#160;<a href="1811.01190v1s.html#30">[84,&#160;85].&#160;</a>Artifacts&#160;of&#160;this&#160;level&#160;manifest&#160;themselves&#160;either<br/>in&#160;memory&#160;or&#160;execution.&#160;As&#160;in&#160;the&#160;case&#160;of&#160;memory&#160;artifacts,&#160;for&#160;instance,<br/>to&#160;allow&#160;inspection&#160;and&#160;control&#160;between&#160;host&#160;and&#160;guest&#160;OS,&#160;VMWare&#160;cre-<br/>ates&#160;a&#160;channel&#160;between&#160;them&#160;(“ComCHannel&#160;”).&#160;Virtual&#160;PC&#160;hooks&#160;work<br/>in&#160;the&#160;same&#160;way&#160;<a href="1811.01190v1s.html#30">[86].</a><br/>
17<br/>
<hr/>
<a name=18></a>•&#160;Application:&#160;When&#160;an&#160;analysis&#160;application&#160;is&#160;used&#160;in&#160;an&#160;environment,<br/>
its&#160;presence&#160;is&#160;usually&#160;disclosed&#160;due&#160;to&#160;the&#160;artifacts&#160;of&#160;installation&#160;and<br/>execution&#160;which&#160;can&#160;be&#160;picked&#160;up&#160;by&#160;inquisitive&#160;malware&#160;such&#160;as&#160;Rbot&#160;<a href="1811.01190v1s.html#30">[87]<br/></a>or&#160;Phatbot&#160;<a href="1811.01190v1s.html#30">[88].&#160;</a>Even&#160;if&#160;not&#160;executed,&#160;evidence&#160;of&#160;the&#160;analysis&#160;tools&#160;might<br/>be&#160;residing&#160;on&#160;the&#160;disc,&#160;registry&#160;keys&#160;etc.&#160;which&#160;could&#160;be&#160;readily&#160;found<br/>by&#160;malware&#160;especially&#160;if&#160;they&#160;contain&#160;well-known&#160;file&#160;name&#160;or&#160;locations<br/>e.g.&#160;SYSTEM\CurrentControlSet\Control\VirtualDeviceDrivers.&#160;In<br/>a&#160;similar&#160;instance,&#160;if&#160;the&#160;names&#160;are&#160;not&#160;altered&#160;or&#160;the&#160;corresponding&#160;pro-<br/>cesses&#160;concealed,&#160;they&#160;can&#160;be&#160;enumerated&#160;by&#160;malware&#160;with&#160;little&#160;trouble.<br/>For&#160;instance,&#160;VMtools.exe,&#160;Vmwareuser.exe&#160;or&#160;vboxservice.exe&#160;if&#160;queried<br/>by&#160;malware,&#160;are&#160;vivid&#160;indicators&#160;of&#160;a&#160;virtual&#160;machine&#160;and&#160;analysis&#160;envi-<br/>ronment.<br/>
•&#160;Behavior:&#160;Perhaps,&#160;the&#160;most&#160;troublesome&#160;of&#160;all,&#160;for&#160;anti-malware&#160;vendors<br/>
to&#160;conceal,&#160;are&#160;the&#160;leakages&#160;caused&#160;by&#160;imperfect&#160;virtualization/emulation,<br/>or&#160;characteristics&#160;that&#160;are&#160;innate&#160;to&#160;such&#160;environments.&#160;Of&#160;particular&#160;in-<br/>terest&#160;are&#160;discrepancies&#160;of&#160;behavior&#160;between&#160;an&#160;emulated&#160;CPU&#160;and&#160;a&#160;phys-<br/>ical&#160;one&#160;<a href="1811.01190v1s.html#29">[77].&#160;</a>Performance&#160;of&#160;an&#160;application&#160;running&#160;under&#160;emulation&#160;is&#160;in-<br/>ferior&#160;to&#160;a&#160;real&#160;system.&#160;This&#160;performance&#160;penalty&#160;stems&#160;from&#160;translations<br/>or&#160;interceptions&#160;that&#160;has&#160;to&#160;be&#160;carried&#160;out&#160;in&#160;an&#160;emulation/virtualization.<br/>Such&#160;discrepancies&#160;can&#160;be&#160;disclosed&#160;through&#160;a&#160;diverse&#160;set&#160;of&#160;timing&#160;at-<br/>tacks&#160;<a href="1811.01190v1s.html#30">[89,&#160;</a><a href="1811.01190v1s.html#28">49,&#160;</a><a href="1811.01190v1s.html#30">90].&#160;</a>Computing&#160;absolute&#160;performance&#160;for&#160;fingerprinting&#160;is<br/>an&#160;arduous&#160;task&#160;due&#160;to&#160;the&#160;diversity&#160;of&#160;hardware&#160;configuration.<br/>
An&#160;alternative&#160;for&#160;malware&#160;is&#160;to&#160;calculate&#160;the&#160;relative&#160;performance&#160;<a href="1811.01190v1s.html#29">[77].<br/></a>Pursuing&#160;this&#160;method,&#160;malware&#160;compares&#160;performance&#160;ratio&#160;of&#160;two&#160;or<br/>more&#160;operations&#160;on&#160;the&#160;same&#160;system.&#160;If&#160;the&#160;measurement&#160;varies&#160;signifi-<br/>cantly&#160;among&#160;production&#160;and&#160;emulation&#160;systems,&#160;there’s&#160;a&#160;high&#160;chance&#160;of<br/>sandbox&#160;presence.&#160;Another&#160;interesting&#160;way&#160;of&#160;exploiting&#160;the&#160;limitations<br/>of&#160;emulation&#160;is&#160;observing&#160;and&#160;comparing&#160;the&#160;effects&#160;of&#160;caching&#160;on&#160;emu-<br/>lated&#160;and&#160;real&#160;environments.&#160;In&#160;this&#160;technique,&#160;a&#160;function&#160;is&#160;executed&#160;a<br/>number&#160;of&#160;times.&#160;As&#160;expected,&#160;the&#160;first&#160;run&#160;must&#160;to&#160;be&#160;the&#160;slowest.&#160;The<br/>same&#160;test&#160;is&#160;performed&#160;again,&#160;this&#160;time,&#160;in&#160;absence&#160;of&#160;caching.&#160;Timing<br/>analysis&#160;depicts&#160;the&#160;effectiveness&#160;of&#160;the&#160;employed&#160;caching.&#160;Simulation&#160;of<br/>processor&#160;cache&#160;is&#160;a&#160;complex&#160;task&#160;and&#160;emulators&#160;may&#160;not&#160;support&#160;it,&#160;the<br/>result&#160;of&#160;which&#160;is&#160;exposure&#160;of&#160;emulation&#160;in&#160;the&#160;aforementioned&#160;test&#160;<a href="1811.01190v1s.html#29">[77].<br/></a>Another&#160;noteworthy&#160;set&#160;of&#160;techniques&#160;are&#160;the&#160;red&#160;pill&#160;tests&#160;<a href="1811.01190v1s.html#30">[91].&#160;</a>An&#160;in-<br/>evitable&#160;behavioral&#160;artifact&#160;sandboxes&#160;share,&#160;are&#160;the&#160;imperfect&#160;simulation<br/>of&#160;CPU&#160;and&#160;residing&#160;instruction&#160;bugs.&#160;If&#160;a&#160;malware&#160;specifically&#160;finds&#160;such<br/>bugs&#160;and&#160;if&#160;during&#160;the&#160;execution,&#160;it&#160;notices&#160;a&#160;mishandled&#160;instruction&#160;it<br/>will&#160;suspect&#160;the&#160;presence&#160;of&#160;the&#160;sandbox.<br/>
•&#160;Network&#160;In&#160;addition&#160;to&#160;the&#160;previous&#160;levels&#160;that&#160;were&#160;suggested&#160;by&#160;Chen<br/>
et&#160;al.&#160;<a href="1811.01190v1s.html#26">[23],&#160;</a>malware&#160;can&#160;also&#160;probe&#160;the&#160;network&#160;in&#160;pursuit&#160;of&#160;sandbox’s<br/>marks.&#160;These&#160;marks&#160;are&#160;manifested&#160;in&#160;many&#160;forms&#160;such&#160;as&#160;known&#160;fixed<br/>IP&#160;addresses,&#160;<a href="1811.01190v1s.html#30">[92],&#160;</a>limitations&#160;pertaining&#160;to&#160;the&#160;sandboxes&#160;that&#160;prevent&#160;or<br/>emulate&#160;the&#160;internet&#160;access&#160;<a href="1811.01190v1s.html#30">[93,&#160;</a><a href="1811.01190v1s.html#31">94]&#160;</a>or&#160;extremely&#160;fast&#160;internet&#160;connection<br/>
18<br/>
<hr/>
<a name=19></a><a href="1811.01190v1s.html#31">[95].&#160;</a>One&#160;technique&#160;for&#160;instance,&#160;proposed&#160;in&#160;<a href="1811.01190v1s.html#30">[92]&#160;</a>is&#160;detecting&#160;sandboxes<br/>based&#160;their&#160;known&#160;IP&#160;addresses.&#160;which&#160;is&#160;acquired&#160;in&#160;an&#160;earlier&#160;attack<br/>through&#160;a&#160;decoy&#160;malware.<br/>
Fingerprinting&#160;tactic&#160;was&#160;the&#160;initial&#160;endeavor&#160;of&#160;malware&#160;authors&#160;to&#160;detect&#160;and<br/>evade&#160;sandboxes&#160;and&#160;as&#160;we&#160;observed&#160;the&#160;techniques&#160;have&#160;evolved&#160;significantly.&#160;In<br/>countering&#160;fingerprinting,&#160;most&#160;solutions&#160;are&#160;reactive,&#160;namely,&#160;the&#160;fingerprinting<br/>technique&#160;must&#160;first&#160;be&#160;disclosed,&#160;then&#160;the&#160;corresponding&#160;counter&#160;evasion&#160;will<br/>be&#160;provisioned.&#160;Collectively,&#160;fingerprinting&#160;tactic&#160;is&#160;still&#160;the&#160;dominant&#160;approach<br/>to&#160;evade&#160;sandboxes.&#160;<a href="1811.01190v1s.html#29">[76].</a><br/>
4.2.1.2<br/>
Reverse&#160;Turing&#160;Test<br/>
The&#160;second&#160;tactic&#160;that&#160;aims&#160;at&#160;detection,<br/>
is&#160;checking&#160;for&#160;human&#160;interaction&#160;with&#160;the&#160;system.&#160;This&#160;tactic&#160;capitalizes&#160;on<br/>the&#160;fact&#160;that&#160;sandboxes&#160;are&#160;automated&#160;machines&#160;with&#160;no&#160;human&#160;or&#160;operator<br/>directly&#160;interacting&#160;with&#160;them.&#160;Thus,&#160;if&#160;a&#160;malware&#160;does&#160;not&#160;observe&#160;any&#160;human<br/>interaction,&#160;it&#160;presumes&#160;to&#160;be&#160;in&#160;a&#160;sandbox.&#160;Such&#160;tactic&#160;is&#160;referred&#160;to&#160;as&#160;Reverse<br/>Turing&#160;Test&#160;since&#160;a&#160;machine&#160;is&#160;trying&#160;to&#160;distinguish&#160;between&#160;human&#160;or&#160;AI.&#160;This<br/>tactic&#160;can&#160;be&#160;carried&#160;out&#160;through&#160;various&#160;techniques&#160;<a href="1811.01190v1s.html#30">[80,&#160;</a><a href="1811.01190v1s.html#31">96,&#160;97,&#160;95,&#160;98].&#160;</a>For<br/>instance,&#160;the&#160;UpClicker&#160;<a href="1811.01190v1s.html#31">[98]&#160;</a>or&#160;a&#160;more&#160;advanced&#160;one,&#160;BaneChant&#160;<a href="1811.01190v1s.html#31">[99]&#160;</a>await&#160;the<br/>mouse&#160;left-click&#160;to&#160;detect&#160;human&#160;interaction&#160;<a href="1811.01190v1s.html#31">[100].&#160;</a>In&#160;a&#160;large&#160;portion&#160;of&#160;reverse<br/>Turing&#160;test&#160;techniques,&#160;malware&#160;looks&#160;for&#160;last&#160;user’s&#160;inputs.&#160;To&#160;do&#160;so,&#160;malware<br/>often&#160;leverages&#160;a&#160;combination&#160;of&#160;GetTickCount()&#160;and&#160;GetLastInputInfo()&#160;func-<br/>tions&#160;to&#160;compute&#160;the&#160;idle&#160;time&#160;of&#160;the&#160;user.&#160;To&#160;test&#160;whether&#160;it’s&#160;running&#160;on&#160;a&#160;real<br/>system,&#160;the&#160;malware&#160;waits&#160;indefinitely&#160;for&#160;any&#160;form&#160;of&#160;user&#160;input.&#160;On&#160;a&#160;real&#160;sys-<br/>tem&#160;eventually,&#160;a&#160;key&#160;would&#160;be&#160;pressed&#160;or&#160;mouse&#160;would&#160;be&#160;moved&#160;by&#160;the&#160;user.<br/>If&#160;that&#160;occurs&#160;for&#160;a&#160;specific&#160;number&#160;of&#160;times,&#160;malware&#160;executes&#160;its&#160;malicious<br/>payload.&#160;To&#160;counter&#160;this&#160;tactic&#160;of&#160;evasion,&#160;simulating&#160;human&#160;behavior&#160;might<br/>seem&#160;intuitive&#160;but&#160;it&#160;might&#160;be&#160;counterproductive.&#160;One&#160;reason&#160;is&#160;that&#160;digitally-<br/>generated&#160;human&#160;behavior&#160;can&#160;also&#160;be&#160;detected&#160;<a href="1811.01190v1s.html#31">[101].&#160;</a>The&#160;second&#160;reason&#160;is&#160;that<br/>limitation&#160;of&#160;designing&#160;such&#160;reversal&#160;Turing&#160;test&#160;seems&#160;to&#160;be&#160;merely&#160;a&#160;function<br/>of&#160;imagination.&#160;To&#160;demonstrate&#160;our&#160;point,&#160;consider&#160;another&#160;technique&#160;in&#160;which<br/>the&#160;malware&#160;waits&#160;for&#160;the&#160;user&#160;to&#160;scroll&#160;to&#160;the&#160;second&#160;page&#160;of&#160;a&#160;Rich&#160;Text&#160;For-<br/>mat&#160;(RTF)&#160;before&#160;it&#160;executes&#160;the&#160;malicious&#160;payload.&#160;Or&#160;In&#160;another&#160;approach,<br/>using&#160;Windows&#160;function&#160;GetCursorPos(),&#160;which&#160;holds&#160;the&#160;position&#160;of&#160;system’s<br/>cursor,&#160;the&#160;malware&#160;checks&#160;the&#160;cursor&#160;movement&#160;speed&#160;between&#160;instructions;&#160;if<br/>it&#160;exceeds&#160;a&#160;specific&#160;threshold,&#160;it&#160;would&#160;imply&#160;that&#160;the&#160;movement&#160;is&#160;too&#160;fast<br/>to&#160;be&#160;human-generated&#160;and&#160;malware&#160;ceases&#160;to&#160;operate&#160;<a href="1811.01190v1s.html#31">[100];&#160;</a>or&#160;another&#160;more<br/>recent&#160;technique&#160;which&#160;relies&#160;on&#160;seeking&#160;wear&#160;and&#160;tear&#160;signs&#160;of&#160;a&#160;production&#160;sys-<br/>tem&#160;<a href="1811.01190v1s.html#31">[102].&#160;</a>The&#160;seemingly&#160;endless&#160;possibilities&#160;for&#160;designing&#160;reversal&#160;Turing&#160;tests<br/>makes&#160;it&#160;a&#160;puzzling&#160;challenge&#160;for&#160;sandboxes&#160;to&#160;counter.&#160;This&#160;tactic&#160;is&#160;becoming<br/>more&#160;prevalent,&#160;but&#160;still&#160;not&#160;as&#160;pervasive&#160;as&#160;fingerprinting&#160;<a href="1811.01190v1s.html#29">[76].</a><br/>
4.2.1.3<br/>
Targeted<br/>
The&#160;third&#160;tactic&#160;of&#160;the&#160;detection-dependent&#160;category&#160;is<br/>
targeted&#160;detection.&#160;This&#160;tactic&#160;is&#160;slightly&#160;different&#160;from&#160;the&#160;previous&#160;ones&#160;in<br/>that&#160;instead&#160;of&#160;striving&#160;for&#160;detecting&#160;or&#160;evading&#160;a&#160;sandbox&#160;directly,&#160;the&#160;mal-<br/>ware&#160;fingerprints&#160;the&#160;environment&#160;to&#160;verify&#160;if&#160;the&#160;host&#160;is&#160;precisely&#160;the&#160;intended<br/>
19<br/>
<hr/>
<a name=20></a>(targeted)&#160;machine.&#160;In&#160;other&#160;words,&#160;malware&#160;looks&#160;for&#160;its&#160;target,&#160;not&#160;sandbox.<br/>This&#160;tactic&#160;can&#160;be&#160;employed&#160;following&#160;different&#160;routes:<br/>
•&#160;Environmentally-targeted:&#160;Stuxnet&#160;is&#160;known&#160;to&#160;be&#160;the&#160;first&#160;Cyber<br/>
weapon&#160;that&#160;incorporated&#160;targeting&#160;tactic&#160;as&#160;a&#160;portion&#160;of&#160;its&#160;evasion&#160;tactics<br/><a href="1811.01190v1s.html#31">[97].&#160;</a>Stuxnet&#160;explicitly&#160;looked&#160;for&#160;the&#160;presence&#160;of&#160;a&#160;specific&#160;industrial<br/>control&#160;system&#160;and&#160;would&#160;remain&#160;dormant&#160;otherwise.&#160;Depending&#160;on&#160;the<br/>infection&#160;approach,&#160;APT&#160;attacks&#160;follow&#160;different&#160;routes.<br/>
•&#160;Individually&#160;Targeted:&#160;In&#160;the&#160;case&#160;of&#160;Stuxnet,&#160;the&#160;strategy&#160;was&#160;to&#160;keep<br/>
probing&#160;victims&#160;(a&#160;wormy&#160;behavior)&#160;until&#160;the&#160;target&#160;was&#160;reached.&#160;Other<br/>classes&#160;of&#160;APT&#160;include&#160;the&#160;attacks&#160;such&#160;as&#160;darkhotel&#160;<a href="1811.01190v1s.html#31">[103],&#160;</a>in&#160;which&#160;the<br/>infection&#160;is&#160;conducted&#160;through&#160;spear&#160;phishing&#160;(i.e.&#160;directly&#160;aimed&#160;at&#160;the<br/>target).In&#160;other&#160;words,&#160;the&#160;attackers&#160;make&#160;sure&#160;that&#160;their&#160;malicious&#160;code<br/>is&#160;directly&#160;delivered&#160;to&#160;their&#160;target.<br/>
•&#160;Environment-dependent&#160;Encryption:&#160;Such&#160;targeted&#160;malware,&#160;have<br/>
an&#160;encrypted&#160;payload&#160;the&#160;decryption&#160;of&#160;which,&#160;is&#160;subjected&#160;to&#160;a&#160;key&#160;that<br/>is&#160;derived&#160;from&#160;its&#160;victim’s&#160;environment.&#160;The&#160;key&#160;might&#160;be&#160;a&#160;hardware<br/>serial&#160;number,&#160;specific&#160;environmental&#160;settings,&#160;etc.&#160;You&#160;can&#160;refer&#160;to&#160;<a href="1811.01190v1s.html#31">[104]<br/></a>for&#160;a&#160;thorough&#160;discussion&#160;of&#160;the&#160;topic.<br/>
4.2.2<br/>
Detection-Independent&#160;Evasion<br/>
The&#160;major&#160;difference&#160;of&#160;this&#160;category&#160;of&#160;tactics&#160;is&#160;that&#160;they&#160;do&#160;not&#160;rely&#160;on<br/>detecting&#160;the&#160;target&#160;environment,&#160;and&#160;their&#160;evasion&#160;tactic&#160;is&#160;independent&#160;of<br/>target&#160;system&#160;which&#160;relieves&#160;them&#160;from&#160;having&#160;to&#160;employ&#160;sophisticated&#160;detection<br/>techniques.&#160;Consequently,&#160;efforts&#160;directed&#160;at&#160;achieving&#160;more&#160;transparency&#160;has<br/>no&#160;effects&#160;on&#160;these&#160;tactics.&#160;In&#160;the&#160;following&#160;we&#160;elaborate&#160;on&#160;the&#160;tactics&#160;of&#160;this<br/>category&#160;and&#160;several&#160;techniques&#160;to&#160;deploy&#160;them.<br/>
4.2.2.1<br/>
Stalling<br/>
This&#160;tactic&#160;of&#160;analysis&#160;evasion&#160;capitalizes&#160;on&#160;the&#160;fact&#160;that<br/>
sandboxes&#160;allot&#160;a&#160;limited&#160;amount&#160;of&#160;time&#160;to&#160;the&#160;analysis&#160;of&#160;each&#160;sample.&#160;A<br/>malware&#160;has&#160;to&#160;simply&#160;postpone&#160;its&#160;malicious&#160;activity&#160;to&#160;the&#160;post-analysis&#160;stage.<br/>To&#160;this&#160;end,&#160;malware&#160;authors&#160;have&#160;come&#160;up&#160;with&#160;the&#160;idea&#160;of&#160;stalling&#160;<a href="1811.01190v1s.html#26">[16]&#160;</a>which<br/>can&#160;be&#160;achieved&#160;through&#160;a&#160;diverse&#160;set&#160;of&#160;techniques&#160;that&#160;range&#160;from&#160;a&#160;simple<br/>call&#160;to&#160;sleep()&#160;function&#160;to&#160;more&#160;sophisticated&#160;ones.&#160;Here&#160;we&#160;examine&#160;some&#160;of<br/>the&#160;known&#160;major&#160;stalling&#160;techniques.<br/>
•&#160;Simple&#160;Sleep:&#160;Sleeping&#160;is&#160;the&#160;simplest&#160;form&#160;of&#160;stalling&#160;and&#160;just&#160;as&#160;sim-<br/>
ple&#160;to&#160;defeat.&#160;The&#160;idea&#160;was&#160;to&#160;remain&#160;inactive&#160;for&#160;n&#160;minutes&#160;in&#160;order&#160;for<br/>the&#160;sandbox&#160;inspection&#160;to&#160;timeout&#160;before&#160;observing&#160;any&#160;malicious&#160;activ-<br/>ity.&#160;After&#160;being&#160;released&#160;to&#160;the&#160;network,&#160;the&#160;malware&#160;would&#160;execute&#160;the<br/>malicious&#160;payload.&#160;The&#160;infamous&#160;DUQU&#160;<a href="1811.01190v1s.html#31">[105]&#160;</a>exhibits&#160;such&#160;technique&#160;as<br/>one&#160;of&#160;its&#160;prerequisites&#160;for&#160;ignition.&#160;It&#160;requires&#160;that&#160;the&#160;system&#160;remain<br/>idle&#160;for&#160;at&#160;least&#160;10&#160;minutes&#160;<a href="1811.01190v1s.html#25">[5].&#160;</a>Another&#160;example&#160;would&#160;be&#160;the&#160;Khelios<br/>botnet&#160;<a href="1811.01190v1s.html#31">[106].&#160;</a>A&#160;new&#160;variant&#160;of&#160;Khelios&#160;sample&#160;found&#160;in&#160;2013&#160;(Called<br/>
20<br/>
<hr/>
<a name=21></a>Nap)&#160;calls&#160;the&#160;SleepEx()&#160;API&#160;with&#160;a&#160;timeout&#160;of&#160;10&#160;minutes.&#160;This&#160;delay<br/>in&#160;execution&#160;outruns&#160;the&#160;sandbox&#160;analysis&#160;timeout&#160;which&#160;is&#160;followed&#160;by<br/>achieving&#160;the&#160;harmless&#160;flag.&#160;To&#160;counter&#160;such&#160;techniques,&#160;sandboxes&#160;came<br/>up&#160;with&#160;the&#160;simple&#160;idea&#160;of&#160;accelerating&#160;the&#160;time&#160;(called&#160;sleep&#160;patching).<br/>Although&#160;seemingly&#160;logical,&#160;sleep&#160;patching&#160;has&#160;unpredicted&#160;effects.&#160;An<br/>interesting&#160;side&#160;effect&#160;of&#160;sleep&#160;patching&#160;was&#160;observed&#160;in&#160;specific&#160;malware<br/>samples&#160;where&#160;the&#160;acceleration&#160;actually&#160;lead&#160;to&#160;inactivity&#160;of&#160;malware&#160;in-<br/>stances&#160;that&#160;wait&#160;for&#160;human&#160;interaction&#160;within&#160;a&#160;predefined&#160;period&#160;of&#160;time<br/><a href="1811.01190v1s.html#31">[101].&#160;</a>Despite&#160;its&#160;side&#160;effects,&#160;sleep&#160;patching&#160;turned&#160;out&#160;to&#160;be&#160;effective&#160;in<br/>some&#160;cases&#160;and&#160;malware&#160;authors&#160;came&#160;up&#160;with&#160;more&#160;advanced&#160;techniques<br/>as&#160;a&#160;response.<br/>
•&#160;Advanced&#160;Sleep:&#160;New&#160;malware&#160;instances&#160;such&#160;as&#160;Pafish&#160;<a href="1811.01190v1s.html#31">[107]&#160;</a>were&#160;found<br/>
to&#160;opt&#160;for&#160;more&#160;advanced&#160;sleeping&#160;tricks.&#160;They&#160;detect&#160;sleep-patching&#160;using<br/>the&#160;rdtsc&#160;instruction&#160;in&#160;combination&#160;with&#160;Sleep()&#160;to&#160;check&#160;the&#160;acceleration<br/>of&#160;execution.<br/>
•&#160;Code&#160;stalling:&#160;While&#160;”sleeps”,&#160;delay&#160;the&#160;execution,&#160;in&#160;code&#160;stalling&#160;the<br/>
malware,&#160;opts&#160;for&#160;executing&#160;irrelevant&#160;and&#160;time-consuming&#160;benign&#160;instruc-<br/>tion&#160;to&#160;avoid&#160;raising&#160;any&#160;suspicions&#160;from&#160;the&#160;sandbox&#160;<a href="1811.01190v1s.html#31">[101].&#160;</a>Rombertik<br/><a href="1811.01190v1s.html#31">[108]&#160;</a>is&#160;a&#160;spyware&#160;aimed&#160;at&#160;stealing&#160;confidential&#160;data.&#160;To&#160;confuse&#160;sand-<br/>boxes,&#160;it&#160;writes&#160;approximately&#160;960&#160;million&#160;bytes&#160;of&#160;random&#160;data&#160;to&#160;memory<br/><a href="1811.01190v1s.html#31">[109].&#160;</a>The&#160;hurdles&#160;this&#160;technique&#160;impose&#160;on&#160;sandboxes&#160;are&#160;two-fold.&#160;The<br/>first&#160;one&#160;is&#160;the&#160;inability&#160;of&#160;the&#160;sandbox&#160;to&#160;suspect&#160;stalling&#160;as&#160;the&#160;sample<br/>is&#160;running&#160;actively.&#160;The&#160;second&#160;one,&#160;is&#160;that&#160;this&#160;excessive&#160;writing&#160;would<br/>overwhelm&#160;the&#160;tracking&#160;tools&#160;<a href="1811.01190v1s.html#31">[108].&#160;</a>In&#160;another&#160;striking&#160;code&#160;stalling&#160;tech-<br/>nique,&#160;the&#160;malware&#160;encrypts&#160;the&#160;payload&#160;using&#160;a&#160;weak&#160;encryption&#160;key&#160;and<br/>brute-forces&#160;it&#160;during&#160;the&#160;execution&#160;<a href="1811.01190v1s.html#29">[73].</a><br/>
4.2.2.2<br/>
Trigger-based<br/>
The&#160;second&#160;tactic&#160;that&#160;does&#160;not&#160;rely&#160;on&#160;detection<br/>
is&#160;a&#160;trigger-base&#160;tactic&#160;or&#160;more&#160;traditionally&#160;logic&#160;bombs.&#160;As&#160;we&#160;have&#160;already<br/>noted,&#160;the&#160;basis&#160;of&#160;evading&#160;sandboxes&#160;is&#160;to&#160;simply&#160;refrain&#160;from&#160;exhibiting&#160;the&#160;ma-<br/>licious&#160;behavior&#160;so&#160;long&#160;as&#160;they&#160;are&#160;in&#160;the&#160;sandbox.&#160;Another&#160;tactic&#160;for&#160;remaining<br/>dormant&#160;would&#160;be&#160;to&#160;wait&#160;for&#160;a&#160;trigger.&#160;There&#160;are&#160;many&#160;environmental&#160;vari-<br/>ables&#160;that&#160;can&#160;serve&#160;as&#160;malware&#160;triggers&#160;ranging&#160;from&#160;system&#160;date&#160;to&#160;a&#160;specially<br/>crafted&#160;network&#160;instruction.&#160;For&#160;instance,&#160;MyDoom&#160;<a href="1811.01190v1s.html#28">[51]&#160;</a>is&#160;triggered&#160;on&#160;specific<br/>dates&#160;and&#160;performs&#160;DDoS&#160;attacks,&#160;or&#160;some&#160;key-loggers&#160;only&#160;log&#160;keystrokes&#160;for<br/>particular&#160;websites;&#160;and&#160;finally,&#160;DDoS&#160;zombies&#160;which&#160;are&#160;only&#160;activated&#160;when<br/>given&#160;the&#160;proper&#160;command&#160;<a href="1811.01190v1s.html#31">[110].&#160;</a>In&#160;the&#160;literature,&#160;this&#160;behavior&#160;is&#160;referred&#160;to<br/>as&#160;trigger-based&#160;behavior&#160;<a href="1811.01190v1s.html#32">[111].&#160;</a>In&#160;the&#160;following&#160;there&#160;are&#160;a&#160;number&#160;of&#160;triggers<br/>embedded&#160;within&#160;malware&#160;as&#160;a&#160;protection&#160;against&#160;sandboxes.<br/>
•&#160;Keystroke-based:&#160;The&#160;malware&#160;gets&#160;triggered&#160;if&#160;it&#160;notices&#160;a&#160;specific<br/>
keyword,&#160;for&#160;instance,&#160;the&#160;name&#160;of&#160;an&#160;app&#160;or&#160;the&#160;title&#160;of&#160;a&#160;windo<a href="1811.01190v1s.html#32">w,[112].<br/></a>What&#160;occurs&#160;when&#160;the&#160;trigger&#160;happens,&#160;depends&#160;on&#160;the&#160;purpose&#160;and&#160;con-<br/>text.&#160;For&#160;example,&#160;the&#160;malware&#160;might&#160;initiate&#160;logging&#160;keystrokes.<br/>
21<br/>
<hr/>
<a name=22></a>•&#160;System&#160;time:&#160;In&#160;this&#160;case,&#160;the&#160;system&#160;date&#160;or&#160;time&#160;would&#160;serve&#160;as&#160;the<br/>
trigger&#160;<a href="1811.01190v1s.html#32">[112,&#160;113,&#160;114]</a><br/>
•&#160;Network&#160;Inputs:&#160;A&#160;portion&#160;of&#160;malware&#160;are&#160;triggered&#160;when&#160;they&#160;receive<br/>
certain&#160;inputs&#160;from&#160;the&#160;network&#160;as&#160;in&#160;the&#160;case&#160;of&#160;Tribal&#160;flood&#160;network&#160;<a href="1811.01190v1s.html#26">[21].</a><br/>
•&#160;Covert&#160;trigger-based:&#160;Previous&#160;techniques&#160;often&#160;presuppose&#160;lack&#160;of<br/>
code&#160;inspection&#160;to&#160;remain&#160;undetected&#160;(as&#160;it&#160;is&#160;often&#160;the&#160;case&#160;for&#160;compiled<br/>malware).&#160;However,&#160;there&#160;have&#160;been&#160;advances&#160;regarding&#160;automatic&#160;detec-<br/>tion&#160;of&#160;such&#160;program&#160;routes&#160;e.g.&#160;State-of-the-art&#160;covert&#160;trigger-based&#160;tech-<br/>niques&#160;are&#160;being&#160;devised&#160;as&#160;a&#160;response&#160;to&#160;automated&#160;approaches&#160;that&#160;aim<br/>at&#160;detecting&#160;such&#160;triggers&#160;instruction.&#160;These&#160;techniques&#160;utilize&#160;instruction-<br/>level&#160;stenography&#160;to&#160;hide&#160;the&#160;malicious&#160;code&#160;from&#160;the&#160;disassemblers.&#160;In<br/>addition,&#160;they&#160;implement&#160;trigger-based&#160;bugs&#160;to&#160;provision&#160;stealthy&#160;control<br/>transfer&#160;which&#160;makes&#160;it&#160;difficult&#160;for&#160;dynamic&#160;analysis&#160;to&#160;discover&#160;proper<br/>triggers&#160;<a href="1811.01190v1s.html#31">[97]&#160;</a>return&#160;values&#160;from&#160;system&#160;calls&#160;are&#160;other&#160;instances&#160;of&#160;malware<br/>triggers.<br/>
Trigger-based&#160;tactic&#160;initially&#160;was&#160;not&#160;utilized&#160;to&#160;evade&#160;sandboxes&#160;and&#160;are<br/>
still&#160;relatively&#160;seen&#160;in&#160;the&#160;wild.&#160;Finding&#160;these&#160;triggers&#160;is&#160;often&#160;pursued&#160;through<br/>path&#160;exploration&#160;approaches&#160;e.g.&#160;symbolic&#160;execution&#160;with&#160;the&#160;goal&#160;of&#160;finding<br/>and&#160;traversing&#160;all&#160;the&#160;conditional&#160;branches&#160;in&#160;an&#160;automated&#160;manner.&#160;These<br/>approaches&#160;require&#160;significant&#160;levels&#160;of&#160;resources&#160;and&#160;are&#160;still&#160;below&#160;a&#160;fair&#160;level<br/>of&#160;efficiency.<br/>
4.2.2.3<br/>
Fileless&#160;Malware<br/>
In&#160;<a href="1811.01190v1s.html#12">3.2.3.4&#160;</a>we&#160;discussed&#160;the&#160;fileless&#160;malware.&#160;In<br/>
addition&#160;to&#160;the&#160;rigorous&#160;resistance&#160;against&#160;manual&#160;analysis,&#160;fileless&#160;malware&#160;is<br/>profoundly&#160;adept&#160;at&#160;evading&#160;security&#160;mechanisms.&#160;A&#160;major&#160;difference&#160;of&#160;this<br/>tactic&#160;is&#160;the&#160;most&#160;often&#160;the&#160;malware&#160;is&#160;not&#160;subjected&#160;to&#160;the&#160;analysis&#160;environment<br/>in&#160;the&#160;first&#160;place.&#160;This&#160;is&#160;an&#160;inherent&#160;outcome&#160;of&#160;this&#160;tactic.&#160;The&#160;techniques<br/>that&#160;fileless&#160;malware&#160;utilizes&#160;are&#160;similar&#160;to&#160;drive-by&#160;attacks&#160;<a href="1811.01190v1s.html#32">[115].&#160;</a>Generally,<br/>fileless&#160;malware&#160;exploits&#160;a&#160;vulnerability&#160;of&#160;target&#160;system&#160;(OS,&#160;Browser,&#160;Browser<br/>plugins,&#160;etc.)&#160;and&#160;injects&#160;its&#160;malicious&#160;code&#160;directly&#160;into&#160;memory.&#160;The&#160;new<br/>trend&#160;of&#160;fileless&#160;malware&#160;uses&#160;windows&#160;PowerShell&#160;to&#160;carryout&#160;its&#160;task.&#160;As<br/>mentioned&#160;earlier,&#160;this&#160;attack&#160;is&#160;on&#160;the&#160;rise,&#160;and&#160;defending&#160;against&#160;it&#160;is&#160;of&#160;great<br/>complexity.<br/>
4.3<br/>
Discussion<br/>
In&#160;table&#160;2&#160;we&#160;summarize&#160;our&#160;survey&#160;on&#160;malware&#160;automated&#160;dynamic&#160;analysis<br/>evasion.&#160;In&#160;this&#160;table,&#160;we&#160;compare&#160;the&#160;techniques&#160;based&#160;on&#160;four&#160;criteria&#160;i.e.<br/>complexity&#160;of&#160;implementation,&#160;pervasiveness,&#160;efficacy&#160;level&#160;and&#160;detection&#160;com-<br/>plexity.&#160;In&#160;addition,&#160;in&#160;the&#160;example&#160;column&#160;we&#160;provide&#160;malware&#160;samples&#160;that<br/>incorporate&#160;the&#160;corresponding&#160;techniques.&#160;Moreover,&#160;under&#160;Sandbox&#160;counter-<br/>measure&#160;tactics,&#160;we&#160;hint&#160;on&#160;how&#160;the&#160;defensive&#160;side&#160;strives&#160;to&#160;counter&#160;the&#160;evasion<br/>tactics&#160;and&#160;how&#160;complex/effective&#160;these&#160;countermeasures&#160;are.<br/>
22<br/>
<hr/>
<a name=23></a>&#160;<br/>
Table&#160;2:&#160;Classification&#160;and&#160;comparison&#160;of&#160;malware&#160;sandbox&#160;evasion&#160;techniques<br/>
<b>Sandbox&#160;</b><br/>
<b>Countermeasure&#160;Tactics&#160;</b><br/>
<b>Criteria&#160;</b><br/>
<b>Detection&#160;</b><br/>
<b>Complexity&#160;Pervasiveness&#160;</b><br/>
<b>Efficacy&#160;Level&#160;</b><br/>
<b>Example&#160;</b><br/>
<b>Complexity&#160;</b><br/>
<b>Complexity&#160;Effectiveness&#160;</b><br/>
<b>Cat.&#160;&#160;&#160;&#160;&#160; &#160; &#160; &#160;Tactic&#160;</b><br/>
<b>&#160;</b><br/>
[104,&#160;<br/>
<b>t</b><br/>
Low-<br/>
Sleep&#160;Patching&#160;<br/>
<b>-</b><br/>
<b>Stalling&#160;</b><br/>
Medium&#160;<br/>
All&#160;Architecture&#160;<br/>
Very&#160;High&#160;&#160;105,&#160;106,&#160;<br/>
Medium&#160;<br/>
Low&#160;<br/>
Low&#160;<br/>
107]&#160;<br/>
<b>tion</b><br/>
Path&#160;Exploration&#160;<br/>
[49,&#160;111,&#160;<br/>
<b>ec</b><br/>
Emulation-Based,&#160;Bare-<br/>
Moderate&#160;&#160;112,&#160;113,&#160;<br/>
<b>et</b><br/>
<b>ependen&#160;Trigger-Based&#160;</b><br/>
Low&#160;<br/>
Medium&#160;<br/>
metal&#160;<br/>
<b>D</b><br/>
High&#160;<br/>
Moderate&#160;<br/>
18,]&#160;<br/>
<b>Ind&#160;Fileless&#160;(AVT)&#160;&#160;</b>High&#160;<br/>
Low&#160;<br/>
All&#160;Architectures&#160;<br/>
N/A&#160;<br/>
Very&#160;High&#160;<br/>
[61]&#160;<br/>
<b>&#160;</b><br/>
Using&#160;heterogeneous&#160;<br/>
<b>ent</b><br/>
VM-Based,&#160;Hypervisor-<br/>
analysis,&#160;Artifact&#160;<br/>
[83,&#160;84,&#160;<br/>
<b>Fingerprinting&#160;</b><br/>
High&#160;<br/>
High&#160;<br/>
based,&#160;Emulation-Based&#160;<br/>
Randomization&#160;<br/>
Moderate&#160;<br/>
87]&#160;&#160;<br/>
Moderate&#160;<br/>
Moderate&#160;<br/>
<b>epend<br/>-D</b><br/>
Digital&#160;Simulation,&#160;path&#160;<br/>
<b>Reverse&#160;</b><br/>
VM-Based,&#160;Hypervisor-<br/>
Medium&#160;<br/>
Medium&#160;<br/>
exploration&#160;<br/>
Moderate&#160;&#160;[97,&#160;98]&#160;<br/>
<b>Turing&#160;Test&#160;</b><br/>
based,&#160;Bare-metal,&#160;<br/>
<b>tion</b><br/>
Low&#160;<br/>
Low&#160;<br/>
<b>ec</b><br/>
VM-Based,&#160;<br/>
<b>et</b><br/>
Emulation-<br/>
Path&#160;exploration&#160;<br/>
[96,&#160;102,&#160;<br/>
Hypervisor-<br/>
Very&#160;High&#160;<br/>
<b>D</b><br/>
<b>Targeted&#160;</b><br/>
Very&#160;High&#160;<br/>
Low&#160;<br/>
based&#160;<br/>
104]&#160;&#160;<br/>
based,&#160;<br/>
High&#160;<br/>
Low&#160;<br/>
In&#160;this&#160;section&#160;we&#160;provided&#160;our&#160;survey&#160;and&#160;classification&#160;on&#160;malware&#160;auto-<br/>
mated&#160;dynamic&#160;analysis&#160;evasion.&#160;Our&#160;observations,&#160;in&#160;line&#160;with&#160;studies&#160;such&#160;as<br/><a href="1811.01190v1s.html#29">[76,&#160;66,&#160;</a><a href="1811.01190v1s.html#26">17]&#160;</a>notes&#160;several&#160;trends.<br/>
Fingerprinting&#160;by&#160;far,&#160;is&#160;the&#160;most&#160;pervasive&#160;tactic&#160;and&#160;has&#160;proven&#160;to&#160;be&#160;an<br/>
effective&#160;technique&#160;if&#160;executed&#160;with&#160;precision.&#160;Aside&#160;from&#160;other&#160;researches&#160;and<br/>our&#160;observations,&#160;another&#160;proof&#160;regarding&#160;the&#160;dominance&#160;of&#160;fingerprinting&#160;tactic<br/>is&#160;the&#160;trend&#160;of&#160;defensive&#160;research&#160;in&#160;the&#160;last&#160;decade&#160;and&#160;how&#160;they&#160;are&#160;evolving<br/><a href="1811.01190v1s.html#32">[116,&#160;117,&#160;111,&#160;</a><a href="1811.01190v1s.html#27">34,&#160;</a><a href="1811.01190v1s.html#32">118,&#160;</a><a href="1811.01190v1s.html#29">75,&#160;</a><a href="1811.01190v1s.html#32">119,&#160;120,&#160;121,&#160;</a><a href="1811.01190v1s.html#29">73,&#160;</a><a href="1811.01190v1s.html#32">122,&#160;123,&#160;</a><a href="1811.01190v1s.html#31">94,&#160;</a><a href="1811.01190v1s.html#33">124].&#160;</a>Examining&#160;these<br/>researches,&#160;we&#160;notice&#160;that&#160;the&#160;great&#160;majority&#160;of&#160;them&#160;are&#160;pursuing&#160;more&#160;trans-<br/>parent&#160;system&#160;the&#160;reason&#160;of&#160;which&#160;is&#160;to&#160;be&#160;more&#160;resilient&#160;against&#160;fingerprinting<br/>and&#160;more&#160;broadly,&#160;detection-dependent&#160;tactics.<br/>
We&#160;see&#160;two&#160;reasons&#160;behind&#160;the&#160;pervasiveness&#160;of&#160;fingerprinting&#160;tactic.&#160;The<br/>
first&#160;reason&#160;is&#160;the&#160;immensity&#160;of&#160;possibilities&#160;for&#160;fingerprinting&#160;scenarios.&#160;In&#160;each<br/>level&#160;of&#160;the&#160;system&#160;(application,&#160;network,&#160;behavior,&#160;etc.)&#160;there&#160;are&#160;always&#160;new<br/>hints&#160;of&#160;identity&#160;that&#160;a&#160;malware&#160;can&#160;look&#160;for.<br/>
The&#160;second&#160;reason,&#160;is&#160;the&#160;countermeasure&#160;strategies&#160;against&#160;fingerprinting<br/>
tactic.&#160;There&#160;are&#160;two&#160;major&#160;strategies&#160;in&#160;this&#160;regard.&#160;The&#160;first&#160;one,&#160;is&#160;the&#160;re-<br/>active&#160;approach.&#160;Namely,&#160;for&#160;the&#160;sandbox&#160;to&#160;neutralize&#160;malware&#160;attempts&#160;for<br/>fingerprinting,&#160;it&#160;has&#160;to&#160;know&#160;what&#160;constitutes&#160;fingerprinting&#160;in&#160;the&#160;first&#160;place.<br/>The&#160;second&#160;strategy&#160;is&#160;to&#160;aim&#160;for&#160;more&#160;transparent&#160;systems&#160;either&#160;following&#160;the<br/>approach&#160;of&#160;single-stand&#160;analysis&#160;systems&#160;e.g.&#160;<a href="1811.01190v1s.html#27">[34]&#160;</a>or&#160;heterogeneous&#160;analysis<br/>i.e.&#160;bare-metal&#160;analysis&#160;<a href="1811.01190v1s.html#29">[75,&#160;73].&#160;</a>In&#160;retrospect&#160;to&#160;the&#160;cases&#160;we&#160;cited&#160;in&#160;this&#160;sec-<br/>tion,&#160;we&#160;know&#160;that&#160;both&#160;strategies&#160;are&#160;still&#160;vulnerable&#160;to&#160;zero-day&#160;fingerprinting<br/>techniques.<br/>
Although&#160;attempts&#160;for&#160;achieving&#160;more&#160;transparency&#160;has&#160;raised&#160;the&#160;bar&#160;for<br/>
fingerprinting,&#160;new&#160;reversal&#160;Turing&#160;test&#160;tactic&#160;employed&#160;by&#160;malware&#160;virtually<br/>foils&#160;most&#160;of&#160;the&#160;efforts.&#160;Reverse&#160;Turing&#160;test&#160;tactics&#160;again,&#160;pushes&#160;the&#160;defenders<br/>
23<br/>
<hr/>
<a name=24></a>to&#160;defend&#160;with&#160;the&#160;reactive&#160;approach.<br/>
On&#160;the&#160;other&#160;hand&#160;we&#160;are&#160;noticing&#160;new&#160;trends&#160;of&#160;malware&#160;attack&#160;employing<br/>
detection-independent&#160;tactics.&#160;Most&#160;notably&#160;stalling&#160;<a href="1811.01190v1s.html#26">[17]&#160;</a>and&#160;fileless&#160;tactics&#160;<a href="1811.01190v1s.html#28">[64].<br/></a>The&#160;majority&#160;of&#160;the&#160;efforts&#160;that&#160;has&#160;been&#160;put&#160;into&#160;developing&#160;more&#160;transparent<br/>systems,&#160;has&#160;raised&#160;the&#160;bar&#160;for&#160;detection-dependent&#160;tactics.&#160;That&#160;is&#160;one&#160;rea-<br/>son&#160;that&#160;has&#160;motivated&#160;malware&#160;authors&#160;to&#160;adopt&#160;more&#160;detection-independent<br/>tactics.<br/>
Unbound&#160;fingerprinting&#160;possibilities,&#160;reactive&#160;approaches,&#160;vulnerability&#160;of<br/>
transparent&#160;systems&#160;to&#160;zero-day&#160;detection-dependent&#160;tactics&#160;(fingerprinting,&#160;tar-<br/>geted,&#160;reverse&#160;Turing),&#160;vulnerability&#160;of&#160;transparency-seeking&#160;strategies&#160;to&#160;detection-<br/>independent&#160;tactics,&#160;all&#160;seem&#160;to&#160;call&#160;for&#160;more&#160;generic&#160;and&#160;effective&#160;defensive<br/>strategies.<br/>
A&#160;promising&#160;approach&#160;that&#160;can&#160;potentially&#160;counter&#160;most&#160;of&#160;the&#160;evasion&#160;tac-<br/>
tics&#160;are&#160;path&#160;exploration&#160;techniques.&#160;Every&#160;malware&#160;will&#160;expose&#160;its&#160;malicious<br/>payload&#160;if&#160;its&#160;specific&#160;conditions&#160;are&#160;satisfied.&#160;Path&#160;exploration&#160;techniques&#160;po-<br/>tentially&#160;can&#160;trigger&#160;those&#160;conditions&#160;and&#160;expose&#160;the&#160;malicious&#160;behavior.<br/>
5<br/>
Conclusion&#160;and&#160;Future&#160;Directions<br/>
In&#160;this&#160;paper,&#160;we&#160;conducted&#160;a&#160;surveyed&#160;on&#160;the&#160;subject&#160;of&#160;malware&#160;analysis<br/>evasion&#160;techniques,&#160;and&#160;proposed&#160;classifications&#160;for&#160;both&#160;modes&#160;of&#160;manual&#160;and<br/>automated&#160;analysis.<br/>
For&#160;the&#160;automated&#160;dynamic&#160;analysis,&#160;we&#160;defined&#160;two&#160;major&#160;categories&#160;of&#160;eva-<br/>
sion.&#160;Detection-dependent&#160;and&#160;detection-independent.&#160;On&#160;the&#160;defensive&#160;side,<br/>defenders&#160;are&#160;pursuing&#160;4&#160;major&#160;strategies.&#160;Reactive&#160;approaches,&#160;more&#160;transpar-<br/>ent&#160;analysis&#160;systems,&#160;bare-metal&#160;analysis,&#160;and&#160;several&#160;endeavors&#160;towards&#160;more<br/>generic&#160;approaches,&#160;namely,&#160;path&#160;exploration.&#160;The&#160;first&#160;three&#160;defensive&#160;strate-<br/>gies&#160;can&#160;hope&#160;for&#160;being&#160;effective&#160;merely&#160;against&#160;detection-dependent&#160;evasion<br/>tactics&#160;and&#160;loose&#160;their&#160;effectiveness&#160;against&#160;detection-independent&#160;tactics.&#160;As<br/>for&#160;the&#160;detection-independent&#160;tactic,&#160;we&#160;need&#160;more&#160;generic&#160;approaches&#160;such&#160;as<br/>the&#160;path&#160;exploration&#160;methods.<br/>
Parallel&#160;to&#160;endeavors&#160;towards&#160;path&#160;exploration&#160;methods,&#160;we&#160;advocate&#160;auto-<br/>
mated&#160;fingerprinting&#160;generations&#160;such&#160;as&#160;MORPHEUS&#160;<a href="1811.01190v1s.html#33">[125],&#160;</a>and&#160;Red&#160;Pills&#160;<a href="1811.01190v1s.html#30">[91].<br/></a>These&#160;solutions&#160;would&#160;not&#160;be&#160;a&#160;generic&#160;response,&#160;but&#160;they&#160;would&#160;significantly<br/>raise&#160;the&#160;bar&#160;for&#160;malware&#160;pursuing&#160;fingerprinting&#160;tactic.<br/>
Another&#160;line&#160;of&#160;inquiry&#160;that&#160;we&#160;suggest&#160;is&#160;analyzing&#160;the&#160;effectiveness&#160;of<br/>
using&#160;malware&#160;evasion&#160;tactics&#160;against&#160;itself;&#160;for&#160;the&#160;case&#160;of&#160;detection-dependant<br/>tactics,&#160;a&#160;malware&#160;strives&#160;relentlessly&#160;to&#160;detect&#160;a&#160;Sandbox&#160;and&#160;refrain&#160;from<br/>execution.&#160;What&#160;would&#160;be&#160;the&#160;result&#160;of&#160;a&#160;program,&#160;installed&#160;on&#160;a&#160;production<br/>system&#160;that&#160;would&#160;impersonate&#160;a&#160;Sandbox.<br/>
How&#160;efficacious&#160;it&#160;would&#160;be&#160;in<br/>
deterring&#160;malware&#160;and&#160;if&#160;executed&#160;adroitly,&#160;how&#160;significantly&#160;such&#160;approach<br/>would&#160;raise&#160;the&#160;bar&#160;for&#160;devising&#160;future&#160;evasion&#160;attempts.<br/>
24<br/>
<hr/>
<a name=25></a>6<br/>
Acknowledgments<br/>
This&#160;work&#160;is&#160;supported&#160;by&#160;APA&#160;research&#160;center&#160;(http://apa.aut.ac.ir)&#160;at&#160;Amirk-<br/>abir&#160;University&#160;of&#160;Technology,&#160;Tehran,&#160;Iran.&#160;In&#160;addition,&#160;would&#160;like&#160;to&#160;expand<br/>our&#160;gratitude&#160;to&#160;Prof.&#160;Eric&#160;Filiol&#160;of&#160;ESIEA&#160;(C&#160;+&#160;V)O&#160;lab&#160;for&#160;his&#160;support&#160;and<br/>insights&#160;on&#160;this&#160;paper.<br/>
References<br/>
[1]&#160;Deborah&#160;Russell&#160;and&#160;GT&#160;Gangemi.&#160;Computer&#160;security&#160;basics.&#160;”&#160;O’Reilly<br/>
Media,&#160;Inc.”,&#160;1991.<br/>
[2]&#160;Ulrich&#160;Bayer,&#160;Andreas&#160;Moser,&#160;Christopher&#160;Kruegel,&#160;and&#160;Engin&#160;Kirda.&#160;Dy-<br/>
namic&#160;analysis&#160;of&#160;malicious&#160;code.&#160;Journal&#160;in&#160;Computer&#160;Virology,&#160;2(1):67–<br/>77,&#160;2006.<br/>
[3]&#160;Dennis&#160;Distler&#160;and&#160;Charles&#160;Hornat.&#160;Malware&#160;analysis:&#160;An&#160;introduction.<br/>
SANS&#160;Institute&#160;InfoSec&#160;Reading&#160;Room,&#160;pages&#160;18–19,&#160;2007.<br/>
[4]&#160;Babak&#160;Bashari&#160;Rad,&#160;Maslin&#160;Masrom,&#160;and&#160;Suhaimi&#160;Ibrahim.&#160;Camouflage<br/>
in&#160;malware:&#160;from&#160;encryption&#160;to&#160;metamorphism.&#160;International&#160;Journal&#160;of<br/>Computer&#160;Science&#160;and&#160;Network&#160;Security,&#160;12(8):74–83,&#160;2012.<br/>
[5]&#160;Mike&#160;Schiffman.&#160;A&#160;brief&#160;history&#160;of&#160;malware&#160;obfuscation.&#160;Available&#160;on:<br/>
http://blogs.&#160;cisco.&#160;com/security/a&#160;brief&#160;history&#160;of&#160;malware&#160;obfuscation<br/>part&#160;1&#160;of&#160;2,&#160;2010.<br/>
[6]&#160;Mike&#160;Schiffman.&#160;A&#160;brief&#160;history&#160;of&#160;malware&#160;obfuscation:&#160;Part&#160;2&#160;of&#160;2.&#160;Cisco<br/>
Blog,&#160;2010.<br/>
[7]&#160;Ilsun&#160;You&#160;and&#160;Kangbin&#160;Yim.&#160;Malware&#160;obfuscation&#160;techniques:&#160;A&#160;brief<br/>
survey.&#160;In&#160;Broadband,&#160;Wireless&#160;Computing,&#160;Communication&#160;and&#160;Applica-<br/>tions&#160;(BWCCA),&#160;2010&#160;International&#160;Conference&#160;on,&#160;pages&#160;297–300.&#160;IEEE,<br/>2010.<br/>
[8]&#160;Jean-Marie&#160;Borello&#160;and&#160;Ludovic&#160;M´<br/>
e.<br/>
Code&#160;obfuscation&#160;techniques&#160;for<br/>
metamorphic&#160;viruses.&#160;Journal&#160;in&#160;Computer&#160;Virology,&#160;4(3):211–220,&#160;2008.<br/>
[9]&#160;Andreas&#160;Moser,&#160;Christopher&#160;Kruegel,&#160;and&#160;Engin&#160;Kirda.&#160;Limits&#160;of&#160;static<br/>
analysis&#160;for&#160;malware&#160;detection.&#160;In&#160;Computer&#160;security&#160;applications&#160;con-<br/>ference,&#160;2007.&#160;ACSAC&#160;2007.&#160;Twenty-third&#160;annual,&#160;pages&#160;421–430.&#160;IEEE,<br/>2007.<br/>
[10]&#160;Fanglu&#160;Guo,&#160;Peter&#160;Ferrie,&#160;and&#160;Tzi-Cker&#160;Chiueh.&#160;A&#160;study&#160;of&#160;the&#160;packer<br/>
problem&#160;and&#160;its&#160;solutions.&#160;In&#160;International&#160;Workshop&#160;on&#160;Recent&#160;Advances<br/>in&#160;Intrusion&#160;Detection,&#160;pages&#160;98–115.&#160;Springer,&#160;2008.<br/>
[11]&#160;H&#160;Mourad.&#160;Sleeping&#160;your&#160;way&#160;out&#160;of&#160;the&#160;sandbox.&#160;SANS&#160;Security&#160;Report,<br/>
2015.<br/>
25<br/>
<hr/>
<a name=26></a>[12]&#160;Alexei&#160;Bulazel&#160;and&#160;B¨<br/>
ulent&#160;Yener.&#160;A&#160;survey&#160;on&#160;automated&#160;dynamic&#160;mal-<br/>
ware&#160;analysis&#160;evasion&#160;and&#160;counter-evasion:&#160;Pc,&#160;mobile,&#160;and&#160;web.&#160;In&#160;Pro-<br/>ceedings&#160;of&#160;the&#160;1st&#160;Reversing&#160;and&#160;Offensive-oriented&#160;Trends&#160;Symposium,<br/>page&#160;2.&#160;ACM,&#160;2017.<br/>
[13]&#160;Yuxin&#160;Gao,&#160;Zexin&#160;Lu,&#160;and&#160;Yuqing&#160;Luo.&#160;Survey&#160;on&#160;malware&#160;anti-analysis.<br/>
In&#160;Intelligent&#160;Control&#160;and&#160;Information&#160;Processing&#160;(ICICIP),&#160;2014&#160;Fifth<br/>International&#160;Conference&#160;on,&#160;pages&#160;270–275.&#160;IEEE,&#160;2014.<br/>
[14]&#160;Jonathan&#160;AP&#160;Marpaung,&#160;Mangal&#160;Sain,&#160;and&#160;Hoon-Jae&#160;Lee.&#160;Survey&#160;on<br/>
malware&#160;evasion&#160;techniques:&#160;State&#160;of&#160;the&#160;art&#160;and&#160;challenges.&#160;In&#160;Advanced<br/>Communication&#160;Technology&#160;(ICACT),&#160;2012&#160;14th&#160;International&#160;Confer-<br/>ence&#160;on,&#160;pages&#160;744–749.&#160;IEEE,&#160;2012.<br/>
[15]&#160;av&#160;test.&#160;The&#160;av-test&#160;security&#160;report&#160;2016/2017,&#160;2017.<br/>
[16]&#160;Christopher&#160;Kruegel.&#160;Evasive&#160;malware&#160;exposed&#160;and&#160;deconstructed.&#160;In<br/>
RSA&#160;Conference,&#160;pages&#160;12–20,&#160;2015.<br/>
[17]&#160;Yoshihiro&#160;Oyama.&#160;Trends&#160;of&#160;anti-analysis&#160;operations&#160;of&#160;malwares&#160;observed<br/>
in&#160;api&#160;call&#160;logs.&#160;Journal&#160;of&#160;Computer&#160;Virology&#160;and&#160;Hacking&#160;Techniques,<br/>14(1):69–85,&#160;2018.<br/>
[18]&#160;Christopher&#160;Kruegel.&#160;How&#160;to&#160;build&#160;an&#160;effective&#160;malware&#160;analysis&#160;sandbox,<br/>
2014.<br/>
[19]&#160;Michael&#160;Sikorski&#160;and&#160;Andrew&#160;Honig.<br/>
Practical&#160;malware&#160;analysis:&#160;the<br/>
hands-on&#160;guide&#160;to&#160;dissecting&#160;malicious&#160;software.&#160;no&#160;starch&#160;press,&#160;2012.<br/>
[20]&#160;Nguyen&#160;Anh&#160;Quynh&#160;and&#160;Kuniyasu&#160;Suzaki.&#160;Virt-ice:&#160;Next-generation&#160;de-<br/>
bugger&#160;for&#160;malware&#160;analysis.&#160;Black&#160;Hat&#160;USA,&#160;2010.<br/>
[21]&#160;Rodrigo&#160;Rubira&#160;Branco,&#160;Gabriel&#160;Negreira&#160;Barbosa,&#160;and&#160;Pedro&#160;Drimel<br/>
Neto.&#160;Scientific&#160;but&#160;not&#160;academical&#160;overview&#160;of&#160;malware&#160;anti-debugging,<br/>anti-disassembly&#160;and&#160;anti-vm&#160;technologies.&#160;Black&#160;Hat,&#160;2012.<br/>
[22]&#160;apriorit.&#160;Anti&#160;debugging&#160;protection&#160;techniques,&#160;2016.<br/>
[23]&#160;Xu&#160;Chen,&#160;Jon&#160;Andersen,&#160;Z&#160;Morley&#160;Mao,&#160;Michael&#160;Bailey,&#160;and&#160;Jose&#160;Nazario.<br/>
Towards&#160;an&#160;understanding&#160;of&#160;anti-virtualization&#160;and&#160;anti-debugging&#160;be-<br/>havior&#160;in&#160;modern&#160;malware.&#160;In&#160;Dependable&#160;Systems&#160;and&#160;Networks&#160;With<br/>FTCS&#160;and&#160;DCC,&#160;2008.&#160;DSN&#160;2008.&#160;IEEE&#160;International&#160;Conference&#160;on,<br/>pages&#160;177–186.&#160;IEEE,&#160;2008.<br/>
[24]&#160;Nicolas&#160;Falliere.&#160;Windows&#160;anti-debug&#160;reference.&#160;http://www.&#160;security-<br/>
focus.&#160;com/infocus/1893,&#160;2007.<br/>
[25]&#160;P.&#160;Ferrie.&#160;The&#160;ultimate&#160;anti-debugging&#160;reference,&#160;2011.<br/>
[26]&#160;Joshua&#160;Tully.&#160;An&#160;anti-reverse&#160;engineering&#160;guide,&#160;9&#160;Nov&#160;2008.<br/>
26<br/>
<hr/>
<a name=27></a>[27]&#160;Mark&#160;Vincent&#160;Yason.&#160;The&#160;art&#160;of&#160;unpacking.&#160;Retrieved&#160;Feb,&#160;12:2008,&#160;2007.<br/>
[28]&#160;Fengwei&#160;Zhang,&#160;Kevin&#160;Leach,&#160;Angelos&#160;Stavrou,&#160;Haining&#160;Wang,&#160;and&#160;Kun<br/>
Sun.&#160;Using&#160;hardware&#160;features&#160;for&#160;increased&#160;debugging&#160;transparency.&#160;In<br/>Security&#160;and&#160;Privacy&#160;(SP),&#160;2015&#160;IEEE&#160;Symposium&#160;on,&#160;pages&#160;55–69.&#160;IEEE,<br/>2015.<br/>
[29]&#160;Hao&#160;Shi&#160;and&#160;Jelena&#160;Mirkovic.&#160;Hiding&#160;debuggers&#160;from&#160;malware&#160;with&#160;apate.<br/>
In&#160;Proceedings&#160;of&#160;the&#160;Symposium&#160;on&#160;Applied&#160;Computing,&#160;pages&#160;1703–1710.<br/>ACM,&#160;2017.<br/>
[30]&#160;Sanjeev&#160;Kumar&#160;Aggarwal&#160;and&#160;M&#160;Sarath&#160;Kumar.&#160;Debuggers&#160;for&#160;program-<br/>
ming&#160;languages,&#160;2002.<br/>
[31]&#160;Michael&#160;Chourdakis.&#160;Toggle&#160;hardware&#160;data/read/execute&#160;breakpoints&#160;pro-<br/>
grammatically,&#160;2008.<br/>
[32]&#160;Microsoft&#160;msdn.&#160;Debugging&#160;functions.<br/>
[33]&#160;Shang&#160;Gao&#160;and&#160;Qian&#160;Lin.&#160;Debugging&#160;classification&#160;and&#160;anti-debugging<br/>
strategies.&#160;In&#160;Fourth&#160;International&#160;Conference&#160;on&#160;Machine&#160;Vision&#160;(ICMV<br/>2011):&#160;Computer&#160;Vision&#160;and&#160;Image&#160;Analysis;&#160;Pattern&#160;Recognition&#160;and<br/>Basic&#160;Technologies,&#160;volume&#160;8350,&#160;page&#160;83503C.&#160;International&#160;Society&#160;for<br/>Optics&#160;and&#160;Photonics,&#160;2012.<br/>
[34]&#160;Artem&#160;Dinaburg,&#160;Paul&#160;Royal,&#160;Monirul&#160;Sharif,&#160;and&#160;Wenke&#160;Lee.&#160;Ether:<br/>
malware&#160;analysis&#160;via&#160;hardware&#160;virtualization&#160;extensions.&#160;In&#160;Proceedings<br/>of&#160;the&#160;15th&#160;ACM&#160;conference&#160;on&#160;Computer&#160;and&#160;communications&#160;security,<br/>pages&#160;51–62.&#160;ACM,&#160;2008.<br/>
[35]&#160;Kevin&#160;Lawton.&#160;Bochs:&#160;The&#160;open&#160;source&#160;ia-32&#160;emulation&#160;project,&#160;2003.<br/>
[36]&#160;Microsoft.&#160;Peb&#160;structure.<br/>
[37]&#160;Lexi&#160;Security&#160;Hub.&#160;Overview&#160;of&#160;the&#160;kronos&#160;banking&#160;malware&#160;rootkit,&#160;2014.<br/>
[38]&#160;Cylance&#160;Threat&#160;Guidance&#160;Team.&#160;threat-spotlight-satan-raas,&#160;2017.<br/>
[39]&#160;Kulchytskyi&#160;Oleg.&#160;Anti-debug&#160;protection&#160;techniques:&#160;Implementation&#160;and<br/>
neutralization,&#160;2016.<br/>
[40]&#160;McAfee.&#160;The&#160;w9x.cih&#160;virus,&#160;2000.<br/>
[41]&#160;JOESandbox.&#160;shcndhss.exe,&#160;2018.<br/>
[42]&#160;Tyler&#160;Shields.&#160;Anti-debugging–a&#160;developers&#160;view.&#160;Veracode&#160;Inc.,&#160;USA,<br/>
2010.<br/>
[43]&#160;Virustotal.&#160;vti-rescan,&#160;2015.<br/>
[44]&#160;JOESandbox.&#160;Automated&#160;malware&#160;analysis&#160;report&#160;for&#160;wdf01000.sys,&#160;2010.<br/>
27<br/>
<hr/>
<a name=28></a>[45]&#160;Curesec&#160;Security&#160;Research.&#160;Inkasso&#160;trojaner&#160;–&#160;part&#160;3,&#160;2013.<br/>
[46]&#160;Microsoft.&#160;Structured&#160;exception&#160;handling,&#160;2018.<br/>
[47]&#160;Infosec&#160;Institute.&#160;Zeroaccess&#160;malware&#160;-&#160;part&#160;1,&#160;2015.<br/>
[48]&#160;2018.<br/>
[49]&#160;G´<br/>
abor&#160;P´<br/>
ek,&#160;Boldizs´<br/>
ar&#160;Bencs´<br/>
ath,&#160;and&#160;Levente&#160;Butty´<br/>
an.&#160;nether:&#160;In-guest<br/>
detection&#160;of&#160;out-of-the-guest&#160;malware&#160;analyzers.&#160;In&#160;Proceedings&#160;of&#160;the<br/>Fourth&#160;European&#160;Workshop&#160;on&#160;System&#160;Security,&#160;page&#160;3.&#160;ACM,&#160;2011.<br/>
[50]&#160;Kaspersky.&#160;Virus.win32.hiv,&#160;2000.<br/>
[51]&#160;McAfee.&#160;W32.mydoom.m@mm,&#160;2007.<br/>
[52]&#160;Gary&#160;McGraw&#160;and&#160;Greg&#160;Morrisett.&#160;Attacking&#160;malicious&#160;code:&#160;A&#160;report<br/>
to&#160;the&#160;infosec&#160;research&#160;council.&#160;IEEE&#160;software,&#160;17(5):33–41,&#160;2000.<br/>
[53]&#160;Microsoft&#160;msdn.&#160;Zwsetinformationthread&#160;function,&#160;2018.<br/>
[54]&#160;Kyle&#160;Yang&#160;Walter&#160;(Tiezhu)&#160;Kong.&#160;Unlocking&#160;lockscreen,&#160;2013.<br/>
[55]&#160;UIC.&#160;Mcrat&#160;malware&#160;analysis&#160;–&#160;part1,&#160;2013.<br/>
[56]&#160;CTurt.&#160;Reverse&#160;engineering&#160;vertexnet&#160;malware.<br/>
[57]&#160;Carbon&#160;Monoxide.&#160;Scyllahide,&#160;2016.<br/>
[58]&#160;Peter&#160;Ferrie.&#160;Anti-unpacker&#160;tricks–part&#160;one.&#160;Virus&#160;Bulletin,&#160;4,&#160;2008.<br/>
[59]&#160;XPN.&#160;Windows&#160;anti-debug&#160;techniques&#160;-&#160;openprocess&#160;filtering,&#160;2017.<br/>
[60]&#160;Nicolas&#160;Brulez.&#160;Scan&#160;of&#160;the&#160;month&#160;33:&#160;Anti&#160;reverse&#160;engineering&#160;uncovered.<br/>
[61]&#160;David&#160;Patten.&#160;The&#160;evolution&#160;to&#160;fileless&#160;malware.&#160;Retrieved&#160;from,&#160;2017.<br/>
[62]&#160;Steve&#160;Mansfield-Devine.&#160;Fileless&#160;attacks:&#160;compromising&#160;targets&#160;without<br/>
malware.&#160;Network&#160;Security,&#160;2017(4):7–11,&#160;2017.<br/>
[63]&#160;Malwarebytes.&#160;Samsam&#160;ransomware:&#160;controlled&#160;distribution&#160;for&#160;an&#160;elusive<br/>
malware.&#160;Technical&#160;report,&#160;Malwarebytes&#160;Labs,&#160;2018.<br/>
[64]&#160;Niamh&#160;Minihane&#160;Eric&#160;Peterson&#160;Raj&#160;Samani&#160;Craig&#160;Schmugar&#160;ReseAnne<br/>
Sims&#160;Dan&#160;Sommer&#160;Bing&#160;Sun&#160;Alex&#160;Bassett,&#160;Christiaan&#160;Beek.&#160;Macafee&#160;labs<br/>threat&#160;report&#160;march&#160;2018.&#160;Technical&#160;report,&#160;McAfee&#160;Lbas,&#160;2018.<br/>
[65]&#160;Jack&#160;Danahy&#160;Larry&#160;Ponemon.&#160;The&#160;2017&#160;state&#160;of&#160;endpoint&#160;security&#160;risk<br/>
report.&#160;Technical&#160;report,&#160;Ponemon&#160;Institute,&#160;2018.<br/>
28<br/>
<hr/>
<a name=29></a>[66]&#160;Ping&#160;Chen,&#160;Christophe&#160;Huygens,&#160;Lieven&#160;Desmet,&#160;and&#160;Wouter&#160;Joosen.&#160;Ad-<br/>
vanced&#160;or&#160;not?&#160;a&#160;comparative&#160;study&#160;of&#160;the&#160;use&#160;of&#160;anti-debugging&#160;and&#160;anti-<br/>vm&#160;techniques&#160;in&#160;generic&#160;and&#160;targeted&#160;malware.&#160;In&#160;IFIP&#160;International<br/>Information&#160;Security&#160;and&#160;Privacy&#160;Conference,&#160;pages&#160;323–336.&#160;Springer,<br/>2016.<br/>
[67]&#160;Lovely&#160;Bruiz&#160;Xavier&#160;Capilitan&#160;Andrew&#160;Go,&#160;Christopher&#160;del&#160;Fierro.&#160;Where<br/>
we&#160;go,&#160;we&#160;don’t&#160;need&#160;files:&#160;Analysis&#160;of&#160;fileless&#160;malware&#160;”rozena”.&#160;Technical<br/>report,&#160;G&#160;Data,&#160;2018.<br/>
[68]&#160;MacAfee&#160;Labs.&#160;Threats&#160;report,&#160;2018.<br/>
[69]&#160;Robert&#160;P&#160;Goldberg.<br/>
Survey&#160;of&#160;virtual&#160;machine&#160;research.<br/>
Computer,<br/>
7(6):34–45,&#160;1974.<br/>
[70]&#160;Norman&#160;sandbox.<br/>
[71]&#160;Carsten&#160;Willems,&#160;Thorsten&#160;Holz,&#160;and&#160;Felix&#160;Freiling.&#160;Toward&#160;automated<br/>
dynamic&#160;malware&#160;analysis&#160;using&#160;cwsandbox.&#160;IEEE&#160;Security&#160;&amp;&#160;Privacy,<br/>5(2),&#160;2007.<br/>
[72]&#160;Manuel&#160;Egele,&#160;Theodoor&#160;Scholte,&#160;Engin&#160;Kirda,&#160;and&#160;Christopher&#160;Kruegel.<br/>
A&#160;survey&#160;on&#160;automated&#160;dynamic&#160;malware-analysis&#160;techniques&#160;and&#160;tools.<br/>ACM&#160;computing&#160;surveys&#160;(CSUR),&#160;44(2):6,&#160;2012.<br/>
[73]&#160;Dhilung&#160;Kirat,&#160;Giovanni&#160;Vigna,&#160;and&#160;Christopher&#160;Kruegel.<br/>
Barecloud:<br/>
Bare-metal&#160;analysis-based&#160;evasive&#160;malware&#160;detection.&#160;In&#160;USENIX&#160;Security<br/>Symposium,&#160;pages&#160;287–301,&#160;2014.<br/>
[74]&#160;Carsten&#160;Willems,&#160;Ralf&#160;Hund,&#160;Andreas&#160;Fobian,&#160;Dennis&#160;Felsch,&#160;Thorsten<br/>
Holz,&#160;and&#160;Amit&#160;Vasudevan.&#160;Down&#160;to&#160;the&#160;bare&#160;metal:&#160;Using&#160;processor<br/>features&#160;for&#160;binary&#160;analysis.&#160;In&#160;Proceedings&#160;of&#160;the&#160;28th&#160;Annual&#160;Computer<br/>Security&#160;Applications&#160;Conference,&#160;pages&#160;189–198.&#160;ACM,&#160;2012.<br/>
[75]&#160;Dhilung&#160;Kirat,&#160;Giovanni&#160;Vigna,&#160;and&#160;Christopher&#160;Kruegel.&#160;Barebox:&#160;effi-<br/>
cient&#160;malware&#160;analysis&#160;on&#160;bare-metal.&#160;In&#160;Proceedings&#160;of&#160;the&#160;27th&#160;Annual<br/>Computer&#160;Security&#160;Applications&#160;Conference,&#160;pages&#160;403–412.&#160;ACM,&#160;2011.<br/>
[76]&#160;McAfee.&#160;Mcafee&#160;labs&#160;threats&#160;report,&#160;2017.<br/>
[77]&#160;Thomas&#160;Raffetseder,&#160;Christopher&#160;Kruegel,&#160;and&#160;Engin&#160;Kirda.&#160;Detecting<br/>
system&#160;emulators.&#160;In&#160;International&#160;Conference&#160;on&#160;Information&#160;Security,<br/>pages&#160;1–18.&#160;Springer,&#160;2007.<br/>
[78]&#160;Boris&#160;Lau&#160;and&#160;Vanja&#160;Svajcer.&#160;Measuring&#160;virtual&#160;machine&#160;detection&#160;in<br/>
malware&#160;using&#160;dsd&#160;tracer.&#160;Journal&#160;in&#160;Computer&#160;Virology,&#160;6(3):181–195,<br/>2010.<br/>
[79]&#160;Thorsten&#160;Holz&#160;and&#160;Frederic&#160;Raynal.&#160;Detecting&#160;honeypots&#160;and&#160;other&#160;suspi-<br/>
cious&#160;environments.&#160;In&#160;Information&#160;Assurance&#160;Workshop,&#160;2005.&#160;IAW’05.<br/>Proceedings&#160;from&#160;the&#160;Sixth&#160;Annual&#160;IEEE&#160;SMC,&#160;pages&#160;29–36.&#160;IEEE,&#160;2005.<br/>
29<br/>
<hr/>
<a name=30></a>[80]&#160;Alexandros&#160;Kapravelos,&#160;Marco&#160;Cova,&#160;Christopher&#160;Kruegel,&#160;and&#160;Giovanni<br/>
Vigna.<br/>
Escape&#160;from&#160;monkey&#160;island:&#160;Evading&#160;high-interaction&#160;honey-<br/>
clients.&#160;In&#160;International&#160;Conference&#160;on&#160;Detection&#160;of&#160;Intrusions&#160;and&#160;Mal-<br/>ware,&#160;and&#160;Vulnerability&#160;Assessment,&#160;pages&#160;124–143.&#160;Springer,&#160;2011.<br/>
[81]&#160;Akira&#160;Yokoyama,&#160;Kou&#160;Ishii,&#160;Rui&#160;Tanabe,&#160;Yinmin&#160;Papa,&#160;Katsunari&#160;Yosh-<br/>
ioka,&#160;Tsutomu&#160;Matsumoto,&#160;Takahiro&#160;Kasama,&#160;Daisuke&#160;Inoue,&#160;Michael<br/>Brengel,&#160;Michael&#160;Backes,&#160;et&#160;al.&#160;Sandprint:&#160;fingerprinting&#160;malware&#160;sand-<br/>boxes&#160;to&#160;provide&#160;intelligence&#160;for&#160;sandbox&#160;evasion.&#160;In&#160;International&#160;Sym-<br/>posium&#160;on&#160;Research&#160;in&#160;Attacks,&#160;Intrusions,&#160;and&#160;Defenses,&#160;pages&#160;165–187.<br/>Springer,&#160;2016.<br/>
[82]&#160;Reptile&#160;malware&#160;-&#160;behavioral&#160;analysis,&#160;2012.<br/>
[83]&#160;Yaniv&#160;Assor.&#160;Anti-vm&#160;and&#160;anti-sandbox&#160;explained,&#160;2016.<br/>
[84]&#160;Sophos.&#160;W32/agobot-ot,&#160;2015.<br/>
[85]&#160;Symantec.&#160;Trojan.peacomm.c,&#160;2007.<br/>
[86]&#160;Christopher&#160;Kruegel.&#160;Evasive&#160;malware&#160;exposed&#160;and&#160;deconstructed.&#160;In<br/>
RSA&#160;Conference,&#160;pages&#160;12–20,&#160;2015.<br/>
[87]&#160;Microsoft.&#160;Worm:win32/rbot.st,&#160;2017.<br/>
[88]&#160;Microsoft.&#160;Win32/phatbot.a,&#160;2006.<br/>
[89]&#160;Jason&#160;Franklin,&#160;Mark&#160;Luk,&#160;Jonathan&#160;M&#160;McCune,&#160;Arvind&#160;Seshadri,&#160;Adrian<br/>
Perrig,&#160;and&#160;Leendert&#160;Van&#160;Doorn.&#160;Remote&#160;detection&#160;of&#160;virtual&#160;machine<br/>monitors&#160;with&#160;fuzzy&#160;benchmarking.&#160;ACM&#160;SIGOPS&#160;Operating&#160;Systems<br/>Review,&#160;42(3):83–92,&#160;2008.<br/>
[90]&#160;Tal&#160;Garfinkel,&#160;Keith&#160;Adams,&#160;Andrew&#160;Warfield,&#160;and&#160;Jason&#160;Franklin.&#160;Com-<br/>
patibility&#160;is&#160;not&#160;transparency:&#160;Vmm&#160;detection&#160;myths&#160;and&#160;realities.&#160;In<br/>HotOS,&#160;2007.<br/>
[91]&#160;Roberto&#160;Paleari,&#160;Lorenzo&#160;Martignoni,&#160;Giampaolo&#160;Fresi&#160;Roglia,&#160;and&#160;Danilo<br/>
Bruschi.&#160;A&#160;fistful&#160;of&#160;red-pills:&#160;How&#160;to&#160;automatically&#160;generate&#160;procedures<br/>to&#160;detect&#160;cpu&#160;emulators.&#160;In&#160;Proceedings&#160;of&#160;the&#160;USENIX&#160;Workshop&#160;on<br/>Offensive&#160;Technologies&#160;(WOOT),&#160;volume&#160;41,&#160;page&#160;86,&#160;2009.<br/>
[92]&#160;Katsunari&#160;Yoshioka,&#160;Yoshihiko&#160;Hosobuchi,&#160;Tatsunori&#160;Orii,&#160;and&#160;Tsutomu<br/>
Matsumoto.&#160;Your&#160;sandbox&#160;is&#160;blinded:&#160;Impact&#160;of&#160;decoy&#160;injection&#160;to&#160;public<br/>malware&#160;analysis&#160;systems.&#160;Journal&#160;of&#160;Information&#160;Processing,&#160;19:153–168,<br/>2011.<br/>
[93]&#160;Jeremy&#160;Blackthorne,&#160;Alexei&#160;Bulazel,&#160;Andrew&#160;Fasano,&#160;Patrick&#160;Biernat,&#160;and<br/>
B¨<br/>
ulent&#160;Yener.&#160;Avleak:&#160;Fingerprinting&#160;antivirus&#160;emulators&#160;through&#160;black-<br/>
box&#160;testing.&#160;In&#160;Proceedings&#160;of&#160;the&#160;10th&#160;USENIX&#160;Conference&#160;on&#160;Offensive<br/>Technologies,&#160;pages&#160;91–105.&#160;USENIX&#160;Association.<br/>
30<br/>
<hr/>
<a name=31></a>[94]&#160;Chad&#160;Spensky,&#160;Hongyi&#160;Hu,&#160;and&#160;Kevin&#160;Leach.&#160;Lo-phi:&#160;Low-observable<br/>
physical&#160;host&#160;instrumentation&#160;for&#160;malware&#160;analysis.&#160;In&#160;NDSS,&#160;2016.<br/>
[95]&#160;Brendan&#160;Dolan-Gavitt&#160;and&#160;Yacin&#160;Nadji.&#160;See&#160;no&#160;evil:&#160;Evasions&#160;in&#160;honey-<br/>
monkey&#160;systems,&#160;2010.<br/>
[96]&#160;Arunpreet&#160;Singh.&#160;Malware&#160;evasion&#160;techniques:&#160;Same&#160;wolf&#160;–&#160;different&#160;cloth-<br/>
ing,&#160;2017.<br/>
[97]&#160;Nicolas&#160;Falliere,&#160;Liam&#160;O&#160;Murchu,&#160;and&#160;Eric&#160;Chien.&#160;W32.&#160;stuxnet&#160;dossier.<br/>
White&#160;paper,&#160;Symantec&#160;Corp.,&#160;Security&#160;Response,&#160;5(6):29,&#160;2011.<br/>
[98]&#160;Yasir&#160;Khalid&#160;Abhishek&#160;Singh.&#160;Don’t&#160;click&#160;the&#160;left&#160;mouse&#160;button:&#160;Intro-<br/>
ducing&#160;trojan&#160;upclicker,&#160;2012.<br/>
[99]&#160;Chong&#160;Rong&#160;Hwa.&#160;Trojan.apt.banechant:&#160;In-memory&#160;trojan&#160;that&#160;observes<br/>
for&#160;multiple&#160;mouse&#160;clicks,&#160;2013.<br/>
[100]&#160;Abhishek&#160;Singh&#160;Sai&#160;Omkar&#160;Vashisht.&#160;Turing&#160;test&#160;in&#160;reverse:&#160;New&#160;sandbox-<br/>
evasion&#160;techniques&#160;seek&#160;human&#160;interaction,&#160;2014.<br/>
[101]&#160;Clemens&#160;Kolbitsch&#160;Arunpreet&#160;Singh.&#160;Not&#160;so&#160;fast&#160;my&#160;friend&#160;–&#160;using&#160;inverted<br/>
timing&#160;attacks&#160;to&#160;bypass&#160;dynamic&#160;analysis,&#160;2014.<br/>
[102]&#160;Najmeh&#160;Miramirkhani,&#160;Mahathi&#160;Priya&#160;Appini,&#160;Nick&#160;Nikiforakis,&#160;and<br/>
Michalis&#160;Polychronakis.&#160;Spotless&#160;sandboxes:&#160;Evading&#160;malware&#160;analysis<br/>systems&#160;using&#160;wear-and-tear&#160;artifacts.&#160;In&#160;Security&#160;and&#160;Privacy&#160;(SP),&#160;2017<br/>IEEE&#160;Symposium&#160;on,&#160;pages&#160;1009–1024.&#160;IEEE,&#160;2017.<br/>
[103]&#160;GReAT.&#160;The&#160;darkhotel&#160;apt,&#160;2014.<br/>
[104]&#160;Travis&#160;Morrow&#160;and&#160;Josh&#160;Pitts.&#160;Genetic&#160;malware:&#160;Designing&#160;payloads&#160;for<br/>
specific&#160;targets.(2016).&#160;Talk&#160;at&#160;Infiltrate,&#160;2016.<br/>
[105]&#160;B&#160;Bencs´<br/>
ath,&#160;G&#160;P´<br/>
ek,&#160;L&#160;Butty´<br/>
an,&#160;and&#160;M&#160;F´<br/>
elegyh´<br/>
azi.&#160;The&#160;cousins&#160;of&#160;stuxnet:<br/>
Duqu,&#160;flame,&#160;and&#160;gauss.&#160;future&#160;internet,&#160;4&#160;(4),&#160;971-1003,&#160;2012.<br/>
[106]&#160;MalwareTech.&#160;Kelihos&#160;analysis&#160;–&#160;part&#160;1,&#160;2015.<br/>
[107]&#160;Pafish&#160;(paranoid&#160;fish),&#160;2014.<br/>
[108]&#160;Alex&#160;Chiu&#160;Ben&#160;Baker.&#160;Threat&#160;spotlight:&#160;Rombertik&#160;–&#160;gazing&#160;past&#160;the<br/>
smoke,&#160;mirrors,&#160;and&#160;trapdoors,&#160;2015.<br/>
[109]&#160;Martina&#160;Lindorfer,&#160;Clemens&#160;Kolbitsch,&#160;and&#160;Paolo&#160;Milani&#160;Comparetti.&#160;De-<br/>
tecting&#160;environment-sensitive&#160;malware.&#160;In&#160;International&#160;Workshop&#160;on&#160;Re-<br/>cent&#160;Advances&#160;in&#160;Intrusion&#160;Detection,&#160;pages&#160;338–357.&#160;Springer,&#160;2011.<br/>
[110]&#160;Jason&#160;Barlow.&#160;Tribe&#160;flood&#160;network&#160;2000&#160;(tfn2k),&#160;2000.<br/>
31<br/>
<hr/>
<a name=32></a>[111]&#160;David&#160;Brumley,&#160;Cody&#160;Hartwig,&#160;Zhenkai&#160;Liang,&#160;James&#160;Newsome,&#160;Dawn<br/>
Song,&#160;and&#160;Heng&#160;Yin.&#160;Automatically&#160;identifying&#160;trigger-based&#160;behavior&#160;in<br/>malware,&#160;pages&#160;65–88.&#160;Springer,&#160;2008.<br/>
[112]&#160;Paul&#160;Roberts.&#160;Mydoom&#160;sets&#160;speed&#160;records,&#160;2004.<br/>
[113]&#160;Symantec.&#160;Xeram.1664,&#160;2000.<br/>
[114]&#160;McAfee.&#160;W97m/opey.bg,&#160;2003.<br/>
[115]&#160;Van&#160;Lam&#160;Le,&#160;Ian&#160;Welch,&#160;Xiaoying&#160;Gao,&#160;and&#160;Peter&#160;Komisarczuk.&#160;Anatomy<br/>
of&#160;drive-by&#160;download&#160;attack.&#160;In&#160;Proceedings&#160;of&#160;the&#160;Eleventh&#160;Australasian<br/>Information&#160;Security&#160;Conference-Volume&#160;138,&#160;pages&#160;49–58.&#160;Australian<br/>Computer&#160;Society,&#160;Inc.,&#160;2013.<br/>
[116]&#160;Amit&#160;Vasudevan&#160;and&#160;Ramesh&#160;Yerraballi.&#160;Cobra:&#160;Fine-grained&#160;malware<br/>
analysis&#160;using&#160;stealth&#160;localized-executions.&#160;In&#160;Security&#160;and&#160;Privacy,&#160;2006<br/>IEEE&#160;Symposium&#160;on,&#160;pages&#160;15–pp.&#160;IEEE,&#160;2006.<br/>
[117]&#160;Andreas&#160;Moser,&#160;Christopher&#160;Kruegel,&#160;and&#160;Engin&#160;Kirda.&#160;Exploring&#160;multi-<br/>
ple&#160;execution&#160;paths&#160;for&#160;malware&#160;analysis.&#160;In&#160;Security&#160;and&#160;Privacy,&#160;2007.<br/>SP’07.&#160;IEEE&#160;Symposium&#160;on,&#160;pages&#160;231–245.&#160;IEEE,&#160;2007.<br/>
[118]&#160;Anh&#160;M&#160;Nguyen,&#160;Nabil&#160;Schear,&#160;HeeDong&#160;Jung,&#160;Apeksha&#160;Godiyal,&#160;Samuel&#160;T<br/>
King,&#160;and&#160;Hai&#160;D&#160;Nguyen.&#160;Mavmm:&#160;Lightweight&#160;and&#160;purpose&#160;built&#160;vmm<br/>for&#160;malware&#160;analysis.<br/>
In&#160;Computer&#160;Security&#160;Applications&#160;Conference,<br/>
2009.&#160;ACSAC’09.&#160;Annual,&#160;pages&#160;441–450.&#160;IEEE,&#160;2009.<br/>
[119]&#160;Lok-Kwong&#160;Yan,&#160;Manjukumar&#160;Jayachandra,&#160;Mu&#160;Zhang,&#160;and&#160;Heng&#160;Yin.<br/>
V2e:&#160;combining&#160;hardware&#160;virtualization&#160;and&#160;softwareemulation&#160;for&#160;trans-<br/>parent&#160;and&#160;extensible&#160;malware&#160;analysis.&#160;ACM&#160;Sigplan&#160;Notices,&#160;47(7):227–<br/>238,&#160;2012.<br/>
[120]&#160;Paul&#160;Royal.&#160;Entrapment:&#160;Tricking&#160;malware&#160;with&#160;transparent,&#160;scalable<br/>
malware&#160;analysis.&#160;Talk&#160;at&#160;Black&#160;Hat,&#160;2012.<br/>
[121]&#160;Fengwei&#160;Zhang,&#160;Kevin&#160;Leach,&#160;Kun&#160;Sun,&#160;and&#160;Angelos&#160;Stavrou.&#160;Spectre:<br/>
A&#160;dependable&#160;introspection&#160;framework&#160;via&#160;system&#160;management&#160;mode.&#160;In<br/>Dependable&#160;Systems&#160;and&#160;Networks&#160;(DSN),&#160;2013&#160;43rd&#160;Annual&#160;IEEE/IFIP<br/>International&#160;Conference&#160;on,&#160;pages&#160;1–12.&#160;IEEE,&#160;2013.<br/>
[122]&#160;Fengwei&#160;Zhang,&#160;Kevin&#160;Leach,&#160;Angelos&#160;Stavrou,&#160;Haining&#160;Wang,&#160;and&#160;Kun<br/>
Sun.&#160;Using&#160;hardware&#160;features&#160;for&#160;increased&#160;debugging&#160;transparency.&#160;In<br/>2015&#160;IEEE&#160;Symposium&#160;on&#160;Security&#160;and&#160;Privacy&#160;(SP),&#160;pages&#160;55–69.&#160;IEEE,<br/>2015.<br/>
[123]&#160;Kevin&#160;Leach,&#160;Chad&#160;Spensky,&#160;Westley&#160;Weimer,&#160;and&#160;Fengwei&#160;Zhang.&#160;To-<br/>
wards&#160;transparent&#160;introspection.&#160;In&#160;Software&#160;Analysis,&#160;Evolution,&#160;and<br/>Reengineering&#160;(SANER),&#160;2016&#160;IEEE&#160;23rd&#160;International&#160;Conference&#160;on,<br/>volume&#160;1,&#160;pages&#160;248–259.&#160;IEEE,&#160;2016.<br/>
32<br/>
<hr/>
<a name=33></a>[124]&#160;Fengwei&#160;Zhang,&#160;Kevin&#160;Leach,&#160;Angelos&#160;Stavrou,&#160;and&#160;Haining&#160;Wang.&#160;To-<br/>
wards&#160;transparent&#160;debugging.&#160;IEEE&#160;Transactions&#160;on&#160;Dependable&#160;and&#160;Se-<br/>cure&#160;Computing,&#160;15(2):321–335,&#160;2018.<br/>
[125]&#160;Yiming&#160;Jing,&#160;Ziming&#160;Zhao,&#160;Gail-Joon&#160;Ahn,&#160;and&#160;Hongxin&#160;Hu.&#160;Morpheus:<br/>
automatically&#160;generating&#160;heuristics&#160;to&#160;detect&#160;android&#160;emulators.&#160;In&#160;Pro-<br/>ceedings&#160;of&#160;the&#160;30th&#160;Annual&#160;Computer&#160;Security&#160;Applications&#160;Conference,<br/>pages&#160;216–225.&#160;ACM,&#160;2014.<br/>
33<br/>
<hr/>
<a name="outline"></a><h1>Document Outline</h1>
<ul>
<li><a href="1811.01190v1s.html#1">1 Introduction</a>
<ul>
<li><a href="1811.01190v1s.html#3">1.1 Overview</a>
<ul>
<li><a href="1811.01190v1s.html#3">1.1.1 Scope</a></li>
<li><a href="1811.01190v1s.html#3">1.1.2 Approach</a></li>
<li><a href="1811.01190v1s.html#4">1.1.3 Evaluation</a></li>
<li><a href="1811.01190v1s.html#4">1.1.4 Organization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="1811.01190v1s.html#4">2 Preliminaries</a>
<ul>
<li><a href="1811.01190v1s.html#4">2.1 Evasion and Transparency</a></li>
<li><a href="1811.01190v1s.html#5">2.2 Manual vs Automated</a></li>
<li><a href="1811.01190v1s.html#5">2.3 Detection vs Analysis</a></li>
<li><a href="1811.01190v1s.html#5">2.4 Static vs Dynamic</a></li>
<li><a href="1811.01190v1s.html#5">2.5 Category, Tactic, and Technique</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#6">3 Manual Dynamic Analysis Evasion</a>
<ul>
<li><a href="1811.01190v1s.html#7">3.1 A Briefing on Debuggers</a></li>
<li><a href="1811.01190v1s.html#8">3.2 Proposed Anti-Debugging Classification</a>
<ul>
<li><a href="1811.01190v1s.html#8">3.2.1 Direct Detection</a></li>
<li><a href="1811.01190v1s.html#10">3.2.2 Deductive Detection</a></li>
<li><a href="1811.01190v1s.html#11">3.2.3 Debugger Escaping</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#13">3.3 A Discussion</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#15">4 Automated Dynamic Analysis Evasion</a>
<ul>
<li><a href="1811.01190v1s.html#15">4.1 An overview of malware sandboxes</a>
<ul>
<li><a href="1811.01190v1s.html#15">4.1.1 Virtualization-based sandboxes</a></li>
<li><a href="1811.01190v1s.html#15">4.1.2 Emulation-based sandboxes</a></li>
<li><a href="1811.01190v1s.html#16">4.1.3 Bare-metal sandboxes</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#16">4.2 Proposed Classification of Automated Dynamic Analysis (sandbox) Evasion tactics</a>
<ul>
<li><a href="1811.01190v1s.html#17">4.2.1 Detection-Dependent Evasion</a></li>
<li><a href="1811.01190v1s.html#20">4.2.2 Detection-Independent Evasion</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#22">4.3 Discussion</a></li>
</ul>
</li>
<li><a href="1811.01190v1s.html#24">5 Conclusion and Future Directions</a></li>
<li><a href="1811.01190v1s.html#25">6 Acknowledgments</a></li>
</ul>
<hr/>
</body>
</html>
